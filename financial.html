<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد جامع سایپا آذین - نسخه نهایی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f1f5f9; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        /* Charts need LTR */
        .recharts-wrapper { direction: ltr; } 
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        
        /* Styles for Payable Documents Tab */
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
        .registered { background-color: #dcfce7; color: #166534; border: 1px solid #166534; }
        .not-registered { background-color: #fef9c3; color: #854d0e; border: 1px solid #854d0e; }
        .returned { background-color: #fee2e2; color: #991b1b; border: 1px solid #991b1b; animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        // Import Recharts for Tabs 1-3
        import { 
            BarChart, Bar, LineChart, Line, PieChart, Pie, Cell, XAxis, YAxis, 
            CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area, LabelList, ComposedChart 
        } from 'https://esm.sh/recharts@2.12.7?deps=react@18.2.0,react-dom@18.2.0';
        // Import Chart.js for Tab 4 (Dynamic Dashboard)
        import { Chart, registerables } from 'https://esm.sh/chart.js@4.4.1';
        
        import { 
            AlertTriangle, TrendingUp, TrendingDown, Ban, Activity, Landmark, Briefcase, FileText, Users, Truck, Wallet, ShieldAlert, FileCheck, CheckCircle, Calendar, Search, Upload, BarChart2 
        } from 'https://esm.sh/lucide-react@0.294.0?deps=react@18.2.0,react-dom@18.2.0';

        // Register Chart.js components
        Chart.register(...registerables);
        Chart.defaults.font.family = 'Vazirmatn';
        Chart.defaults.color = '#64748b';

        // --- 1. DATASETS ---

        // A. Liquidity & Banking Data
        const sourcesData = [ { name: 'دریافتی از سازه‌گستر (جاری)', value: 3407, fill: '#3b82f6' }, { name: 'دریافتی از سازه (حقوق)', value: 2908, fill: '#60a5fa' }, { name: 'اوراق گام (غیرنقد)', value: 1250, fill: '#f59e0b' }, { name: 'دریافت مستقیم سایپا', value: 680, fill: '#10b981' }, { name: 'سایر (LC، ضایعات، ...)', value: 562, fill: '#94a3b8' } ];
        const forecastData = [ { month: 'آبان', salaries: 410, insurance: 120, loans: 28, total: 558 }, { month: 'آذر', salaries: 410, insurance: 120, loans: 30, total: 888 }, { month: 'دی', salaries: 410, insurance: 120, loans: 0, total: 672 }, { month: 'بهمن', salaries: 410, insurance: 120, loans: 0, total: 530 }, { month: 'اسفند', salaries: 410, insurance: 120, loans: 0, total: 740 } ];
        const blockedFundsData = [ { bank: 'بانک شهر', amount: 21134, status: 'مسدود' }, { bank: 'بانک مهر ایران', amount: 7613, status: 'مسدود' }, { bank: 'بانک رسالت', amount: 672, status: 'راکد' }, { bank: 'بانک سپه', amount: 12, status: 'راکد' } ];

        // B. Strategic Data
        const historicalTrendData = [ { name: '۱۲م ۱۴۰۱', revenue: 20927, cost: 19238, net: 850 }, { name: '۱۲م ۱۴۰۲', revenue: 20972, cost: 19548, net: -1055 }, { name: '۱۲م ۱۴۰۳', revenue: 32813, cost: 32737, net: -3580 }, { name: 'پیش‌بینی ۱۴۰۴', revenue: 21300, cost: 23220, net: -7100 } ];
        const gapAnalysisData = [ { name: '۶م ۱۴۰۱', revenue: 9200, cost: 8450 }, { name: '۶م ۱۴۰۲', revenue: 9400, cost: 8900 }, { name: '۶م ۱۴۰۳', revenue: 14052, cost: 15094 }, { name: '۶م ۱۴۰۴', revenue: 10650, cost: 11611 } ];

        // C. Payable Documents Data
        const payableDocsData = [
            { id: 24, desc: "شرکت ایمن خودرو شرق", amount: 10000000000, checkNo: "249111", bank: "شهر - صیادی", date: "1404.03.05", status: "ثبت نشده" },
            { id: 25, desc: "شرکت ورافن", amount: 10000000000, checkNo: "249132", bank: "شهر - صیادی", date: "1404.03.30", status: "ثبت نشده" },
            { id: 26, desc: "صنایع مفتولی اشتهارد", amount: 3000000000, checkNo: "249142", bank: "شهر - صیادی", date: "1404.04.01", status: "ثبت نشده" },
            { id: 27, desc: "شرکت ورافن", amount: 10000000000, checkNo: "249141", bank: "شهر - صیادی", date: "1404.04.06", status: "ثبت نشده" },
            { id: 28, desc: "ایران قطعه", amount: 50000000000, checkNo: "249106", bank: "شهر - صیادی", date: "1404.04.10", status: "ثبت نشده" },
            { id: 29, desc: "یوسف طامه", amount: 3000000000, checkNo: "44676", bank: "مهر ایران", date: "1404.04.15", status: "ثبت شده" },
            { id: 30, desc: "شرکت جهش فام ایرانیان", amount: 100000000000, checkNo: "249105", bank: "شهر - صیادی", date: "1404.04.20", status: "ثبت نشده" },
            { id: 31, desc: "صنایع مفتولی اشتهارد", amount: 2000000000, checkNo: "249110", bank: "شهر - صیادی", date: "1404.04.25", status: "ثبت نشده" },
            { id: 32, desc: "ایران قطعه", amount: 50000000000, checkNo: "249107", bank: "شهر - صیادی", date: "1404.04.30", status: "ثبت نشده" },
            { id: 33, desc: "جهش فام ایرانیان", amount: 100000000000, checkNo: "249135", bank: "شهر - صیادی", date: "1404.09.16", status: "برگشتی" },
            { id: 35, desc: "ایران قطعه", amount: 70000000000, checkNo: "249108", bank: "شهر - صیادی", date: "1404.05.20", status: "ثبت نشده" },
            { id: 36, desc: "حفاری آبراه", amount: 1390000000, checkNo: "249146", bank: "شهر - صیادی", date: "1404.05.30", status: "ثبت نشده" },
            { id: 37, desc: "شرکت ایتراک", amount: 4633237000, checkNo: "249134", bank: "شهر - صیادی", date: "1404.06.15", status: "ثبت شده" },
            { id: 38, desc: "تامین اجتماعی - تقسیط", amount: 74665716894, checkNo: "44681", bank: "مهر ایران", date: "1404.07.20", status: "ثبت شده" },
            { id: 39, desc: "امور مالیاتی - ارزش افزوده", amount: 79249989370, checkNo: "249150", bank: "شهر - صیادی", date: "1404.08.20", status: "برگشتی" },
            { id: 40, desc: "امور مالیاتی - حقوق ابرازی", amount: 36505452333, checkNo: "249129", bank: "شهر - صیادی", date: "1404.08.24", status: "برگشتی" },
            { id: 41, desc: "امور مالیاتی - ارزش افزوده د3", amount: 79249989370, checkNo: "249122", bank: "شهر - صیادی", date: "1404.08.24", status: "برگشتی" },
            { id: 42, desc: "امور مالیاتی - حقوق ابرازی", amount: 36505452333, checkNo: "44682", bank: "مهر ایران", date: "1404.08.28", status: "برگشتی" },
            { id: 43, desc: "امور مالیاتی - جریمه", amount: 7301090467, checkNo: "249130", bank: "شهر - صیادی", date: "1404.09.24", status: "ثبت شده" },
            { id: 44, desc: "امور مالیاتی - پارت دوم", amount: 89120634373, checkNo: "44683", bank: "مهر ایران", date: "1404.09.28", status: "ثبت نشده" },
            { id: 45, desc: "امور مالیاتی - پارت دوم", amount: 44560317187, checkNo: "44684", bank: "مهر ایران", date: "1404.10.28", status: "ثبت نشده" }
        ];

        // D. Initial Dynamic CSV Data
        const initialCSVData = `ماه واریزی,کارفرما,شرح پرداخت,مبلغ ورودی,تاریخ
فروردین,سازه گستر,سازه گستر - مطالبات ,"24,996,905,512",1403.01.21
فروردین,سازه گستر,سازه گستر - مطالبات ,"17,600,840,607",1403.01.26
فروردین,سازه گستر,سازه گستر - مطالبات ,"32,365,655,867",1403.01.26
فروردین,سازه گستر,سایپا - تحویل چک شماره 794183 بانک مهر ایران,"100,000,000,000",1403/01/29
اردیبهشت,سازه گستر,سازه گستر - مطالبات ,"20,000,000,000",1403.02.01
اردیبهشت,زامیاد,زامیاد,"12,000,000,000",1403/02/02
اردیبهشت,سازه گستر,سایپا - تحویل چک شماره 924986 -سپه,"100,000,000,000",1403.02.03
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"49,852,832,702",1403.02.03
اردیبهشت,سایپا یدک,سایپا یدک,"15,000,000,000",1403.02.03
اردیبهشت,سازه گستر,سایپا - از محل مطالبات سازه گستر - چک شماره 593053 - حواله ارزی,"120,000,000,000",1403.02.04
اردیبهشت,سازه گستر,سازه گستر - حقوق فروردین,"53,266,755,373",1403.02.06
اردیبهشت,سازه گستر,سازه گستر - حقوق فروردین,"174,733,244,627",1403.02.06
اردیبهشت,سازه گستر,سازه گستر - کسری حقوق فروردین,"75,000,000,000",1403.02.08
اردیبهشت,زامیاد,زامیاد,"5,000,000,000",1403.02.08
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"12,359,309,864",1403.02.16
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"37,640,690,136",1403.02.16
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"39,998,237,300",1403.02.20
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"39,997,289,786",1403.02.20
اردیبهشت,سازه گستر,سازه گستر - SCF اردیبهشت,"500,000,000,000",1403.02.22
اردیبهشت,زامیاد,زامیاد,"8,000,000,000",1403.02.25
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"79,999,928,045",1403.02.25
خرداد,سازه گستر,سازه گستر - مطالبات,"99,999,321,409",1403.03.03
خرداد,سایپا یدک,واریز طی دوره - سایپا یدک - بازارگاه,"2,014,060,424",1403.03.05
خرداد,سازه گستر,سازه گستر - حقوق اردیبهشت,"256,461,080,843",1403.03.06
خرداد,سازه گستر,سازه گستر - حقوق اردیبهشت,"45,000,000,000",1403.03.06
خرداد,سازه گستر,سازه گستر - مطالبات,"79,921,706,274",1403.03.19
خرداد,سایر,گروه صنعتی برنز,"1,660,000,000",1403.03.20
خرداد,سازه گستر,سازه گستر - مطالبات,"149,999,512,139",1403/03/24
خرداد,سایر,مبلغ مسدود شده بابت 2 نفر - تسویه سنوات,"1,800,000,000",1403.03.27
تیر,سازه گستر,سازه گستر - مطالبات,"69,999,233,744",1403.04.04
تیر,سازه گستر,سازه گستر - حقوق خرداد,"251,767,513,507",1403.04.04
تیر,سازه گستر,سازه گستر - مطالبات,"49,972,036,278",1403.04.09
تیر,سازه گستر,سازه گستر - مطالبات,"59,982,040,651",1403.04.16
تیر,ضایعات,سودیکو,"10,000,000,000",1403.04.18
تیر,ضایعات,سودیکو,"30,000,000,000",1403.04.20
تیر,سازه گستر,سازه گستر - مطالبات,"59,618,377,734",1403.04.23
تیر,سازه گستر,سایپا - چک اول خرید دین به سررسید 1403.04.25,"65,600,000,000",1403.04.27
تیر,سازه گستر,سازه گستر - تخصیص scf به سررسید 1403.04.30,"250,000,000,000",1403.04.27
مرداد,سازه گستر,سازه گستر - بدهی بیمه,"119,908,274,722",1403.05.03
مرداد,سازه گستر,سازه گستر - حقوق تیر ماه,"291,397,039,563",1403.05.04
مرداد,سازه گستر,سازه گستر - کسری حقوق,"37,602,888,705",1403.05.04
مرداد,سازه گستر,سایپا - گشایش اعتبار ( بانک صادرات ),"400,000,007,080",1403.05.08
مرداد,سازه گستر,پارس خودرو - از محل مطالبالت سازه گستر,"200,000,000,000",1403.05.22
مرداد,سایر,صنایع مفتولی اشتهارد - جبران کسری چک شماره 44634,"850,000,000",1403.05.25
مرداد,ضایعات,سودیکو,"15,000,000,000",1403.05.29
مرداد,سایپا یدک,سایپا یدک,"10,066,207,818",1403.05.31
شهریور,سازه گستر,سازه گستر - مطالبات,"30,000,000,000",1403.06.01
شهریور,سایپا یدک,واریز طی دوره - سایپا یدک - بازارگاه,"790,000,000",1403.06.01
شهریور,سازه گستر,سازه گستر - حقوق مرداد,"291,918,703,599",1403.06.06
شهریور,سایر,امیر رفیعی - تامین موجودی پیش پرداخت حلال,"750,000,000",1403.06.11
شهریور,سازه گستر,سایپا - از محل مطالبات سازه گستر - چک شماره 141946,"7,000,000,000",1403.06.18
شهریور,ضایعات,سودیکو,"5,000,000,000",1403.06.24
شهریور,سایر,سپهر باستان - پیش پرداخت خرید حلال,"723,292,879",1403.06.25
شهریور,سایر,شرکت نیک و راحت کرج,"240,570,000",1403.06.26
شهریور,سازه گستر,سایپا از محل مطالبات سازه گستر,"200,000,000,000",1403.06.29
مهر,سایر,آزاد سازی سپرده مسدودی ثبت سفارش ارزی,"26,400,000,000",1403.07.01
مهر,سازه گستر,سازه گستر - حقوق شهریور,"292,744,190,835",1403.07.05
مهر,سازه گستر,سازه گستر - مطالبات,"7,255,691,060",1403.07.05
مهر,سازه گستر,سازه گستر - جبران کسری حقوق,"29,919,988,323",1403.07.05
مهر,سازه گستر,سازه گستر - scf مهر,"250,000,000,000",1403.07.07
مهر,سازه گستر,سازه گستر - مطالبات,"19,498,703,504",1403.07.14
مهر,سایپا یدک,واریزی طی دوره - سایپا یدک,"623,009,664",1403.07.14
مهر,سایر,آزاد سازی سپرده مسدودی ثبت سفارش ارزی,"68,800,000,000",1403.07.16
مهر,سازه گستر,سایپا از محل مطالبات سازه گستر - بدهی مالیاتی,"80,000,000,000",1403.07.17
مهر,سازه گستر,سازه گستر - مطالبات,"29,453,035,223",1403.07.17
مهر,ضایعات,سودیکو,"10,000,000,000",1403.07.17
مهر,سایر,حمیدرضا حبیبی - از محل مازاد سنوات واریزی,"200,000,000",1403.07.21
آبان,سازه گستر,سازه گستر - مطالبات,"99,979,890,521",1403.08.01
آبان,سایر,شرکت نیک و راحت کرج,"175,230,000",1403.08.02
آبان,سازه گستر,سازه گستر - مطالبات,"99,999,774,873",1403.08.03
آبان,سازه گستر,سازه گستر - حقوق مهر,"299,905,380,750",1403.08.06
آبان,ضایعات,سودیکو,"7,900,000,000",1403.08.06
آبان,سازه گستر,سازه گستر - کسری حقوق,"39,999,532,005",1403.08.07
آبان,سایر,واریزی متفرقه,"177,016,555",1403.08.09
آبان,سایر,شرکت ارس خودرو دیزل,"2,881,890,000",1403.08.14
آبان,ضایعات,سودیکو,"6,000,000,000",1403.08.15
آبان,سایر,قالب های بزرگ صنعتی سایپا,"5,000,000,000",1403.08.15
آبان,سایر,شرکت سمن آذین,"165,000,000",1403.08.19
آبان,سازه گستر,سازه گستر - مطالبات,"210,999,890,611",1403.08.24
آبان,سازه گستر,سازه گستر - مطالبات,"6,795,267,339",1403.08.24
آبان,سازه گستر,سازه گستر - مطالبات,"6,916,681,856",1403.08.24
آبان,سایر,خرید دین - چک شماره 161176 - سررسید 1403.08.25,"62,500,000,000",1403.08.26
آبان,سازه گستر,سازه گستر - scf آبان ,"150,000,000,000",1403.08.28
آذر,سازه گستر,سازه گستر - حقوق آبان,"300,000,000,000",1403.09.05
آذر,سازه گستر,سازه گستر - کسری حقوق,"39,999,488,404",1403.09.06
آذر,ضایعات,سودیکو,"8,000,000,000",1403.09.11
آذر,سازه گستر,سازه گستر - مطالبات,"226,999,535,717",1403.09.21
آذر,سایپا یدک,واریز طی دوره - سایپا یدک - بازارگاه,"885,000,000",1403.09.24
آذر,ضایعات,سودیکو,"4,000,000,000",1403.09.27
آذر,سایر,عودت مبلغ پیش پرداخت خرید حلال,"769,726,363",1403.09.28
دی,سازه گستر,سازه گستر - گرامیداشت روز زن,"1,978,858,438",1403.10.04
دی,سازه گستر,سازه گستر - حقوق آذر,"300,000,000,000",1403.10.08
دی,سازه گستر,سازه گستر - کسری جبران حقوق,"39,999,471,096",1403.10.08
دی,زامیاد,زامیاد,"892,819,200",1403.10.10
دی,سازه گستر,سازه گستر - مواد فوم,"49,999,481,666",1403.10.11
دی,سازه گستر,سازه گستر - مطالبات,"149,900,867,181",1403.10.11
دی,سازه گستر,سازه گستر - مطالبات,"24,999,551,848",1403.10.13
دی,سازه گستر,سازه گستر - مطالبات,"39,999,634,367",1403/10/16
دی,سایر,شرکت نیک و راحت کرج,"65,780,000",1403.10.17
دی,ضایعات,سودیکو,"7,000,000,000",1403.10.17
دی,ضایعات,سودیکو - پیش پرداخت مزایده 890 تن ورق,"100,000,000,000",1403.10.24
دی,سازه گستر,سازه گستر - گرامیداشت روز مرد,"19,999,658,602",1403.10.24
دی,سایپا یدک,سایپا یدک - چک شماره 62258 - از محل 14 چک دریافتی,"509,289,000",1403.10.26
دی,سایپا یدک,سایپا یدک - چک شماره 876243 - از محل 14 چک دریافتی,"715,975,920",1403.10.27
دی,سازه گستر,سازه گستر - مطالبات,"25,355,860,331",1403.10.27
دی,سایپا یدک,سایپا یدک - چک شماره 389825 - از محل 14 چک دریافتی,"958,560,000",1403.10.30
دی,سایپا یدک,سایپا یدک - چک شماره 745577 - از محل 14 چک دریافتی,"835,461,000",1403.10.30
بهمن,سازه گستر,سازه گستر - چک شماره 141399 سایپا,"50,000,000,000",1403.11.01
بهمن,سایپا یدک,سایپا یدک - چک شماره 743476,"752,269,650",1403.11.01
بهمن,سازه گستر,سازه گستر - مطالبات,"49,999,597,230",1403.11.01
بهمن,ضایعات,سودیکو - از محل مزایده 890 تن ورق,"50,000,000,000",1403.11.02
بهمن,سایر,مجتمع صنعتی پیلسان,"289,070,800",1403.11.03
بهمن,سایر,بهمن موتور,"1,497,719,592",1403.11.03
بهمن,ضایعات,سودیکو - از محل مزایده 890 تن ورق,"40,000,000,000",1403.11.04
بهمن,سازه گستر,سازه گستر - جبران کسری حقوق دی,"50,000,000,000",1403.11.08
بهمن,سازه گستر,سایپا,"992,179,999",1403.11.08
بهمن,سازه گستر,سازه گستر - حقوق دی,"299,999,573,752",1403.11.08
بهمن,سازه گستر,سازه گستر - حقوق دی,"15,227,585,417",1403.11.08
بهمن,ضایعات,سودیکو - از محل مزایده 890 تن ورق,"20,000,000,000",1403.11.08
بهمن,سایر,شرکت فرنیا آذین,"2,508,194,600",1403.11.14
بهمن,سازه گستر,سایپا - از محل مطالبات سازه گستر - چک شماره 141594,"50,000,000,000",1403.11.16
بهمن,سازه گستر,سایپا - از محل مطالبات سازه گستر - چک شماره 141563,"50,000,000,000",1403.11.16
بهمن,ضایعات,سودیکو - از محل مطالبات,"10,000,000,000",1403.11.16
بهمن,ضایعات,سودیکو - از محل مزایده 890 تن ورق,"69,000,000,000",1403.11.16
بهمن,سازه گستر,سازه گستر - مطالبات,"29,999,954,399",1403.11.18
بهمن,سایر,ایتراک - خدمات آزمایشگاهی,"133,966,600",1403.11.23
بهمن,سازه گستر,سازه گستر - مطالبات,"149,997,924,445",1403.11.23
بهمن,سایر,شرکت فنرسازی زر - سنوات بهرودی,"651,950,219",1403.11.25
بهمن,سایر,خرید دین - چک شماره 161179 - سررسید 1403.11.25,"62,500,000,000",1403.11.27
بهمن,ضایعات,سودیکو - از محل مطالبات,"15,000,000,000",1403.11.29
بهمن,سازه گستر,سازه گستر - بدهی مالیاتی,"399,999,900,181",1403.11.30
بهمن,سازه گستر,سازه گستر - سایپا چک شماره 823030 - سنوات پرسنل,"50,000,000,000",1403.11.30
اسفند,ضایعات,سودیکو - از محل مطالبات,"10,000,000,000",1403.12.05
اسفند,سازه گستر,سازه گستر - سایپا چک شماره 823031 - سنوات پرسنل,"50,000,000,000",1403.12.06
اسفند,سازه گستر,سازه گستر - حقوق بهمن 1403,"314,985,484,801",1403.12.07
اسفند,سازه گستر,سازه گستر - سایپا چک شماره 823031 - سنوات پرسنل,"50,000,000,000",1403.12.08
اسفند,ضایعات,سودیکو,"4,900,000,000",1403.12.08
اسفند,سایر,آزاد سازی بخشی از 35درصد سپرده نقدی ثبت سفارش 23841411,"35,000,000,000",1403.12.09
اسفند,ضایعات,سودیکو,"24,000,000,000",1403.12.12
اسفند,سایر,انتقالی از بانک گردشگری به بانک مهر - بستن حساب,"217,520,000",1403.12.13
اسفند,سازه گستر,سازه گستر - عیدی,"241,999,792,142",1403.12.13
اسفند,سایر,شرکت نیک و راحت کرج,"157,630,000",1403.12.13
اسفند,ضایعات,سودیکو,"15,000,000,000",1403.12.14
اسفند,سازه گستر,سازه گستر - سایپا چک شماره 823031 - سنوات پرسنل,"50,000,000,000",1403.12.16
اسفند,سایپا یدک,سایپا یدک - چک شماره 14689,"950,000,000",1403.12.16
اسفند,سایپا یدک,واریز طی دوره - سایپا یدک - بازارگاه,"510,000,000",1403.12.16
اسفند,سایپا یدک,سایپا یدک - چک شماره 104371,"1,060,000,000",1403.12.16
اسفند,سایپا یدک,سایپا یدک - چک شماره 46813,"7,952,751,000",1403.12.19
اسفند,سازه گستر,سازه گستر - مطالبات,"69,989,343,291",1403.12.20
اسفند,سایپا یدک,سایپا یدک - چک شماره 127746,"2,920,000,000",1403.12.21
اسفند,سایپا یدک,سایپا یدک - چک شماره 104371,"700,000,000",1403.12.21
اسفند,سایپا یدک,سایپا یدک - چک شماره 601457,"10,055,602,260",1403.12.21
اسفند,سایر,مجتمع صنعتی پیلسان,"1,055,690,000",1403.12.21
اسفند,سازه گستر,سازه گستر - مطالبات,"59,028,259,794",1403.12.22
اسفند,ضایعات,سودیکو ,"200,000,000,000",1403.12.23
اسفند,سایپا یدک,سایپا یدک - چک شماره 104372,"900,000,000",1403.12.23
اسفند,ضایعات,سودیکو,"150,000,000,000",1403.12.25
اسفند,سایر,خرید دین - چک شماره 161180 - سررسید 1403.12.25,"62,500,000,000",1403.12.25
اسفند,سایپا یدک,سایپا یدک - چک شماره 876245,"715,975,920",1403.12.26
اسفند,سایپا یدک,سایپا یدک - چک شماره 705080,"1,000,000,000",1403.12.26
اسفند,سازه گستر,سازه گستر - مطالبات,"45,777,849,283",1403.12.26
اسفند,سازه گستر,سازه گستر - مطالبات,"34,222,005,354",1403.12.26
اسفند,سازه گستر,سایپا  - چک شماره 823397 - سنوات پرسنل,"50,000,000,000",1403.12.27
اسفند,سازه گستر,سازه گستر - حقوق اسفند,"299,999,288,047",1403.12.27
اسفند,ضایعات,سودیکو,"97,000,000,000",1403.12.27
اسفند,سازه گستر,سایپا  - چک شماره 823398 - سنوات پرسنل,"50,000,000,000",1403.12.28
فروردین,سایپا,سایپا از محل مطالبات سازه گستر,"100,000,000,000",1404.01.05
فروردین,سایر,حمیدرضا حبیبی - وصول چک شماره 889638,"400,000,000",1404.01.09
فروردین,ضایعات,سودیکو از محل مطالبات,"1,800,000,000",1404.01.21
فروردین,سایپا,سایپا - از محل مطالبات - اصلاح عناوین شغلی,"100,000,000,000",1404.01.25
فروردین,سایپا,سایپا - از محل مطالبات - سنوات پرسنل,"50,000,000,000",1404.01.25
فروردین,سازه گستر,سازه گستر - مطالبات,"41,748,925,308",1404.01.27
فروردین,سازه گستر,سازه گستر - مطالبات,"19,999,568,779",1404.01.30
اردیبهشت,سازه گستر,سازه گستر - مطالبات,"69,999,402,662",1404.02.01
اردیبهشت,سایپا یدک,سایپا یدک,"10,000,000,000",1404.02.01
اردیبهشت,ضایعات,سودیکو از محل مطالبات,"3,000,000,000",1404.02.02
اردیبهشت,سایپا,سایپا - سنوات پرسنل- چک شماره 821779,"50,000,000,000",1404.02.07
اردیبهشت,سایر,سیستم های صندلی پارس - خدمات آزمایشگاهی,"3,400,000,000",1404.02.10
اردیبهشت,سازه گستر,سازه گستر - حقوق فروردین,"522,998,505,150",1404.02.10
اردیبهشت,سازه گستر,سازه گستر - SCF - اردیبهشت,"50,000,000,000",1404.02.14
اردیبهشت,ضایعات,سودیکو از محل مطالبات,"1,300,000,000",1404.02.15
اردیبهشت,سازه گستر,سازه گستر - SCF - اردیبهشت,"100,000,000,000",1404.02.21
اردیبهشت,ضایعات,سودیکو از محل مطالبات,"7,000,000,000",1404.02.21
اردیبهشت,سازه گستر,سازه گستر - بدهی مالیاتی,"299,999,643,876",1404.02.24
اردیبهشت,ضایعات,سودیکو از محل مطالبات,"2,300,000,000",1404.02.28
اردیبهشت,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت اول آرمان موتور,"17,643,120,000",1404.02.30
اردیبهشت,سایپا,سایپا - سنوات پرسنل,"50,000,000,000",1404.02.31
خرداد,سازه گستر,سازه گستر - SCF - خرداد,"100,000,000,000",1404.03.07
خرداد,سازه گستر,سازه گستر - 50درصد حقوق اردیبهشت,"261,998,795,429",1404.03.11
خرداد,سایر,امید کام صنعت - بابت استفاده از لیفتراک شرکت,"220,000,000",1404.03.13
خرداد,ضایعات,سودیکو از محل مطالبات,"30,000,000,000",1404.03.13
خرداد,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت دوم آرمان موتور,"17,643,120,000",1404.03.17
خرداد,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت سوم آرمان موتور,"17,643,120,000",1404.03.20
خرداد,سازه گستر,سازه گستر - 50درصد حقوق اردیبهشت,"209,000,000,000",1404.03.21
خرداد,سایپا,سایپا - از محل مطالبات سازه گستر - چک اول 25 میلیارد,"250,000,000,000",1404.03.21
خرداد,سازه گستر,سازه گستر - مطالبات,"103,300,000,000",1404.03.28
تیر,سایر,مبشر نور دریا - متفرقه,"811,064,276",1404.04.02
تیر,سازه گستر,سازه گستر - بخشی از حقوق خرداد,"224,598,440,000",1404.04.08
تیر,سازه گستر,سازه گستر - تتمه حقوق خرداد,"125,071,200,000",1404.04.17
تیر,ضایعات,سودیکو از محل مطالبات,"5,000,000,000",1404.04.17
تیر,سازه گستر,سازه گستر - مطالبات,"20,000,000,000",1404.04.18
تیر,سایپا,سایپا - سنوات پرسنل- چک شماره 815350,"50,000,000,000",1404.04.21
تیر,سازه گستر,سازه گستر - مطالبات,"20,000,000,000",1404.04.23
تیر,سایپا,سایپا - از محل مطالبات سازه گستر - چک دوم 25 میلیارد,"250,000,000,000",1404.04.24
تیر,سازه گستر,سازه گستر - مطالبات,"80,000,000,000",1404.04.25
تیر,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت چهارم آرمان موتور,"17,633,000,000",1404.04.28
تیر,سایر,سیستم های صندلی پارس - خدمات آزمایشگاهی,"4,000,000,000",1404.04.30
تیر,سایر,سیستم های صندلی پارس - خدمات آزمایشگاهی,"2,000,000,000",1404.04.30
مرداد,سایپا,سایپا - سنوات پرسنل- چک شماره 815385,"50,000,000,000",1404.05.04
مرداد,ضایعات,سودیکو از محل مطالبات,"4,000,000,000",1404.05.04
مرداد,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت پنجم آرمان موتور,"17,633,000,000",1404.05.04
مرداد,سایپا,سایپا - سنوات پرسنل- چک شماره 133644,"50,000,000,000",1404.05.06
مرداد,سایر,شرکت خودروسازان دیزلی آذربایجان,"971,828,000",1404.05.07
مرداد,سازه گستر,سازه گستر - حقوق تیر,"400,000,000,000",1404.05.15
مرداد,سازه گستر,سازه گستر - حقوق تیر,"2,955,996,675",1404.05.15
مرداد,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت ششم آرمان موتور,"17,668,640,000",1404.05.18
مرداد,سایپا,سایپا - از محل مطالبات سازه گستر - چک سوم 25 میلیارد,"250,000,000,000",1404.05.19
مرداد,سایر,شرکت خودروسازان بونیز - خدمات آزمایشگاهی,"1,249,248,000",1404.05.22
مرداد,آرمان موتور,دریافتی بابت LC - بانک شهر - پارت هفتم آرمان موتور,"15,318,380,000",1404.05.25
مرداد,سایر,سیستم های صندلی پارس - خدمات آزمایشگاهی,"5,102,774,000",1404.05.28
مرداد,سازه گستر,سازه گستر -  پرداخت مستقیم به امور مالیاتی - چک شماره 584071,"73,010,904,666",-----
مرداد,سازه گستر,سازه گستر -  پرداخت مستقیم به امور مالیاتی - چک شماره 584072,"114,847,706,997",-----
مرداد,سازه گستر,سازه گستر -  پرداخت مستقیم به امور مالیاتی - چک شماره 584073,"24,660,927,098",-----
مرداد,سازه گستر,سازه گستر -  پرداخت مستقیم به امور مالیاتی - چک شماره 584074,"237,749,968,110",-----
مرداد,سازه گستر,سازه گستر -  پرداخت مستقیم به امور مالیاتی - چک شماره 584075,"86,836,954,539",-----
شهریور,سایر,عو.دت مبلغ رفع تعهد ارزی - بانک تجارت,"7,750,866,778",1404.06.05
شهریور,سایر,عو.دت مبلغ رفع تعهد ارزی - بانک تجارت,"291,566,678",1404.06.05
شهریور,سایر,شرکت خودروسازان دیزلی آذربایجان,"971,828,000",1404.06.09
شهریور,سایر,حمیدرضا حبیبی - وصول چک شماره 889639,"400,000,000",1404.06.09
شهریور,سازه گستر,سازه گستر - شارژ حساب وکالتی جهت خرید از بورس - ایزوسیانات,"29,999,938,396",1404.06.11
شهریور,سایپا,سایپا - از محل مطالبات سازه گستر - چک چهارم 25 میلیارد,"250,000,000,000",1404.06.12
شهریور,سایر,شرکت خودروسازان دیزلی آذربایجان,"757,328,000",1404.06.12
شهریور,سازه گستر,سازه گستر - 50درصد اول حقوق مرداد,"199,999,979,810",1404.06.16
شهریور,سازه گستر,سازه گستر - مطالبات (پروژه),"15,000,000,000",1404.06.17
شهریور,سایر,شرکت نیک و راحت کرج,"276,991,000",1404.06.18
شهریور,سایر,مجنمع صنعتی پیلسان,"1,921,355,800",1404.06.18
شهریور,سازه گستر,سازه گستر - 50درصد دوم حقوق مرداد,"188,255,992,335",1404.06.20
شهریور,سایپا,سایپا - از محل مطالبات سازه گستر - سنوات پرسنل,"50,000,000,000",1404.06.24
شهریور,سایر,شرکت نیک و راحت کرج,"315,887,000",1404.06.25
شهریور,سایر,شرکت آریش خودرو,"39,039,000",1404.06.26
مهر,سازه گستر,اوراق گام شهریور 1404,"1,250,000,000,000",1404.07.01
مهر,سایپا,سایپا - از محل مطالبات سازه گستر - سنوات پرسنل - چک 815045,"120,000,000,000",1404.07.02
مهر,آرمان موتور,پارت اول lc آرمان موتور - مرحله دوم,"17,648,400,000",1404.07.05
مهر,آرمان موتور,پارت دوم lc آرمان موتور - مرحله دوم,"12,845,140,000",1404.07.06
مهر,آرمان موتور,پارت سوم lc آرمان موتور - مرحله دوم,"7,128,000,000",1404.07.08
مهر,سایپا,سایپا - از محل مطالبات سازه گستر - چک پنجم 25 میلیارد,"250,000,000,000",1404.07.08
مهر,سازه گستر,سازه گستر - 50درصد حقوق شهریور,"210,073,918,401",1404.07.10
مهر,ضایعات,سودیکو - از محل مطالبات,"6,000,000,000",1404.07.15
مهر,سایر,شرکت آریش خودرو,"26,026,000",1404.07.14
مهر,سازه گستر,سازه گستر - 50درصد حقوق شهریور,"209,999,856,698",1404.07.21
مهر,سازه گستر,سازه گستر - از محل مطالبات,"129,999,989,289",1404.07.24
مهر,زامیاد,زامیاد,"10,000,000,000",1404.07.24
مهر,ضایعات,سودیکو - از محل مطالبات,"6,000,000,000",1404.07.27
مهر,زامیاد,زامیاد ,"20,000,000,000",1404.07.27
مهر,سازه گستر,سازه گستر - از محل مطالبات,"20,000,000,000",1404.07.27
مهر,سازه گستر,سازه گستر - مطالبات,"59,999,921,911",1404.07.30
آبان,سازه گستر,سازه گستر - مطالبات,"29,999,974,958",1404.08.01
آبان,سایر,عو.دت مبلغ رفع تعهد ارزی - بانک تجارت - ثبت سفارش 23841411,"3,500,000,000",1404.08.04
آبان,سایر,سیستم های صندلی پارس - چک شماره 86152 بانک ملت (انتقال به طیف سایپا),"5,208,646,300",1404.08.20
آبان,سازه گستر,سازه گستر - مطالبات,"9,999,994,079",1404.08.07
آبان,ضایعات,سودیکو,"1,400,000,000",1404.08.07
آبان,آرمان موتور,پارت چهارم LC آرمان موتور - مرحله دوم,"7,306,200,000",1404.08.07
آبان,سازه گستر,سازه گستر - از محل مطالبات,"169,999,905,955",1404.08.08
آبان,سازه گستر,سازه گستر - حقوق مهر,"352,999,932,412",1404.08.11
آبان,ضایعات,سودیکو - از محل مطالبات,"14,000,000,000",1404.08.11
آبان,سایپا,سایپا - از محل مطالبات سازه گستر - سنوات (جایگزین وام رسالت),"110,000,000,000",1404.08.12
آبان,ضایعات,سودیکو - از محل مطالبات,"36,000,000,000",1404.08.13
آبان,آرمان موتور,پارت پنجم LC آرمان موتور - مرحله دوم,"17,648,400,000",1404.08.13
آبان,زامیاد,زامیاد - بدهی مالیاتی,"10,000,000,000",1404.08.13
آبان,زامیاد,زامیاد - بدهی مالیاتی,"92,000,000,000",1404.08.13
آبان,زامیاد,زامیاد,"8,000,000,000",1404.08.14
آبان,زامیاد,زامیاد,"10,000,000,000",1404.08.14
آبان,سایر,شرکت ایران خودرو دیزل,"207,779,000",1404.08.18
آبان,آرمان موتور,پارت ششم LC آرمان موتور - مرحله دوم,"17,648,400,000",1404.08.18
آبان,ضایعات,سودیکو - از محل مطالبات,"25,000,000,000",1404.08.19
آبان,سایر,سیستم های صندلی پارس,"886,750,150",1404.08.24
آبان,سازه گستر,سازه گستر - مطالبات,"19,999,874,605",1404.08.27
آبان,آرمان موتور,پارت هفتم LC آرمان موتور - مرحله دوم,"17,648,400,000",1404.08.27
آبان,سازه گستر,سازه گستر - مطالبات,"129,999,902,936",1404.08.29
آذر,زامیاد,زامیاد,"2,063,581,520",1404.09.02
آذر,سایر,بیمه ملت - خسارت,"100,000,000",1404.09.02
آذر,سازه گستر,سازه گستر - مطالبات,"29,999,891,386",1404.09.04
آذر,سایپا,سایپا - از محل مطالبات سازه گستر - سنوات پرسنل,"130,000,000,000",1404.09.05
آذر,سازه گستر,سازه گستر - حقوق آبان ماه ,"367,999,514,432",1404.09.06
آذر,سازه گستر,سازه گستر - مطالبات,"9,999,967,555",1404.09.06
آذر,آرمان موتور,پارت  هشتم LC آرمان موتور - مرحله دوم,"17,643,120,000",1404.09.08
آذر,سایر,عودت پیش پرداخت خرید حلال از پالایش نفت اصفهان,"290,830,160",1404.09.09
آذر,سایر,شرکت نیک و راحت کرج,"946,517,000",1404.09.09
آذر,سایپا,سایپا - از محل مطالبات سازه گستر - سنوات پرسنل,"50,000,000,000",1404.09.13`;

        // --- 2. COMPONENTS ---
        const Card = ({ title, value, subtext, icon: Icon, alertLevel = 'normal', borderLeft = false }) => {
            const schemes = {
                normal: 'bg-white border-blue-500 text-slate-800',
                warning: 'bg-amber-50 border-amber-500 text-amber-900',
                critical: 'bg-red-50 border-red-600 text-red-900',
                success: 'bg-emerald-50 border-emerald-500 text-emerald-900',
                indigo: 'bg-white border-indigo-500 text-slate-800', // Added for new KPI
                amber: 'bg-white border-amber-500 text-slate-800',   // Added for new KPI
            };
            const borderClass = borderLeft ? 'border-l-4' : 'border-r-4';
            return React.createElement('div', { className: `p-5 rounded-xl shadow-sm ${borderClass} ${schemes[alertLevel]} flex justify-between items-start hover:shadow-md transition-shadow` },
                React.createElement('div', null,
                    React.createElement('h3', { className: "text-xs font-bold uppercase tracking-wide opacity-70 mb-1" }, title),
                    React.createElement('div', { className: "text-2xl font-black" }, value),
                    subtext && React.createElement('div', { className: "text-xs mt-2 font-medium opacity-80" }, subtext)
                ),
                Icon && React.createElement(Icon, { className: "w-8 h-8 opacity-20" })
            );
        };

        const Table = ({ headers, rows }) => {
            return React.createElement('div', { className: "overflow-x-auto rounded-lg border border-slate-200" },
                React.createElement('table', { className: "w-full text-sm text-right bg-white" },
                    React.createElement('thead', { className: "bg-slate-100 text-slate-600 font-bold" },
                        React.createElement('tr', null, headers.map((h, i) => React.createElement('th', { key: i, className: "p-3 whitespace-nowrap" }, h)))
                    ),
                    React.createElement('tbody', { className: "divide-y divide-slate-100" },
                        rows.map((row, i) => 
                            React.createElement('tr', { key: i, className: "hover:bg-slate-50" },
                                row.map((cell, j) => React.createElement('td', { key: j, className: "p-3" }, cell))
                            )
                        )
                    )
                )
            );
        };

        // --- Chart.js Wrapper Component ---
        const ChartCanvas = ({ type, data, options, height = "100%" }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (!canvasRef.current) return;

                // Destroy existing chart to prevent canvas reuse error
                if (chartRef.current) {
                    chartRef.current.destroy();
                }

                const ctx = canvasRef.current.getContext('2d');
                chartRef.current = new Chart(ctx, {
                    type,
                    data,
                    options: {
                        ...options,
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            ...options.plugins,
                            tooltip: {
                                bodyFont: { family: 'Vazirmatn' },
                                titleFont: { family: 'Vazirmatn' },
                                ...options.plugins?.tooltip
                            },
                            legend: {
                                labels: { font: { family: 'Vazirmatn' } },
                                ...options.plugins?.legend
                            }
                        },
                        scales: options.scales // Pass scales directly
                    }
                });

                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                };
            }, [type, data, options]); // Re-render when data/options change

            return React.createElement('div', { style: { height: height, width: '100%' } }, 
                React.createElement('canvas', { ref: canvasRef })
            );
        };

        const Dashboard = () => {
            const [activeTab, setActiveTab] = useState('liquidity');
            const [showReport, setShowReport] = useState(false);
            const formatNumber = (num) => new Intl.NumberFormat('fa-IR').format(num);
            const formatBillion = (num) => new Intl.NumberFormat('fa-IR', { maximumFractionDigits: 2 }).format(num / 1000000000);

            // --- Dynamic Dashboard State ---
            const [dynamicData, setDynamicData] = useState([]);
            const [employerFilter, setEmployerFilter] = useState('all');
            const [sortConfig, setSortConfig] = useState({ field: 'id', dir: 'asc' });

            // --- CSV Parsing Logic ---
            const parseCSV = (csvText) => {
                const rows = [];
                const lines = csvText.split('\n');
                let startIndex = lines[0].includes('کارفرما') ? 1 : 0;

                for (let i = startIndex; i < lines.length; i++) {
                    let line = lines[i].trim();
                    if (!line) continue;
                    const parts = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if (!parts || parts.length < 4) continue;

                    let monthName = parts[0].trim();
                    let source = parts[1].trim();
                    let desc = parts[2].trim();
                    let amountStr = parts[3].replace(/"/g, '').replace(/,/g, '');
                    let dateStr = parts[4] ? parts[4].trim() : '';
                    
                    let year = 1404;
                    if (dateStr.startsWith('1403')) year = 1403;
                    else if (dateStr.startsWith('1404')) year = 1404;
                    
                    let amount = parseFloat(amountStr);
                    if (isNaN(amount)) continue;

                    rows.push({
                        id: rows.length + 1,
                        date: dateStr,
                        year: year,
                        month: monthName,
                        source: source,
                        desc: desc,
                        amount: amount / 1000000000, // Store as Billion
                        rawAmount: amount
                    });
                }
                return rows;
            };

            // Load initial data
            useEffect(() => {
                const data = parseCSV(initialCSVData);
                setDynamicData(data);
            }, []);

            // Handle File Upload
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const text = e.target.result;
                    const data = parseCSV(text);
                    setDynamicData(data);
                    alert('فایل جدید با موفقیت بارگذاری و تحلیل شد.');
                };
                reader.readAsText(file);
            };

            // Sorting Logic
            const handleSort = (field) => {
                const newDir = sortConfig.field === field && sortConfig.dir === 'asc' ? 'desc' : 'asc';
                setSortConfig({ field, dir: newDir });
            };

            const sortedData = useMemo(() => {
                return [...dynamicData].sort((a, b) => {
                    let valA = a[sortConfig.field];
                    let valB = b[sortConfig.field];
                    if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = valB.toLowerCase(); }
                    if (valA < valB) return sortConfig.dir === 'asc' ? -1 : 1;
                    if (valA > valB) return sortConfig.dir === 'asc' ? 1 : -1;
                    return 0;
                });
            }, [dynamicData, sortConfig]);


            // --- TAB 1: LIQUIDITY ---
            const renderLiquidityTab = () => (
                React.createElement('div', { className: "space-y-8 animate-fade-in" },
                    // Alerts
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" },
                        React.createElement(Card, { title: "نقدینگی مسدود بانکی", value: "۳۰,۲۱۷ م.ر", subtext: "عمدتاً بانک شهر و مهر", icon: Ban, alertLevel: "warning" }),
                        React.createElement(Card, { title: "کسری نقدینگی آذر", value: "۸۸۸,۰۰۰ م.ر", subtext: "پیک هزینه: حقوق + پاداش", icon: TrendingDown, alertLevel: "critical" }),
                        React.createElement(Card, { title: "تعداد حساب‌های مسدود", value: "۱۲ حساب", subtext: "از مجموع ۲۱ حساب", icon: Activity, alertLevel: "normal" }),
                        React.createElement(Card, { title: "وابستگی به اوراق گام", value: "۱۴٪", subtext: "ریسک نقدشوندگی", icon: FileText, alertLevel: "normal" })
                    ),
                    // Charts
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                        React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" },
                            React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-6 flex items-center gap-2" }, React.createElement(TrendingUp, {className:"w-5 h-5"}), "پیش‌بینی جریان خروجی نقدینگی"),
                            React.createElement('div', { className: "h-72" },
                                React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                                    React.createElement(AreaChart, { data: forecastData },
                                        React.createElement('defs', null, React.createElement('linearGradient', { id: "colorTotal", x1: "0", y1: "0", x2: "0", y2: "1" }, React.createElement('stop', { offset: "5%", stopColor: "#ef4444", stopOpacity: 0.8 }), React.createElement('stop', { offset: "95%", stopColor: "#ef4444", stopOpacity: 0 }))),
                                        React.createElement(CartesianGrid, { strokeDasharray: "3 3", vertical: false }),
                                        React.createElement(XAxis, { dataKey: "month" }),
                                        React.createElement(YAxis),
                                        React.createElement(Tooltip, { formatter: (value) => formatNumber(value) }),
                                        React.createElement(Area, { type: "monotone", dataKey: "total", stroke: "#dc2626", fill: "url(#colorTotal)", name: "مجموع مصارف" })
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" },
                            React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-6 flex items-center gap-2" }, React.createElement(Activity, {className:"w-5 h-5"}), "ترکیب منابع ورودی"),
                            React.createElement('div', { className: "h-72" },
                                React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                                    React.createElement(PieChart, null,
                                        React.createElement(Pie, { data: sourcesData, cx: "50%", cy: "50%", innerRadius: 70, outerRadius: 90, paddingAngle: 5, dataKey: "value" }, sourcesData.map((entry, index) => React.createElement(Cell, { key: `cell-${index}`, fill: entry.fill }))),
                                        React.createElement(Tooltip, { formatter: (value) => formatNumber(value) }),
                                        React.createElement(Legend, { layout: "vertical", verticalAlign: "middle", align: "right" })
                                    )
                                )
                            )
                        )
                    ),
                    // Bar Chart
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" },
                        React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-4 flex items-center gap-2" }, React.createElement(Ban, {className:"w-5 h-5"}), "توزیع منابع حبس شده (میلیون ریال)"),
                        React.createElement('div', { className: "h-80" },
                            React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                                React.createElement(BarChart, { 
                                    data: blockedFundsData, 
                                    layout: "vertical", 
                                    margin: { top: 5, right: 10, left: 180, bottom: 5 }, 
                                    barSize: 40 
                                },
                                    React.createElement(CartesianGrid, { strokeDasharray: "3 3", horizontal: false }),
                                    React.createElement(XAxis, { type: "number", reversed: true, hide: true }),
                                    React.createElement(YAxis, { 
                                        dataKey: "bank", 
                                        type: "category", 
                                        orientation: "right", 
                                        width: 150, 
                                        tick: {fontSize: 14, fontWeight: 700, fill: '#1e293b'}, 
                                        tickLine: false 
                                    }),
                                    React.createElement(Tooltip, { formatter: (value) => formatNumber(value), cursor: {fill: '#f1f5f9'}, contentStyle: {direction: 'rtl'} }),
                                    React.createElement(Bar, { dataKey: "amount", radius: [4, 0, 0, 4] },
                                        blockedFundsData.map((entry, index) => React.createElement(Cell, { key: `cell-${index}`, fill: entry.status === 'مسدود' ? '#ef4444' : '#f97316' })),
                                        React.createElement(LabelList, { 
                                            dataKey: "amount", 
                                            position: "left", 
                                            formatter: (val) => formatNumber(val), 
                                            style: { fontSize: '14px', fontWeight: 'bold', fill: '#1e293b' } 
                                        })
                                    )
                                )
                            )
                        )
                    )
                )
            );

            // --- TAB 2: PAYABLE DOCUMENTS ---
            const renderPayableDocs = () => {
                const totalAmount = payableDocsData.reduce((acc, curr) => acc + curr.amount, 0);
                const totalReg = payableDocsData.filter(d => d.status === 'ثبت شده').reduce((acc, curr) => acc + curr.amount, 0);
                const totalUnreg = payableDocsData.filter(d => d.status.includes('نشده')).reduce((acc, curr) => acc + curr.amount, 0);
                const returnedDocs = payableDocsData.filter(d => d.status === 'برگشتی');
                const totalReturned = returnedDocs.reduce((acc, curr) => acc + curr.amount, 0);
                
                const monthlyTotals = {};
                payableDocsData.forEach(item => {
                    const monthPart = item.date.split('.')[1];
                    const monthNum = parseInt(monthPart);
                    if (!monthlyTotals[monthNum]) { monthlyTotals[monthNum] = { sum: 0, items: [] }; }
                    monthlyTotals[monthNum].sum += item.amount;
                    monthlyTotals[monthNum].items.push(item);
                });
                
                const persianMonths = ["", "فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"];
                const sortedMonthKeys = Object.keys(monthlyTotals).sort((a,b)=>a-b);

                return React.createElement('div', { className: "space-y-8 animate-fade-in" },
                    // KPI Cards
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" },
                        React.createElement(Card, { title: "کل تعهدات ۱۴۰۴", value: `${formatBillion(totalAmount)}`, subtext: "میلیارد ریال", icon: Briefcase, alertLevel: "normal", borderLeft: true }),
                        React.createElement(Card, { title: "ثبت شده (قطعی)", value: `${formatBillion(totalReg)}`, subtext: "نیاز فوری", icon: CheckCircle, alertLevel: "success", borderLeft: true }),
                        React.createElement(Card, { title: "ثبت نشده (شناور)", value: `${formatBillion(totalUnreg)}`, subtext: "قابل مذاکره", icon: Activity, alertLevel: "warning", borderLeft: true }),
                        React.createElement(Card, { title: "چک‌های برگشتی", value: `${formatBillion(totalReturned)}`, subtext: "وضعیت بحرانی", icon: AlertTriangle, alertLevel: "critical", borderLeft: true })
                    ),
                    // Returned Checks Alert Table
                    React.createElement('div', { className: "bg-red-50 rounded-2xl shadow-sm border border-red-100 overflow-hidden" },
                        React.createElement('div', { className: "p-4 bg-red-100 border-b border-red-200 flex items-center gap-2" },
                            React.createElement(AlertTriangle, { className: "h-6 w-6 text-red-700" }),
                            React.createElement('h3', { className: "font-bold text-red-800 text-lg" }, "هشدار: لیست چک‌های برگشتی (اضطراری)")
                        ),
                        React.createElement(Table, {
                            headers: ["ردیف", "ذینفع", "مبلغ (ریال)", "شماره چک", "بانک", "سررسید"],
                            rows: returnedDocs.map((d, i) => [
                                i + 1, d.desc, React.createElement('span', { className: "font-bold" }, formatNumber(d.amount)), d.checkNo, d.bank, React.createElement('span', { className: "text-red-600 font-bold" }, d.date)
                            ])
                        }),
                        React.createElement('div', { className: "p-4 bg-red-100 flex justify-between items-center font-bold text-red-900 border-t border-red-200" },
                            React.createElement('span', null, "جمع کل چک‌های برگشتی:"),
                            React.createElement('span', { className: "text-lg" }, formatNumber(totalReturned) + " ریال")
                        )
                    ),
                    // Detailed List Grouped by Month
                    React.createElement('div', { className: "bg-white rounded-2xl shadow-sm overflow-hidden" },
                        React.createElement('div', { className: "p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50" },
                            React.createElement('h3', { className: "font-bold text-gray-800" }, "ریز اسناد به تفکیک ماه"),
                            React.createElement('div', { className: "text-sm text-gray-500 flex items-center gap-3" },
                                React.createElement('span', { className: "flex items-center gap-1" }, React.createElement('span', { className: "w-2 h-2 bg-red-500 rounded-full" }), "برگشتی"),
                                React.createElement('span', { className: "flex items-center gap-1" }, React.createElement('span', { className: "w-2 h-2 bg-green-500 rounded-full" }), "ثبت شده"),
                                React.createElement('span', { className: "flex items-center gap-1" }, React.createElement('span', { className: "w-2 h-2 bg-yellow-500 rounded-full" }), "ثبت نشده")
                            )
                        ),
                        React.createElement('div', { className: "divide-y divide-gray-100" },
                            sortedMonthKeys.map(monthNum => {
                                const mData = monthlyTotals[monthNum];
                                const monthName = persianMonths[monthNum];
                                return React.createElement('div', { key: monthNum, className: "p-4 border-b border-gray-100 last:border-0" },
                                    React.createElement('div', { className: "flex items-center gap-3 mb-4 mt-2 bg-blue-50 p-3 rounded-lg border-r-4 border-blue-500" },
                                        React.createElement('div', { className: "text-blue-800 font-bold text-lg flex items-center gap-2" },
                                            React.createElement(Calendar, { className: "w-5 h-5" }),
                                            monthName + " ۱۴۰۴"
                                        ),
                                        React.createElement('div', { className: "text-gray-600 text-sm mr-auto" },
                                            "جمع کل: ", React.createElement('span', { className: "font-black text-gray-900 text-base" }, formatBillion(mData.sum)), " میلیارد ریال"
                                        )
                                    ),
                                    mData.items.sort((a,b) => a.date.localeCompare(b.date)).map(item => {
                                        let statusClass = 'registered';
                                        let rowHighlight = '';
                                        let statusIcon = null;
                                        if(item.status === 'برگشتی') {
                                            statusClass = 'returned';
                                            rowHighlight = 'bg-red-50 border-r-4 border-red-600';
                                            statusIcon = React.createElement(AlertTriangle, { className: "w-4 h-4 text-red-600" });
                                        } else if(item.status.includes('نشده')) {
                                            statusClass = 'not-registered';
                                            rowHighlight = item.amount > 50000000000 ? 'bg-yellow-50/50 border-r-2 border-yellow-400' : '';
                                        }

                                        return React.createElement('div', { key: item.id, className: `flex flex-col md:flex-row justify-between items-start md:items-center py-3 border-b border-gray-100 last:border-0 ${rowHighlight} p-4 transition-colors mb-2 rounded hover:bg-gray-50` },
                                            React.createElement('div', { className: "flex-1 mb-2 md:mb-0" },
                                                React.createElement('div', { className: "font-bold text-gray-800 flex items-center gap-2" },
                                                    statusIcon, item.desc
                                                ),
                                                React.createElement('div', { className: "text-xs text-gray-500 mt-1" }, `بانک: ${item.bank} | چک: ${item.checkNo}`)
                                            ),
                                            React.createElement('div', { className: "flex flex-col items-end gap-1" },
                                                React.createElement('div', { className: `font-bold ${item.status === 'برگشتی' ? 'text-red-700' : 'text-gray-700'} text-lg` },
                                                    formatBillion(item.amount), React.createElement('span', { className: "text-xs text-gray-400 font-normal mr-1" }, "میلیارد")
                                                ),
                                                React.createElement('div', { className: "flex gap-2 items-center" },
                                                    React.createElement('span', { className: "text-xs text-gray-400 font-mono" }, item.date),
                                                    React.createElement('span', { className: `status-badge ${statusClass}` }, item.status)
                                                )
                                            )
                                        );
                                    })
                                )
                            })
                        )
                    )
                )
            };

            // --- TAB 3: STRATEGIC REPORT ---
            const renderStrategicTab = () => (
                React.createElement('div', { className: "space-y-8 animate-fade-in pb-12" },
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" },
                        React.createElement(Card, { title: "درآمد عملیاتی (۶ ماهه)", value: "۱۰,۶۵۰ م.ر", subtext: "۲۴٪ کاهش نسبت به سال قبل", icon: TrendingDown, alertLevel: "critical", borderLeft: true }),
                        React.createElement(Card, { title: "زیان خالص (۶ ماهه)", value: "(۳,۵۶۴) م.ر", subtext: "۸۰٪ سرمایه شرکت از دست رفت", icon: AlertTriangle, alertLevel: "critical", borderLeft: true }),
                        React.createElement(Card, { title: "زیان انباشته", value: "(۴,۹۷۱) م.ر", subtext: "۱۱۱٪ سرمایه (ماده ۱۴۱)", icon: Activity, alertLevel: "warning", borderLeft: true }),
                        React.createElement(Card, { title: "بدهی مالیاتی و بیمه", value: "۸,۱۱۳ م.ر", subtext: "ریسک اجرایی و توقیف", icon: ShieldAlert, alertLevel: "normal", borderLeft: true })
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" },
                            React.createElement('h3', { className: "text-center font-bold text-slate-700 mb-4" }, "۱. روند تاریخی سالانه و سقوط سودآوری"),
                            React.createElement('div', { className: "h-80" },
                                React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                                    React.createElement(ComposedChart, { data: historicalTrendData },
                                        React.createElement(CartesianGrid, { strokeDasharray: "3 3", vertical: false }),
                                        React.createElement(XAxis, { dataKey: "name", tick: {fontSize: 10} }),
                                        React.createElement(YAxis, { tick: {fontSize: 10} }),
                                        React.createElement(Tooltip, { formatter: (value) => formatNumber(value) }),
                                        React.createElement(Legend),
                                        React.createElement(Bar, { dataKey: "revenue", name: "درآمد", fill: "#3b82f6", barSize: 20 }),
                                        React.createElement(Bar, { dataKey: "cost", name: "هزینه", fill: "#dc2626", barSize: 20 }),
                                        React.createElement(Line, { type: "monotone", dataKey: "net", name: "زیان خالص", stroke: "#fbbf24", strokeWidth: 3 })
                                    )
                                )
                            ),
                            React.createElement('p', { className: "text-xs text-center text-red-600 font-bold mt-2" }, "افزایش شدید فاصله درآمد و هزینه و سقوط زیان خالص در ۱۴۰۴")
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" },
                            React.createElement('h3', { className: "text-center font-bold text-slate-700 mb-4" }, "۲. تحلیل مقایسه‌ای ۶ ماهه و ۱۲ ماهه"),
                            React.createElement('div', { className: "h-80" },
                                React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                                    React.createElement(BarChart, { data: gapAnalysisData },
                                        React.createElement(CartesianGrid, { strokeDasharray: "3 3", vertical: false }),
                                        React.createElement(XAxis, { dataKey: "name", tick: {fontSize: 10} }),
                                        React.createElement(YAxis, { tick: {fontSize: 10} }),
                                        React.createElement(Tooltip, { formatter: (value) => formatNumber(value) }),
                                        React.createElement(Legend),
                                        React.createElement(Bar, { dataKey: "revenue", name: "درآمد", fill: "#60a5fa" }),
                                        React.createElement(Bar, { dataKey: "cost", name: "هزینه", fill: "#f87171" })
                                    )
                                )
                            ),
                            React.createElement('p', { className: "text-xs text-center text-slate-500 mt-2" }, "بحران در ۶ ماهه ۱۴۰۴ عمیق‌تر از هر زمان دیگری است.")
                        )
                    ),
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border border-slate-200" },
                        React.createElement('h3', { className: "font-bold text-lg mb-4 text-slate-700" }, "جدول جامع صورت سود و زیان (میلیارد ریال)"),
                        React.createElement(Table, {
                            headers: ["شرح", "۶م ۱۴۰۳", "۶م ۱۴۰۴ (جاری)", "۱۲م ۱۴۰۳", "۱۴۰۴ (پیش‌بینی)"],
                            rows: [
                                ["درآمد عملیاتی", "14,052", React.createElement('span', {className:"font-bold bg-blue-100 px-2 rounded"}, "10,650"), "32,813", "~21,300"],
                                ["بهای تمام شده", "(15,094)", "(11,611)", "(32,737)", "~(23,200)"],
                                ["سود (زیان) ناخالص", "(1,042)", React.createElement('span', {className:"font-bold text-red-600"}, "(961)"), "76", "~(1,900)"],
                                ["سود (زیان) خالص", "(1,879)", React.createElement('span', {className:"font-black text-red-700 text-lg"}, "(3,564)"), "(3,580)", "~(7,100)"]
                            ]
                        })
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" },
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border-t-4 border-red-500" },
                            React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(Truck, {className:"w-5 h-5"}), "وضعیت بحرانی تأمین‌کنندگان"),
                            React.createElement(Table, {
                                headers: ["تأمین‌کننده", "کالا", "بدهی (م.ر)", "وضعیت"],
                                rows: [
                                    ["گوهربافان", "پارچه", "1,290,533", React.createElement('span', {className:"bg-red-100 text-red-800 px-2 rounded text-xs font-bold"}, "توقف تحویل")],
                                    ["نواندیش صنعت", "فلزی", "444,889", "خرید نقدی"],
                                    ["صنایع الکترونیک", "برقی", "317,117", "محدود"],
                                    ["ایران قطعه", "فوم", "170,000", React.createElement('span', {className:"bg-red-100 text-red-800 px-2 rounded text-xs font-bold"}, "ریسک توقف")]
                                ]
                            })
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border-t-4 border-orange-500" },
                            React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(Wallet, {className:"w-5 h-5"}), "وضعیت حبس نقدینگی (مطالبات)"),
                            React.createElement(Table, {
                                headers: ["مشتری", "مانده (م.ر)", "سهم", "ریسک"],
                                rows: [
                                    ["سازه‌گستر", React.createElement('span', {className:"font-bold"}, "9,732,909"), "88%", "زیاد (درون‌گروهی)"],
                                    ["زامیاد", "419,583", "4%", "متوسط"],
                                    ["سایرین", "881,892", "8%", "کم"],
                                    [React.createElement('span', {className:"font-bold"}, "جمع کل"), React.createElement('span', {className:"font-bold"}, "11,034,384"), "100%", "-"]
                                ]
                            })
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border-t-4 border-red-600" },
                            React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(ShieldAlert, {className:"w-5 h-5"}), "وضعیت ریسک‌های حاکمیتی (دیون)"),
                            React.createElement(Table, {
                                headers: ["سرفصل", "اصل (م.ر)", "جرائم (م.ر)", "جمع کل (م.ر)", "وضعیت"],
                                rows: [
                                    ["ارزش افزوده", "1,787,000", "3,325,000", "5,112,000", React.createElement('span', {className:"text-red-600 font-bold"}, "اجرایی")],
                                    ["تأمین اجتماعی", "855,000", "10,000", "865,000", "اخطار کسر"],
                                    ["مالیات عملکرد", "1,020,000", "533,000", "1,553,000", "دادرسی"],
                                    [React.createElement('span', {className:"font-bold"}, "جمع کل"), "3,662,000", "3,868,000", React.createElement('span', {className:"font-black text-lg"}, "7,530,000"), "-"]
                                ]
                            })
                        ),
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border-t-4 border-blue-500" },
                            React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(Users, {className:"w-5 h-5"}), "وضعیت سربار حقوق و دستمزد"),
                            React.createElement(Table, {
                                headers: ["شرح", "مبلغ (م.ر)", "سهم", "توضیحات"],
                                rows: [
                                    ["دستمزد مستقیم", "1,050,754", "60%", "نیروهای خط تولید"],
                                    ["دستمزد ستاد", "703,898", React.createElement('span', {className:"text-red-600 font-bold"}, "40%"), "تراکم نیروی مازاد"],
                                    ["جمع کل", React.createElement('span', {className:"font-bold"}, "1,754,652"), "100%", "میانگین ماهانه: 292 م.ر"]
                                ]
                            })
                        )
                    ),
                    React.createElement('div', { className: "bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl overflow-hidden shadow-2xl mt-8" },
                        React.createElement('button', { 
                            onClick: () => setShowReport(!showReport),
                            className: "w-full p-6 text-left flex justify-between items-center text-white hover:bg-slate-700 transition-all focus:outline-none"
                        },
                            React.createElement('div', { className: "flex items-center gap-4" },
                                React.createElement('span', { className: "bg-red-600 p-2 rounded-lg text-xl" }, "📑"),
                                React.createElement('div', null,
                                    React.createElement('h2', { className: "text-xl font-bold" }, "گزارش محرمانه تحلیل ریسک و نقشه راه خروج (کلیک کنید)"),
                                    React.createElement('p', { className: "text-sm text-slate-300" }, "تحلیل ماده ۱۴۱، ریسک‌های حسابرسی و استراتژی تامین مالی")
                                )
                            ),
                            React.createElement('svg', { 
                                className: `w-8 h-8 transform transition-transform duration-300 ${showReport ? 'rotate-180' : ''}`, 
                                fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
                            }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M19 9l-7 7-7-7" }))
                        ),
                        showReport && React.createElement('div', { className: "bg-white p-8 border-t border-slate-700 text-slate-800 leading-8 text-justify" },
                            React.createElement('div', { className: "max-w-4xl mx-auto space-y-6" },
                                React.createElement('h3', { className: "text-2xl text-center text-blue-900 font-bold mb-4" }, "گزارش جامع تحلیل مالی و استراتژی خروج (۱۴۰۴)"),
                                React.createElement('div', null,
                                    React.createElement('h4', { className: "text-lg font-bold text-red-700 mb-2" }, "۱. تحلیل وضعیت بحرانی ماده ۱۴۱ (Vital Priority)"),
                                    React.createElement('p', null, "شرکت نه تنها نیمی از سرمایه، بلکه کل سرمایه خود را از دست داده و ۵۰۰ میلیارد ریال هم بدهی مازاد بر دارایی خالص دارد. انحلال شرکت روی میز است مگر اینکه مجمع فوق‌العاده رای به بقا دهد."),
                                    React.createElement('ul', { className: "list-disc list-inside mt-2 text-sm bg-red-50 p-4 rounded" },
                                        React.createElement('li', null, "سرمایه ثبت شده: ۴,۴۵۶ میلیارد ریال"),
                                        React.createElement('li', null, "زیان انباشته: (۴,۹۷۱) میلیارد ریال"),
                                        React.createElement('li', { className: "font-bold text-red-600" }, "نسبت زیان به سرمایه: ۱۱۱٪")
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('h4', { className: "text-lg font-bold text-blue-700 mb-2" }, "۲. سناریوی بهینه خروج (تجدید ارزیابی)"),
                                    React.createElement('p', null, "تنها راهکار عملیاتی «افزایش سرمایه از محل مازاد تجدید ارزیابی دارایی‌های استهلاک‌ناپذیر» (زمین کارخانه جاده مخصوص) است. برآورد می‌شود ارزش روز زمین‌ها بتواند زیان انباشته را پوشش دهد.")
                                ),
                                React.createElement('div', null,
                                    React.createElement('h4', { className: "text-lg font-bold text-orange-700 mb-2" }, "۳. استراتژی تأمین مالی نوین"),
                                    React.createElement('ul', { className: "list-disc list-inside space-y-2" },
                                        React.createElement('li', null, React.createElement('strong', null, "اوراق گام:"), " تسویه بدهی تأمین‌کنندگان عمده (مثل گوهربافان) با سررسید ۹ ماهه."),
                                        React.createElement('li', null, React.createElement('strong', null, "فاکتورینگ:"), " واگذاری مطالبات از سازه‌گستر به نهادهای مالی جهت دریافت نقدینگی فوری.")
                                    )
                                )
                            )
                        )
                    )
                )
            );

            // --- TAB 4: DYNAMIC DASHBOARD (Chart.js Implementation) ---
            const renderDynamicDashboard = () => {
                // Calculation Logic
                const total = dynamicData.reduce((sum, d) => sum + d.rawAmount, 0);
                const total1403 = dynamicData.filter(d => d.year === 1403).reduce((sum, d) => sum + d.rawAmount, 0);
                const total1404 = dynamicData.filter(d => d.year === 1404).reduce((sum, d) => sum + d.rawAmount, 0);
                const count = dynamicData.length;

                // Deep Analysis Data Filtering
                const filteredData = employerFilter === 'all' 
                    ? dynamicData 
                    : dynamicData.filter(d => d.source === employerFilter);
                
                const filteredTotal = filteredData.reduce((sum, d) => sum + d.rawAmount, 0);
                const share = total > 0 ? (filteredTotal / total) * 100 : 0;

                // --- Chart Data Preparation (Exact User Logic) ---
                const fullMonthOrder = [
                    {y: 1403, m: "فروردین"}, {y: 1403, m: "اردیبهشت"}, {y: 1403, m: "خرداد"}, 
                    {y: 1403, m: "تیر"}, {y: 1403, m: "مرداد"}, {y: 1403, m: "شهریور"}, 
                    {y: 1403, m: "مهر"}, {y: 1403, m: "آبان"}, {y: 1403, m: "آذر"}, 
                    {y: 1403, m: "دی"}, {y: 1403, m: "بهمن"}, {y: 1403, m: "اسفند"},
                    {y: 1404, m: "فروردین"}, {y: 1404, m: "اردیبهشت"}, {y: 1404, m: "خرداد"}, 
                    {y: 1404, m: "تیر"}, {y: 1404, m: "مرداد"}, {y: 1404, m: "شهریور"}, 
                    {y: 1404, m: "مهر"}, {y: 1404, m: "آبان"}, {y: 1404, m: "آذر"}, 
                    {y: 1404, m: "دی"}, {y: 1404, m: "بهمن"}, {y: 1404, m: "اسفند"}
                ];

                const labels = fullMonthOrder.map(t => `${t.m} ${t.y}`);

                // 1. Deep Analysis Data
                const monthlyMap = {};
                filteredData.forEach(d => {
                    const k = `${d.year}-${d.month}`;
                    monthlyMap[k] = (monthlyMap[k] || 0) + d.amount;
                });

                const monthlyValues = [];
                const cumulativeValues = [];
                let runningSum = 0;

                fullMonthOrder.forEach(t => {
                    const val = monthlyMap[`${t.y}-${t.m}`] || 0;
                    monthlyValues.push(val);
                    runningSum += val;
                    cumulativeValues.push(runningSum);
                });

                const deepChartData = {
                    labels: labels,
                    datasets: [
                        {
                            type: 'bar',
                            label: 'پرداخت ماهانه',
                            data: monthlyValues,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderRadius: 4,
                            order: 2,
                            yAxisID: 'y'
                        },
                        {
                            type: 'line',
                            label: 'روند تجمعی کل',
                            data: cumulativeValues,
                            borderColor: '#f59e0b',
                            borderWidth: 3,
                            tension: 0.3,
                            pointRadius: 2,
                            order: 1,
                            yAxisID: 'y1'
                        }
                    ]
                };

                const deepChartOptions = {
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'ماهانه (میلیارد ریال)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'تجمعی (میلیارد ریال)' }
                        }
                    }
                };

                // 2. Cumulative Comparison Data
                const globalMonthlyMap = {};
                dynamicData.forEach(d => {
                    const k = `${d.year}-${d.month}`;
                    globalMonthlyMap[k] = (globalMonthlyMap[k] || 0) + d.amount;
                });

                let sum1403 = 0, sum1404 = 0;
                const data1403 = [], data1404 = [];
                fullMonthOrder.forEach(t => {
                    if(t.y === 1403) {
                        sum1403 += (globalMonthlyMap[`${t.y}-${t.m}`] || 0);
                        data1403.push(sum1403);
                        data1404.push(null);
                    } else {
                        data1403.push(null);
                        sum1404 += (globalMonthlyMap[`${t.y}-${t.m}`] || 0);
                        data1404.push(sum1404);
                    }
                });

                const comparisonData = {
                    labels: labels,
                    datasets: [
                        {
                            label: 'تجمعی ۱۴۰۳',
                            data: data1403,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            spanGaps: false
                        },
                        {
                            label: 'تجمعی ۱۴۰۴',
                            data: data1404,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            spanGaps: false
                        }
                    ]
                };

                // 3. Pie Chart Data
                const sourceTotals = {};
                dynamicData.forEach(d => {
                    sourceTotals[d.source] = (sourceTotals[d.source] || 0) + d.amount;
                });
                const pieData = {
                    labels: Object.keys(sourceTotals),
                    datasets: [{
                        data: Object.values(sourceTotals),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#64748b']
                    }]
                };

                // Dropdown Options
                const employers = [...new Set(dynamicData.map(d => d.source))].sort();

                return React.createElement('div', { className: "space-y-8 animate-fade-in" },
                    // Top Bar
                    React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-gray-100" },
                        React.createElement('div', null,
                            React.createElement('h1', { className: "text-3xl font-bold text-slate-800 tracking-tight" }, "داشبورد دینامیک نقدینگی"),
                            React.createElement('p', { className: "text-slate-500 mt-1 text-sm" }, "تحلیل داده‌های ورودی (نسخه Rev.02)")
                        ),
                        React.createElement('div', { className: "mt-4 md:mt-0 flex items-center gap-4" },
                            React.createElement('label', { className: "cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-medium transition-colors shadow-lg shadow-blue-600/20 flex items-center gap-2" },
                                React.createElement(Upload, { className: "w-5 h-5" }),
                                "بارگذاری فایل جدید (CSV)",
                                React.createElement('input', { type: "file", accept: ".csv", className: "hidden", onChange: handleFileUpload })
                            ),
                            React.createElement('div', { className: "text-left" },
                                React.createElement('p', { className: "text-xs text-gray-400" }, "تاریخ گزارش"),
                                React.createElement('p', { className: "text-lg font-bold text-gray-700 font-mono dir-ltr" }, "1404/09/16")
                            )
                        )
                    ),

                    // KPIs
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-6" },
                        React.createElement(Card, { title: "کل ورودی شناسایی شده", value: formatBillion(total), subtext: "میلیارد ریال", icon: Wallet, alertLevel: "normal", borderLeft: true }),
                        React.createElement(Card, { title: "ورودی سال ۱۴۰۳", value: formatBillion(total1403), subtext: "میلیارد ریال", icon: Calendar, alertLevel: "success", borderLeft: true }),
                        React.createElement(Card, { title: "ورودی سال ۱۴۰۴", value: formatBillion(total1404), subtext: "میلیارد ریال", icon: TrendingUp, alertLevel: "indigo", borderLeft: true }), 
                        React.createElement(Card, { title: "تعداد تراکنش‌ها", value: count, subtext: "ردیف سند", icon: FileText, alertLevel: "amber", borderLeft: true })
                    ),

                    // Deep Analysis Section
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-md border border-blue-100" },
                        React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-center mb-6 border-b pb-4" },
                            React.createElement('h2', { className: "text-xl font-bold text-slate-800 flex items-center gap-2" }, 
                                React.createElement(Search, { className: "w-6 h-6" }), "تحلیل عمیق محصول (بر اساس منبع/کارفرما)"
                            ),
                            React.createElement('div', { className: "mt-4 md:mt-0 w-full md:w-1/3" },
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "انتخاب کارفرما:"),
                                React.createElement('select', { 
                                    className: "w-full border-gray-300 rounded-lg shadow-sm p-2 border bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",
                                    value: employerFilter,
                                    onChange: (e) => setEmployerFilter(e.target.value)
                                },
                                    React.createElement('option', { value: "all" }, "همه موارد"),
                                    employers.map(emp => React.createElement('option', { key: emp, value: emp }, emp))
                                )
                            )
                        ),
                        React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                            React.createElement('div', { className: "lg:col-span-2 h-96" },
                                React.createElement(ChartCanvas, { type: 'bar', data: deepChartData, options: deepChartOptions })
                            ),
                            React.createElement('div', { className: "bg-slate-50 rounded-xl p-6 flex flex-col justify-center space-y-6" },
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-sm text-gray-500" }, "مجموع پرداختی این کارفرما"),
                                    React.createElement('p', { className: "text-2xl font-bold text-blue-700 font-mono mt-1" }, formatBillion(filteredTotal)),
                                    React.createElement('p', { className: "text-xs text-gray-400" }, "میلیارد ریال")
                                ),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-sm text-gray-500" }, "سهم از کل نقدینگی"),
                                    React.createElement('p', { className: "text-2xl font-bold text-emerald-600 font-mono mt-1" }, share.toFixed(1) + "%")
                                ),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-sm text-gray-500" }, "تعداد پرداختی"),
                                    React.createElement('p', { className: "text-2xl font-bold text-slate-700 font-mono mt-1" }, filteredData.length)
                                )
                            )
                        )
                    ),

                    // Secondary Charts
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                        React.createElement('div', { className: "card bg-white p-6 rounded-xl shadow-sm" },
                            React.createElement('h2', { className: "text-lg font-bold text-slate-700 mb-4" }, "روند تجمعی کل (مقایسه سالانه)"),
                            React.createElement('div', { className: "h-80" },
                                React.createElement(ChartCanvas, { type: 'line', data: comparisonData, options: { scales: { y: { beginAtZero: true } } } })
                            )
                        ),
                        React.createElement('div', { className: "card bg-white p-6 rounded-xl shadow-sm" },
                            React.createElement('h2', { className: "text-lg font-bold text-slate-700 mb-4" }, "ترکیب منابع (سهم بازار)"),
                            React.createElement('div', { className: "h-80 flex justify-center" },
                                React.createElement(ChartCanvas, { type: 'doughnut', data: pieData, options: { plugins: { legend: { position: 'right' } } } })
                            )
                        )
                    ),

                    // Data Table
                    React.createElement('div', { className: "card bg-white rounded-xl shadow-sm overflow-hidden flex flex-col h-[600px]" },
                        React.createElement('div', { className: "p-4 flex justify-between items-center bg-white border-b" },
                            React.createElement('h2', { className: "text-lg font-bold text-slate-700" }, "ریز تراکنش‌های پردازش شده"),
                            React.createElement('span', { className: "text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded" }, "برای مرتب‌سازی روی سرستون‌ها کلیک کنید")
                        ),
                        React.createElement('div', { className: "overflow-auto flex-grow bg-slate-50" },
                            React.createElement('table', { className: "min-w-full text-right text-sm relative border-collapse" },
                                React.createElement('thead', { className: "bg-slate-800 text-white font-medium sticky top-0 z-10" },
                                    React.createElement('tr', null,
                                        ['id:ردیف ↕', 'date:تاریخ ↕', 'year:سال ↕', 'month:ماه ↕', 'source:کارفرما / منبع ↕', 'desc:شرح سند ↕', 'amount:مبلغ (میلیارد ریال) ↕'].map((h) => {
                                            const [key, label] = h.split(':');
                                            return React.createElement('th', { 
                                                key: key, 
                                                className: "p-4 whitespace-nowrap cursor-pointer hover:bg-slate-700 transition-colors",
                                                onClick: () => handleSort(key)
                                            }, label);
                                        })
                                    )
                                ),
                                React.createElement('tbody', { className: "divide-y divide-gray-200 bg-white" },
                                    sortedData.map((d, i) => React.createElement('tr', { key: i, className: "hover:bg-slate-50 transition-colors" },
                                        React.createElement('td', { className: "p-4 text-center text-slate-500 font-mono" }, d.id),
                                        React.createElement('td', { className: "p-4 font-mono text-sm" }, d.date),
                                        React.createElement('td', { className: `p-4 font-bold ${d.year === 1404 ? 'text-indigo-600' : 'text-blue-600'}` }, d.year),
                                        React.createElement('td', { className: "p-4" }, d.month),
                                        React.createElement('td', { className: "p-4 font-bold text-slate-700" }, d.source),
                                        React.createElement('td', { className: "p-4 text-xs text-slate-500 max-w-xs truncate", title: d.desc }, d.desc),
                                        React.createElement('td', { className: "p-4 font-mono font-bold text-left dir-ltr text-emerald-600" }, d.amount.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 3}))
                                    ))
                                )
                            )
                        )
                    )
                );
            };

            // --- MAIN RENDER ---
            return React.createElement('div', { className: "min-h-screen bg-slate-50 p-4 md:p-8", dir: "rtl" },
                // HEADER
                React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-end mb-8 border-b-2 border-slate-200 pb-4" },
                    React.createElement('div', null,
                        React.createElement('h1', { className: "text-3xl font-black text-slate-900 mb-2 flex items-center gap-3" },
                            React.createElement(Briefcase, { className: "w-8 h-8 text-blue-800" }),
                            "داشبورد جامع مدیریت و استراتژی"
                        ),
                        React.createElement('p', { className: "text-slate-500 text-lg" }, "شرکت سایپا آذین - گزارش ۶ ماهه ۱۴۰۴")
                    ),
                    React.createElement('div', { className: "text-left" },
                        React.createElement('div', { className: "text-sm font-bold text-slate-700" }, "تاریخ گزارش: ۱۴۰۴/۰۹/۱۶"),
                        React.createElement('div', { className: "text-xs text-slate-400" }, "تهیه شده جهت استحضار هیئت مدیره")
                    )
                ),
                
                // TABS
                React.createElement('div', { className: "flex flex-wrap gap-2 mb-8 p-1 bg-white rounded-xl shadow-sm border border-slate-200 w-fit" },
                    [
                        {id: 'liquidity', label: 'داشبورد نقدینگی و بانک', icon: Activity}, 
                        {id: 'payable', label: 'اسناد پرداختنی (چک‌ها)', icon: FileCheck},
                        {id: 'dynamic', label: 'داشبورد دینامیک نقدینگی', icon: BarChart2}, // NEW TAB
                        {id: 'strategic', label: 'گزارش استراتژیک جامع', icon: FileText}
                    ].map(tab => (
                        React.createElement('button', {
                            key: tab.id,
                            onClick: () => setActiveTab(tab.id),
                            className: `flex items-center gap-2 px-6 py-3 rounded-lg font-bold transition-all ${activeTab === tab.id ? 'bg-slate-800 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-800'}`
                        }, React.createElement(tab.icon, { className: "w-4 h-4" }), tab.label)
                    ))
                ),

                // CONTENT
                activeTab === 'liquidity' && renderLiquidityTab(),
                activeTab === 'payable' && renderPayableDocs(),
                activeTab === 'dynamic' && renderDynamicDashboard(),
                activeTab === 'strategic' && renderStrategicTab(),

                // FOOTER (Hide in Strategic Tab to avoid redundancy)
                activeTab !== 'strategic' && React.createElement('div', { className: "mt-12 bg-white border-l-4 border-blue-800 rounded-r-xl shadow-lg p-8" },
                    React.createElement('h3', { className: "text-2xl font-black text-slate-800 mb-6 border-b border-slate-100 pb-4" }, "جمع‌بندی مدیریتی"),
                    React.createElement('div', { className: "grid md:grid-cols-2 gap-8 text-slate-700 leading-8 text-justify" },
                        React.createElement('div', null,
                            React.createElement('h4', { className: "font-bold text-red-700 mb-2" }, "۱. بحران مالیاتی (فوری)"),
                            React.createElement('p', { className: "text-sm" }, "وجود ۱۹.۵ میلیارد تومان چک برگشتی نزد سازمان امور مالیاتی با سررسید آبان‌ماه ریسک مسدودی حساب‌ها را ایجاد کرده است.")
                        ),
                        React.createElement('div', null,
                            React.createElement('h4', { className: "font-bold text-orange-700 mb-2" }, "۲. قفل نقدینگی"),
                            React.createElement('p', { className: "text-sm" }, "بیش از ۷۰٪ حساب‌های بانکی شرکت مسدود یا راکد هستند و ۳ میلیارد تومان نقدینگی حبس شده است.")
                        )
                    )
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(Dashboard));
    </script>
</body>
</html>
