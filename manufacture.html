<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø§Ù…Ø¹ ØªØ­Ù„ÛŒÙ„ ØªÙˆÙ„ÛŒØ¯ - Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #1e293b; /* Slate 800 */
            --secondary: #64748b; /* Slate 500 */
            --accent-1403: #3b82f6; /* Blue */
            --accent-1404: #ef4444; /* Red */
            --oem-color: #059669; /* Emerald for Automaker */
            --azin-color: #d97706; /* Amber 600 for Azin */
            --success: #10b981;
            --text-main: #334155;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        /* Tabs Styling */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-family: 'Vazirmatn';
            font-size: 1rem;
            cursor: pointer;
            color: var(--secondary);
            transition: all 0.3s;
            font-weight: bold;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border-right: 6px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header h1 { margin: 0; font-size: 1.6rem; color: var(--primary); }
        .header p { margin: 5px 0 0; color: var(--secondary); font-size: 0.9rem; }

        /* Grid Layouts */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-row-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 1024px) {
            .chart-row-split { grid-template-columns: 1fr; }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .kpi-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 120px;
            border: 1px solid #e2e8f0;
        }

        .kpi-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .kpi-label { font-size: 0.9rem; color: var(--secondary); }
        .kpi-diff { font-size: 0.85rem; font-weight: bold; }
        .diff-neg { color: var(--accent-1404); }
        .diff-pos { color: var(--success); }

        .control-panel {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            font-family: 'Vazirmatn';
            font-size: 1rem;
            min-width: 250px;
            flex-grow: 1;
        }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© ØªÙˆÙ„ÛŒØ¯ Ùˆ Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø±</h1>
            <p>ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ø®Ù„ÛŒ (Ø¢Ø°ÛŒÙ†) Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² (Û±Û´Û°Û³ vs Û±Û´Û°Û´)</p>
        </div>
        <div style="text-align: left;">
            <span style="background: #e2e8f0; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem;">Updated: Bahman 1404</span>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('internal')">ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø®Ù„ÛŒ (Internal)</button>
        <button class="tab-btn" onclick="switchTab('market')">ğŸ¤ Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± (Share of Wallet)</button>
    </div>

    <!-- TAB 1: Internal Analysis -->
    <div id="tab-internal" class="tab-content active">
        <!-- KPIs -->
        <div class="kpi-grid">
            <div class="card kpi-card">
                <span class="kpi-label">Ù…Ø¬Ù…ÙˆØ¹ ØªÙˆÙ„ÛŒØ¯ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³</span>
                <span class="kpi-value">293,457</span>
                <span class="kpi-diff" style="color: gray;">Base Line</span>
            </div>
            <div class="card kpi-card">
                <span class="kpi-label">Ù…Ø¬Ù…ÙˆØ¹ ØªÙˆÙ„ÛŒØ¯ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´</span>
                <span class="kpi-value">136,600</span>
                <span class="kpi-diff diff-neg">ÛµÛ³Ùª Ú©Ø§Ù‡Ø´ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø³Ø§Ù„ Ù‚Ø¨Ù„</span>
            </div>
            <div class="card kpi-card">
                <span class="kpi-label">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù‡ Ø¨Ù‡Ù…Ù† Û±Û´Û°Û´</span>
                <span class="kpi-value" style="color: var(--accent-1404);">3,415</span>
                <span class="kpi-diff diff-neg">âš ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø­Ø±Ø§Ù†ÛŒ</span>
            </div>
        </div>

        <div class="chart-row-split">
            <div class="card">
                <h3 style="color: var(--secondary);">Ø±ÙˆÙ†Ø¯ Ù†ÙˆØ³Ø§Ù†Ø§Øª Ú©Ù„ (Trend)</h3>
                <div style="height: 300px;"><canvas id="monthlyTrendChart"></canvas></div>
            </div>
            <div class="card">
                <h3 style="color: var(--secondary);">Ø¹Ù…Ù„Ú©Ø±Ø¯ ØªØ¬Ù…Ø¹ÛŒ Ø¢Ø°ÛŒÙ† (Cumulative Gap)</h3>
                <div style="height: 300px;"><canvas id="cumulativeChart"></canvas></div>
            </div>
        </div>

        <div class="chart-row">
            <div class="card" style="border: 2px solid #e2e8f0;">
                <div class="control-panel">
                    <label>ğŸ” ØªØ­Ù„ÛŒÙ„ Ù…Ø­ØµÙˆÙ„ Ø¯Ø§Ø®Ù„ÛŒ (Û±Û¸ Ù…Ø­ØµÙˆÙ„):</label>
                    <select id="productSelect" onchange="updateProductChart()"></select>
                </div>
                <div style="height: 400px;"><canvas id="productSpecificChart"></canvas></div>
            </div>
        </div>
    </div>

    <!-- TAB 2: Market Share Analysis -->
    <div id="tab-market" class="tab-content">
        
        <!-- Controls for Tab 2 -->
        <div class="control-panel" style="background: #e0f2fe; border: 1px solid #bae6fd;">
            <label>ğŸ“… ÙÛŒÙ„ØªØ± Ø³Ø§Ù„ (Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯):</label>
            <select id="marketYearFilter" onchange="updateMarketTab()">
                <option value="both">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ùˆ Ø³Ø§Ù„ (Û±Û´Û°Û³ Ùˆ Û±Û´Û°Û´)</option>
                <option value="1404" selected>ÙÙ‚Ø· Ø³Ø§Ù„ Û±Û´Û°Û´ (Ø¨Ø­Ø±Ø§Ù† ÙØ¹Ù„ÛŒ)</option>
                <option value="1403">ÙÙ‚Ø· Ø³Ø§Ù„ Û±Û´Û°Û³ (Ø³Ø§Ø¨Ù‚Ù‡)</option>
            </select>
        </div>

        <!-- Market KPIs -->
        <div class="kpi-grid">
            <div class="card kpi-card" style="border-right: 4px solid var(--oem-color);">
                <span class="kpi-label">ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² (Û±Û´Û°Û´ YTD)</span>
                <span class="kpi-value" style="color: var(--oem-color);">259,306</span>
                <span class="kpi-diff">Ú©Ù„ Ù†ÛŒØ§Ø² Ø¨Ø§Ø²Ø§Ø±</span>
            </div>
            <div class="card kpi-card" style="border-right: 4px solid var(--azin-color);">
                <span class="kpi-label">ØªÙˆÙ„ÛŒØ¯ Ø¢Ø°ÛŒÙ† (Û±Û´Û°Û´ YTD)</span>
                <span class="kpi-value" style="color: var(--azin-color);">136,600</span>
                <span class="kpi-diff">ØªØ£Ù…ÛŒÙ† Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù…Ø§</span>
            </div>
            <div class="card kpi-card">
                <span class="kpi-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± (Share)</span>
                <span class="kpi-value">52.7%</span>
                <span class="kpi-diff diff-neg">â–¼ Ø³Ù‚ÙˆØ· Ø§Ø² Û¶Û³Ùª Ø¯Ø± Ø³Ø§Ù„ Û±Û´Û°Û³</span>
            </div>
             <div class="card kpi-card" style="background: #fff1f2;">
                <span class="kpi-label">Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± Ø¢Ø°ÛŒÙ† Ø¯Ø± Ø¨Ù‡Ù…Ù† Û±Û´Û°Û´</span>
                <span class="kpi-value" style="color: var(--accent-1404);">31.2%</span>
                <span class="kpi-diff diff-neg">âš ï¸ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ±ÛŒÙ† Ø­Ø¯ ØªØ§Ø±ÛŒØ®ÛŒ</span>
            </div>
        </div>

        <!-- Cumulative Comparison Chart -->
        <div class="chart-row">
            <div class="card">
                <h3>ğŸ“‰ Ù…Ù‚Ø§ÛŒØ³Ù‡ ØªØ¬Ù…Ø¹ÛŒ ØªÙˆÙ„ÛŒØ¯: Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² vs Ø¢Ø°ÛŒÙ† (Cumulative Gap Analysis)</h3>
                <p style="font-size: 0.8rem; color: gray;">ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø®Ø· Ø³Ø¨Ø² (Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø²) Ùˆ Ù†Ø§Ø±Ù†Ø¬ÛŒ (Ø¢Ø°ÛŒÙ†) Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø­Ø¬Ù… Ø¨Ø§Ø²Ø§Ø±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡ Ø§Ø³Øª.</p>
                <div style="height: 350px;">
                    <canvas id="cumulativeMarketChart"></canvas>
                </div>
            </div>
        </div>

        <!-- NEW: Charts Split Row -->
        <div class="chart-row-split">
            <div class="card">
                <h3>Ø±ÙˆÙ†Ø¯ Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± Ù…Ø§Ù‡Ø§Ù†Ù‡ (Share Trend)</h3>
                <p style="font-size: 0.8rem; color: gray;">Ø¯Ø±ØµØ¯ ØªØ£Ù…ÛŒÙ† Ù‚Ø·Ø¹Ø§Øª ØªÙˆØ³Ø· Ø¢Ø°ÛŒÙ†</p>
                <div style="height: 300px;">
                    <canvas id="sharePercentChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ú©Ù„ ØªÙˆÙ„ÛŒØ¯ (Monthly Total Comparison)</h3>
                <p style="font-size: 0.8rem; color: gray;">Ù…ÛŒÙ„Ù‡â€ŒÙ‡Ø§: Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² | Ø®Ø·ÙˆØ·: Ø¢Ø°ÛŒÙ† (Ù…Ø·Ø§Ø¨Ù‚ ÙÛŒÙ„ØªØ± Ø³Ø§Ù„)</p>
                <div style="height: 300px;">
                    <canvas id="monthlyTotalComparisonChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Product Comparison -->
        <div class="chart-row">
            <div class="card">
                <div class="control-panel">
                    <label>âš–ï¸ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„ (Ø´Ø§Ù…Ù„ Ù…ÙˆØ§Ø±Ø¯ ØµÙØ±):</label>
                    <select id="compareProductSelect" onchange="updateCompareChart()"></select>
                </div>
                <div style="height: 400px;">
                    <canvas id="compareProductChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- TABS LOGIC ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- DATA SETUP (Internal) ---
        const labels = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];
        
        // Azin Data (Supplier)
        const total1403 = [15861, 33150, 30828, 28040, 20318, 20808, 31300, 23627, 22708, 22212, 23326, 21279];
        const total1404 = [12174, 25148, 13143, 12074, 8264, 17073, 14800, 10349, 11324, 8836, 3415, null];

        // Automaker Data (OEM)
        const oem1403 = [25259, 46759, 45493, 40372, 30772, 33067, 46959, 35593, 37026, 40747, 41761, 36816];
        const oem1404 = [17907, 38904, 22255, 21477, 21105, 29069, 26148, 19681, 29508, 22324, 10928, null];

        // Cumulative Internal Calculation
        const cum1403 = []; total1403.reduce((a, b, i) => cum1403[i] = a + b, 0);
        const cum1404 = []; 
        let sumAzin = 0;
        for(let val of total1404) { if(val !== null) { sumAzin += val; cum1404.push(sumAzin); } else { cum1404.push(null); } }

        // Cumulative OEM Calculation
        const cumOem1404 = [];
        let sumOem = 0;
        for(let val of oem1404) { if(val !== null) { sumOem += val; cumOem1404.push(sumOem); } else { cumOem1404.push(null); } }
        
        const cumOem1403 = [];
        oem1403.reduce((a, b, i) => cumOem1403[i] = a + b, 0);

        // Share Calculation
        const share1404 = total1404.map((val, i) => {
            if (val === null || !oem1404[i] || oem1404[i] === 0) return null;
            return ((val / oem1404[i]) * 100).toFixed(1);
        });
        
        const share1403 = total1403.map((val, i) => {
             if (val === null || !oem1403[i] || oem1403[i] === 0) return 0;
             return Math.min(((val / oem1403[i]) * 100), 100).toFixed(1);
        });


        // --- FULL PRODUCT MAPPING ---
        const allProducts = {
            '131': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 131 ØµØ§Ø¯Ø±Ø§Øª',
                oem: [0, 240, 128, 60, 0, 292, 172, 128, 64, 112, 0, null],
                my:  [56, 184, 128, 60, 0, 240, 60, 128, 64, 112, 32, null],
                oem1403: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                my1403: [1, 128, 112, 0, 12, 0, 120, 480, 0, 0, 232, 72]
            },
            '151': {
                name: 'ÙˆØ§Ù†Øª 151 (Ø·Ø±Ø­ Ú©ÙˆÛŒÛŒÚ©)',
                oem: [0, 4597, 3277, 2399, 1752, 5046, 3045, 2450, 3944, 2819, 1502, null],
                my:  [160, 4592, 3304, 2192, 1232, 5264, 3621, 2596, 3656, 2680, 1152, null],
                oem1403: [3524, 7108, 6877, 6038, 5026, 5764, 7004, 5614, 5966, 6378, 6585, 5951],
                my1403: [3584, 7360, 6824, 6008, 5264, 5448, 7032, 5848, 5896, 6317, 6465, 5808]
            },
            '212_Saipa': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 212 Ø³Ø§ÛŒÙ¾Ø§',
                oem: [2395, 5070, 2529, 2546, 2755, 3162, 2931, 2391, 3884, 3339, 1889, null],
                my:  [2716, 5536, 2488, 2084, 1560, 1336, 920, 884, 364, 368, 36, null],
                oem1403: [3669, 7632, 6196, 4252, 2751, 2665, 7275, 5427, 4385, 4635, 5469, 3732],
                my1403: [5124, 10172, 8112, 5148, 2120, 2480, 6528, 2748, 3024, 2468, 3820, 4672]
            },
            '212_Pars': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 212 Ù¾Ø§Ø±Ø³ Ø®ÙˆØ¯Ø±Ùˆ (Ø¨Ø­Ø±Ø§Ù†ÛŒ)',
                oem: [3419, 7068, 3226, 2931, 2883, 3512, 3272, 1839, 3539, 2608, 1406, null],
                my:  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, null],
                oem1403: [4628, 8535, 6998, 2830, 1497, 2751, 5664, 3824, 4455, 5172, 6973, 6663],
                my1403: [0,0,0,0,0,0,0,0,0,0,0,0]
            },
            '212R_Pars': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 212-R Ù¾Ø§Ø±Ø³ Ø®ÙˆØ¯Ø±Ùˆ',
                oem: [444, 572, 388, 281, 140, 131, 11, 0, 193, 85, 0, null],
                my:  [372, 680, 320, 304, 0, 192, 0, 128, 192, 0, 0, null],
                oem1403: [243, 571, 323, 1158, 575, 568, 960, 625, 537, 377, 284, 202],
                my1403: [232, 600, 296, 768, 444, 576, 1148, 580, 484, 408, 320, 64]
            },
            '232_Kashan': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 232 Ú©Ø§Ø´Ø§Ù†',
                oem: [4708, 9048, 5336, 5578, 6464, 7012, 5586, 5029, 7141, 4503, 1914, null],
                my:  [1880, 3696, 1888, 1456, 1240, 1588, 1464, 840, 380, 44, 0, null],
                oem1403: [6463, 11062, 10035, 9448, 7137, 7227, 9660, 7104, 8588, 8995, 9391, 7862],
                my1403: [2524, 5596, 5260, 5936, 4268, 2924, 4488, 3256, 3880, 3868, 2852, 1816]
            },
            'Shahin_N': {
                name: 'Ø´Ø§Ù‡ÛŒÙ† Ù…Ø¹Ù…ÙˆÙ„ÛŒ',
                oem: [332, 1603, 702, 808, 552, 1922, 1937, 799, 1432, 1050, 603, null],
                my:  [280, 792, 352, 472, 152, 616, 728, 192, 96, 104, 32, null],
                oem1403: [2305, 4159, 3547, 3045, 2439, 1199, 2671, 1187, 1400, 2274, 1020, 1009],
                my1403: [512, 1504, 1408, 1112, 776, 264, 912, 520, 648, 600, 416, 416]
            },
            'Shahin_CVT': {
                name: 'Ø´Ø§Ù‡ÛŒÙ† CVT',
                oem: [915, 1428, 1033, 1071, 848, 189, 629, 766, 407, 466, 191, null],
                my:  [168, 728, 752, 432, 420, 80, 128, 216, 104, 0, 16, null],
                oem1403: [1025, 1388, 1671, 1655, 1177, 1385, 1950, 1360, 1249, 2043, 2435, 2422],
                my1403: [568, 1160, 1064, 976, 632, 576, 784, 1024, 488, 672, 720, 792]
            },
            'Shahin_Plus': {
                name: 'Ø´Ø§Ù‡ÛŒÙ† Ù¾Ù„Ø§Ø³ (Ø¨Ø±Ù‚ÛŒ)',
                oem: [711, 1298, 795, 532, 545, 471, 774, 285, 1240, 731, 356, null],
                my:  [712, 584, 0, 0, 0, 0, 0, 0, 0, 0, 0, null],
                oem1403: [0, 20, 50, 86, 0, 110, 820, 82, 10, 188, 904, 500],
                my1403: [0, 38, 204, 40, 0, 136, 760, 32, 0, 248, 920, 488]
            },
            'Arya': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø¢Ø±ÛŒØ§',
                oem: [0, 0, 0, 0, 0, 0, 0, 5, 1, 4, 63, null],
                my:  [0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, null],
                oem1403: [0, 0, 0, 0, 0, 3, 7, 7, 9, 3, 2, 0],
                my1403: [0,0,0,0,0,0,8,8,4,7,1,0]
            },
            'Atlas': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø§Ø·Ù„Ø³',
                oem: [1802, 2780, 1262, 1520, 1955, 2585, 2352, 1875, 1782, 599, 696, null],
                my:  [1988, 3046, 864, 1440, 1820, 2572, 2360, 1656, 1708, 976, 192, null],
                oem1403: [741, 0, 1778, 2695, 1748, 3313, 583, 1834, 2999, 3459, 2587, 3502],
                my1403: [856, 160, 1596, 2968, 1784, 3052, 808, 1964, 2764, 3368, 2972, 3313]
            },
            'Atlas_M': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø§Ø·Ù„Ø³ Ù…Ø§Ø±ÙˆÙ†',
                oem: [7, 69, 50, 0, 35, 41, 17, 29, 28, 2, 0, null],
                my:  [60, 28, 52, 100, 64, 136, 28, 0, 0, 0, 0, null],
                oem1403: [0, 6, 3, 2, 1, 2, 13, 4, 9, 11, 28, 23],
                my1403: [0, 16, 0, 0, 0, 4, 12, 8, 12, 20, 32, 16]
            },
            'Sahand_LC': {
                name: 'Ø³Ù‡Ù†Ø¯ Ú†Ø±Ù… Ùˆ Ù¾Ø§Ø±Ú†Ù‡',
                oem: [15, 41, 28, 0, 0, 236, 343, 5, 0, 5, 6, null],
                my:  [20, 60, 32, 0, 0, 360, 332, 0, 0, 0, 0, null],
                oem1403: [2, 122, 28, 0, 0, 0, 0, 0, 5, 10, 5, 29],
                my1403: [0, 136, 101, 2, 0, 0, 0, 0, 0, 0, 0, 36]
            },
            'Sahand_C': {
                name: 'Ø³Ù‡Ù†Ø¯ Ù¾Ø§Ø±Ú†Ù‡â€ŒØ§ÛŒ',
                oem: [558, 1165, 927, 1135, 1217, 1469, 1692, 1000, 1569, 1043, 368, null],
                my:  [872, 952, 748, 984, 596, 1240, 1464, 768, 940, 732, 80, null],
                oem1403: [0, 8, 179, 353, 1675, 2482, 3153, 2449, 1538, 482, 804, 807],
                my1403: [0, 80, 160, 464, 1668, 2548, 3200, 2628, 1588, 316, 696, 636]
            },
            'Nissan': {
                name: 'ÙˆØ§Ù†Øª Ù†ÛŒØ³Ø§Ù†',
                oem: [2541, 3619, 2286, 2235, 552, 0, 20, 0, 0, 0, 0, null],
                my:  [2740, 3950, 1810, 2140, 200, 20, 30, 1, 0, 0, 0, null],
                oem1403: [2659, 5598, 5271, 4515, 3211, 3136, 5048, 4435, 3745, 3813, 3772, 3436],
                my1403: [2440, 5910, 5691, 4530, 3350, 2800, 5500, 4521, 3870, 3870, 3820, 3060]
            },
            'Padra': {
                name: 'Ù¾Ø§Ø¯Ø±Ø§ Ù¾Ù„Ø§Ø³',
                oem: [60, 306, 288, 381, 1407, 3001, 452, 290, 375, 0, 130, null],
                my:  [150, 320, 405, 410, 980, 3405, 485, 350, 150, 0, 50, null],
                oem1403: [0, 0, 0, 0, 0, 0, 0, 0, 105, 90, 95, 80],
                my1403: [0, 50, 0, 0, 0, 0, 0, 10, 50, 50, 60, 90]
            },
            'Extend': {
                name: 'Ú©Ø§Ù…ÛŒÙˆÙ†Øª Ø§Ú©Ø³ØªÙ†Ø¯',
                oem: [0, 0, 0, 0, 0, 0, 2915, 2790, 3380, 4026, 1804, null],
                my:  [0, 0, 0, 0, 0, 0, 3180, 2590, 3522, 3820, 1825, null],
                oem1403: [0,0,0,0,0,0,0,0,0,0,0,0],
                my1403: [0,0,0,0,0,0,0,0,0,0,0,0]
            },
            'Atlas_S': {
                name: 'Ø§Ø·Ù„Ø³ S Ù¾Ø§Ø±Ú†Ù‡ (Ø¬Ø¯ÛŒØ¯)',
                oem: [0, 0, 0, 0, 0, 0, 0, 0, 529, 932, 0, null],
                my:  [0, 0, 0, 0, 0, 0, 0, 0, 140, 0, 0, null],
                oem1403: [0,0,0,0,0,0,0,0,0,0,0,0],
                my1403: [0,0,0,0,0,0,0,0,0,0,0,0]
            }
        };


        // --- CHART CONFIGURATION ---
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { font: { family: 'Vazirmatn' } } } },
            scales: { x: { ticks: { font: { family: 'Vazirmatn' } } }, y: { ticks: { font: { family: 'Vazirmatn' } } } },
            elements: { line: { tension: 0.4 } }
        };

        // --- INTERNAL CHARTS (TAB 1) ---
        new Chart(document.getElementById('monthlyTrendChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³', data: total1403, borderColor: '#3b82f6', borderDash: [5,5], tension: 0.4 },
                    { label: 'Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´', data: total1404, borderColor: '#ef4444', borderWidth: 3, tension: 0.4 }
                ]
            }, options: commonOptions
        });

        new Chart(document.getElementById('cumulativeChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'ØªØ¬Ù…Ø¹ÛŒ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³', data: cum1403, borderColor: '#3b82f6', borderDash: [5,5], tension: 0.4 },
                    { label: 'ØªØ¬Ù…Ø¹ÛŒ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´', data: cum1404, borderColor: '#ef4444', borderWidth: 3, tension: 0.4 }
                ]
            }, options: commonOptions
        });

        // Internal Product Chart Logic
        let internalChartInstance = null;
        function initInternalChart() {
            const ctx = document.getElementById('productSpecificChart').getContext('2d');
            internalChartInstance = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [] }, options: commonOptions });
            const select = document.getElementById('productSelect');
            for(const key in allProducts) {
                const opt = document.createElement('option'); opt.value = key; opt.innerHTML = allProducts[key].name; select.appendChild(opt);
            }
            select.value = '212_Pars'; 
            updateProductChart();
        }
        function updateProductChart() {
            const key = document.getElementById('productSelect').value;
            const d = allProducts[key];
            internalChartInstance.data.datasets = [
                { label: 'Ø³Ø§Ø¨Ù‚Ù‡ Û±Û´Û°Û³', data: d.my1403, borderColor: '#3b82f6', borderDash: [5,5], tension: 0.4 },
                { label: 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Û±Û´Û°Û´', data: d.my, borderColor: '#ef4444', borderWidth: 3, tension: 0.4 }
            ];
            internalChartInstance.update();
        }

        // --- MARKET SHARE CHARTS (TAB 2) ---
        let shareChartInstance, compareChartInstance, cumulativeMarketChartInstance, monthlyTotalComparisonChartInstance;

        function initMarketCharts() {
            // 1. Cumulative Market Gap Chart (NEW)
            const ctxCumMarket = document.getElementById('cumulativeMarketChart').getContext('2d');
            cumulativeMarketChartInstance = new Chart(ctxCumMarket, {
                type: 'line',
                data: { labels: labels, datasets: [] },
                options: commonOptions
            });

            // 2. Share Trend
            const ctxShare = document.getElementById('sharePercentChart').getContext('2d');
            shareChartInstance = new Chart(ctxShare, {
                type: 'line',
                data: { labels: labels, datasets: [] },
                options: {
                    ...commonOptions,
                    scales: { y: { min: 0, max: 100, ticks: { callback: function(value){return value + '%'} } } }
                }
            });

            // 3. Monthly Total Comparison Chart (NEW - Replacing Analysis)
            const ctxTotalComp = document.getElementById('monthlyTotalComparisonChart').getContext('2d');
            monthlyTotalComparisonChartInstance = new Chart(ctxTotalComp, {
                type: 'bar', // Base type
                data: { labels: labels, datasets: [] },
                options: commonOptions
            });

            // 4. Compare Product
            const ctxCompare = document.getElementById('compareProductChart').getContext('2d');
            compareChartInstance = new Chart(ctxCompare, { type: 'bar', data: { labels: labels, datasets: [] }, options: commonOptions });
            
            // Populate select
            const select = document.getElementById('compareProductSelect');
            select.innerHTML = '';
            for(const key in allProducts) {
                const opt = document.createElement('option'); opt.value = key; opt.innerHTML = allProducts[key].name; select.appendChild(opt);
            }
            select.value = '212_Pars';
            
            updateMarketTab(); // Initial Load
        }

        function updateMarketTab() {
            const yearMode = document.getElementById('marketYearFilter').value;
            
            // A. Update Cumulative Market Chart (Filter Aware)
            let cumDatasets = [];
            if (yearMode === '1404' || yearMode === 'both') {
                cumDatasets.push({ label: 'ØªÙˆÙ„ÛŒØ¯ ØªØ¬Ù…Ø¹ÛŒ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û´', data: cumOem1404, borderColor: '#059669', borderWidth: 3, tension: 0.4 });
                cumDatasets.push({ label: 'ØªÙˆÙ„ÛŒØ¯ ØªØ¬Ù…Ø¹ÛŒ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´', data: cum1404, borderColor: '#d97706', borderWidth: 3, tension: 0.4 });
            }
            if (yearMode === '1403' || yearMode === 'both') {
                cumDatasets.push({ label: 'ØªØ¬Ù…Ø¹ÛŒ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û³', data: cumOem1403, borderColor: '#6ee7b7', borderDash: [5,5], tension: 0.4 });
                cumDatasets.push({ label: 'ØªØ¬Ù…Ø¹ÛŒ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³', data: cum1403, borderColor: '#fcd34d', borderDash: [5,5], tension: 0.4 });
            }
            cumulativeMarketChartInstance.data.datasets = cumDatasets;
            cumulativeMarketChartInstance.update();


            // B. Update Share Trend Chart
            let shareDatasets = [];
            if (yearMode === '1404' || yearMode === 'both') {
                shareDatasets.push({
                    label: 'Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´ (%)',
                    data: share1404,
                    borderColor: '#7c3aed', 
                    backgroundColor: 'rgba(124, 58, 237, 0.1)',
                    fill: false,
                    tension: 0.4,
                    borderWidth: 3
                });
            }
            if (yearMode === '1403' || yearMode === 'both') {
                shareDatasets.push({
                    label: 'Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø± Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³ (%)',
                    data: share1403,
                    borderColor: '#a78bfa',
                    backgroundColor: 'rgba(167, 139, 250, 0.1)',
                    fill: false,
                    tension: 0.4,
                    borderDash: [5,5],
                    borderWidth: 2
                });
            }
            shareChartInstance.data.datasets = shareDatasets;
            shareChartInstance.update();

            // C. Update Monthly Total Comparison Chart (Replacing Analysis)
            let totalCompDatasets = [];
            if (yearMode === '1403' || yearMode === 'both') {
                 totalCompDatasets.push({ type: 'bar', label: 'Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û³', data: oem1403, backgroundColor: '#94a3b8', order: 4, barPercentage: 0.6 });
                 totalCompDatasets.push({ type: 'line', label: 'Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³', data: total1403, borderColor: '#3b82f6', borderDash: [5,5], borderWidth: 2, tension: 0.4, order: 3 });
            }

            if (yearMode === '1404' || yearMode === 'both') {
                 totalCompDatasets.push({ type: 'bar', label: 'Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û´', data: oem1404, backgroundColor: '#059669', order: 2, barPercentage: 0.6 });
                 totalCompDatasets.push({ type: 'line', label: 'Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´', data: total1404, borderColor: '#d97706', borderWidth: 3, tension: 0.4, order: 1 });
            }
            monthlyTotalComparisonChartInstance.data.datasets = totalCompDatasets;
            monthlyTotalComparisonChartInstance.update();


            // D. Update Product Compare Chart
            updateCompareChart();
        }

        function updateCompareChart() {
            const key = document.getElementById('compareProductSelect').value;
            const yearMode = document.getElementById('marketYearFilter').value;
            const d = allProducts[key];
            
            let datasets = [];

            if (yearMode === '1403' || yearMode === 'both') {
                 datasets.push({ type: 'bar', label: 'ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û³', data: d.oem1403, backgroundColor: '#94a3b8', order: 4, barPercentage: 0.6 });
                 datasets.push({ type: 'line', label: 'ØªÙˆÙ„ÛŒØ¯ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û³', data: d.my1403, borderColor: '#3b82f6', borderDash: [5,5], borderWidth: 2, tension: 0.4, order: 3 });
            }

            if (yearMode === '1404' || yearMode === 'both') {
                 datasets.push({ type: 'bar', label: 'ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ø±ÙˆØ³Ø§Ø² Û±Û´Û°Û´', data: d.oem, backgroundColor: '#059669', order: 2, barPercentage: 0.6 });
                 datasets.push({ type: 'line', label: 'ØªÙˆÙ„ÛŒØ¯ Ø¢Ø°ÛŒÙ† Û±Û´Û°Û´', data: d.my, borderColor: '#d97706', borderWidth: 3, tension: 0.4, order: 1 });
            }

            compareChartInstance.data.datasets = datasets;
            compareChartInstance.update();
        }

        // Initialization
        initInternalChart();
        initMarketCharts();

    </script>
</body>
</html>
