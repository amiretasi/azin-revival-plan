<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø§Ù…Ø¹ ØªØ­Ù„ÛŒÙ„ ØªÙˆÙ„ÛŒØ¯ - Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --primary: #0f172a; /* Slate 900 */
            --secondary: #64748b; /* Slate 500 */
            --accent-1403: #3b82f6; /* Blue for 1403 (Baseline) */
            --accent-1404: #ef4444; /* Red for 1404 (Warning) */
            --success: #10b981;
            --text-main: #334155;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border-right: 6px solid var(--accent-1404);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { margin: 0; font-size: 1.6rem; color: var(--primary); }
        .header p { margin: 5px 0 0; color: var(--secondary); font-size: 0.9rem; }

        /* Grid Layouts */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-row-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 1024px) {
            .chart-row-split { grid-template-columns: 1fr; }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .kpi-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 120px;
            border: 1px solid #e2e8f0;
        }

        .kpi-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .kpi-label { font-size: 0.9rem; color: var(--secondary); }
        .kpi-diff { font-size: 0.85rem; font-weight: bold; }
        .diff-neg { color: var(--accent-1404); }
        .diff-pos { color: var(--success); }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .data-table th { background: #f8fafc; padding: 12px; text-align: right; color: var(--secondary); }
        .data-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }

        .analysis-box {
            background: #fff1f2;
            border-right: 4px solid #be123c;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.95rem;
            line-height: 1.8;
            color: #881337;
        }

        /* Form Controls */
        .control-panel {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
        }

        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            font-family: 'Vazirmatn';
            font-size: 1rem;
            min-width: 250px;
        }

        label {
            font-weight: bold;
            color: var(--primary);
        }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© ØªÙˆÙ„ÛŒØ¯</h1>
            <p>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Û±Û´Û°Û³ (Ú©Ø§Ù…Ù„) Ø¨Ø§ Û±Û´Û°Û´ (ØªØ§ Ù¾Ø§ÛŒØ§Ù† Ø¢Ø¨Ø§Ù† + Û±Û³ Ø±ÙˆØ² Ø¢Ø°Ø±)</p>
        </div>
        <div style="text-align: left;">
            <span style="background: #e2e8f0; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem;">Last Updated: 15 Azar 1404</span>
        </div>
    </div>

    <!-- KPIs -->
    <div class="kpi-grid">
        <div class="card kpi-card">
            <span class="kpi-label">Ù…Ø¬Ù…ÙˆØ¹ ØªÙˆÙ„ÛŒØ¯ Û±Û´Û°Û³ (Ú©Ù„ Ø³Ø§Ù„)</span>
            <span class="kpi-value">293,457</span>
            <span class="kpi-diff" style="color: gray;">Base Line</span>
        </div>
        <div class="card kpi-card">
            <span class="kpi-label">Ù…Ø¬Ù…ÙˆØ¹ ØªÙˆÙ„ÛŒØ¯ Û±Û´Û°Û´ (ØªØ§ Ø§Ù…Ø±ÙˆØ²)</span>
            <span class="kpi-value">113,025</span>
            <span class="kpi-diff diff-neg">Ø¹Ù‚Ø¨â€ŒÙ…Ø§Ù†Ø¯Ú¯ÛŒ Ø´Ø¯ÛŒØ¯ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡</span>
        </div>
        <div class="card kpi-card">
            <span class="kpi-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ØªÙˆÙ„ÛŒØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡ Û±Û´Û°Û´</span>
            <span class="kpi-value">14,128</span>
            <span class="kpi-diff diff-neg">â–¼ Û´Û²Ùª Ú©Ø§Ù‡Ø´ Ù†Ø³Ø¨Øª Ø¨Ù‡ Û±Û´Û°Û³</span>
        </div>
        <div class="card kpi-card">
            <span class="kpi-label">Ù…Ø­ØµÙˆÙ„ Ù¾Ø±Ø®Ø·Ø± (Ù†ÛŒØ³Ø§Ù†)</span>
            <span class="kpi-value" style="color: var(--accent-1404);">1</span>
            <span class="kpi-diff diff-neg">ØªÙˆÙ„ÛŒØ¯ Ù…Ø§Ù‡ Ø¢Ø¨Ø§Ù† (ØªÙˆÙ‚Ù Ú©Ø§Ù…Ù„)</span>
        </div>
    </div>

    <!-- NEW SECTION: Detailed Product Analysis -->
    <div class="chart-row">
        <div class="card" style="border: 2px solid #e2e8f0;">
            <div class="control-panel">
                <label for="productSelect">ğŸ” ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ù…Ø­ØµÙˆÙ„ (Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯):</label>
                <select id="productSelect" onchange="updateProductChart()">
                    <!-- Options populated by JS -->
                </select>
            </div>
            <div style="height: 400px;">
                <canvas id="productSpecificChart"></canvas>
            </div>
            <p style="font-size: 0.8rem; text-align: center; color: gray; margin-top: 10px;">
                Ø®Ø·â€ŒÚ†ÛŒÙ† Ø¢Ø¨ÛŒ: Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ø§Ù„ Û±Û´Û°Û³ (Ù‡Ø¯Ù/Ø³Ø§Ø¨Ù‚Ù‡) | Ø®Ø· Ù…Ù…ØªØ¯ Ù‚Ø±Ù…Ø²: Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ø§Ù„ Û±Û´Û°Û´ (ÙˆØ§Ù‚Ø¹ÛŒ)
            </p>
        </div>
    </div>

    <!-- Chart Row 1: Monthly Comparison (Total) -->
    <div class="chart-row">
        <div class="card">
            <h3 style="margin-bottom: 20px; color: var(--secondary);">Û±. Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ú©Ù„ ØªÙˆÙ„ÛŒØ¯ Ø´Ø±Ú©Øª (Bar Chart)</h3>
            <div style="height: 350px;">
                <canvas id="monthlyBarChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart Row 2: Trends (Split) -->
    <div class="chart-row-split">
        <!-- Monthly Trend Line -->
        <div class="card">
            <h3 style="color: var(--secondary);">Û². Ø±ÙˆÙ†Ø¯ Ù†ÙˆØ³Ø§Ù†Ø§Øª Ú©Ù„ (Trend)</h3>
            <p style="font-size: 0.8rem; color: gray;">Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø®Ø· ØªÙˆÙ„ÛŒØ¯ (Volatility)</p>
            <div style="height: 300px;">
                <canvas id="monthlyTrendChart"></canvas>
            </div>
        </div>

        <!-- Cumulative Trend Line -->
        <div class="card">
            <h3 style="color: var(--secondary);">Û³. Ø¹Ù…Ù„Ú©Ø±Ø¯ ØªØ¬Ù…Ø¹ÛŒ (Cumulative Gap)</h3>
            <p style="font-size: 0.8rem; color: gray;">ÙØ§ØµÙ„Ù‡ Ø¨Ø§Ø² Ø´Ø¯Ù‡ Ø¨ÛŒÙ† Ø¯Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± = Ú©Ø³Ø±ÛŒ ØªÙˆÙ„ÛŒØ¯</p>
            <div style="height: 300px;">
                <canvas id="cumulativeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Analysis & Tables -->
    <div class="chart-row">
        <div class="card">
            <h3>ØªØ­Ù„ÛŒÙ„ Ø´Ú©Ø§Ù Ø¹Ù…Ù„Ú©Ø±Ø¯ (Performance Gap Analysis)</h3>
            <div class="analysis-box">
                <strong>âš ï¸ ØªØ­Ù„ÛŒÙ„ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§Ù‡Ø¨Ø±Ø¯ÛŒ:</strong><br>
                Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ ØªÙÚ©ÛŒÚ©ÛŒ Ø­Ø§Ú©ÛŒ Ø§Ø² <strong>Ø§Ù†Ø­Ø±Ø§Ù Ù…Ù†ÙÛŒ Ø´Ø¯ÛŒØ¯</strong> Ø¯Ø± ØªÛŒØ±Ø§Ú˜ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ (Ù†ÛŒØ³Ø§Ù† Ùˆ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ X200) Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø®Ø· Ù…Ø¨Ù†Ø§ÛŒ Ø³Ø§Ù„ Û±Û´Û°Û³ Ø§Ø³Øª. Ù†Ù…ÙˆØ¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ (Û±Û´Û°Û´) Ø¯Ø± Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù…Ø­ØµÙˆÙ„Ø§ØªØŒ ÙØ§ØµÙ„Ù‡ Ù…Ø¹Ù†Ø§Ø¯Ø§Ø±ÛŒ Ø¨Ø§ Ø§Ù‡Ø¯Ø§Ù Ø³Ù†ÙˆØ§ØªÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.
                <br>Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ØŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ <strong>Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø§Ø·Ù„Ø³</strong> Ùˆ ÙˆØ±ÙˆØ¯ <strong>Ú©Ø§Ù…ÛŒÙˆÙ†Øª Ø§Ú©Ø³ØªÙ†Ø¯</strong> Ø¨Ù‡ Ú†Ø±Ø®Ù‡ ØªÙˆÙ„ÛŒØ¯ØŒ ØªÙ†Ù‡Ø§ Ù†Ù‚Ø§Ø·ÛŒ Ù‡Ø³ØªÙ†Ø¯ Ú©Ù‡ Â«Ø±ÙˆÙ†Ø¯ Ù…Ø«Ø¨ØªÂ» Ùˆ Ø­Ø±Ú©Øª Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø®Ø· Ù…Ø¨Ù†Ø§ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯.
                <br><strong>Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ:</strong> Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ØŒ ØªØºÛŒÛŒØ± Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù„Ø¬Ø³ØªÛŒÚ© Ùˆ ØªØ®ØµÛŒØµ Ù…Ù†Ø§Ø¨Ø¹ Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§Øª Ø²ÛŒØ§Ù†â€ŒØ¯Ù‡ Ø¨Ø§ Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒØŒ Ø¨Ù‡ Ø³Ù…Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¬Ø¯ÛŒØ¯ (Ø§Ú©Ø³ØªÙ†Ø¯ Ùˆ Ø§Ø·Ù„Ø³) Ø¬Ù‡Øª Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø§Ø´ÛŒÙ‡ Ø³ÙˆØ¯ Ùˆ Ø¬Ø±ÛŒØ§Ù† Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.
            </div>
            
            <h4 style="margin-top: 30px;">ÙˆØ¶Ø¹ÛŒØª Ø³Ø¨Ø¯ Ù…Ø­ØµÙˆÙ„ (Product Mix)</h4>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ù…Ø­ØµÙˆÙ„</th>
                        <th>Û±Û´Û°Û³ (Ú©Ù„)</th>
                        <th>Û±Û´Û°Û´ (YTD)</th>
                        <th>ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø§Ø·Ù„Ø³</td>
                        <td>Û²Ûµ,Û·Û²Ûµ</td>
                        <td>Û±Û¶,Û²Û±Û´</td>
                        <td style="color: var(--success); font-weight: bold;">Ù…Ø­ØµÙˆÙ„ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† (Stable)</td>
                    </tr>
                    <tr>
                        <td>Ù†ÛŒØ³Ø§Ù† Ùˆ Ù¾Ø§Ø¯Ø±Ø§</td>
                        <td>Û´Û¹,Û¶Û·Û²</td>
                        <td>Û±Û·,Û³Û¹Û¶</td>
                        <td style="color: var(--accent-1404); font-weight: bold;">Ø¨Ø­Ø±Ø§Ù†ÛŒ (Critical Drop)</td>
                    </tr>
                    <tr>
                        <td>Ø´Ø§Ù‡ÛŒÙ† (Ù‡Ù…Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§)</td>
                        <td>Û²Û±,Û´Û±Û°</td>
                        <td>Û·,Û¸Û°Û´</td>
                        <td style="color: #f59e0b; font-weight: bold;">Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø²Ù†Ø¬ÛŒØ±Ù‡ ØªØ£Ù…ÛŒÙ†</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- DATA SETUP ---
        const labels = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];

        // Total Data
        const total1403 = [15861, 33150, 30828, 28040, 20318, 20808, 31300, 23627, 22708, 22212, 23326, 21279];
        const total1404 = [12174, 25148, 13143, 12074, 8264, 17073, 14800, 10349, null, null, null, null];

        // Cumulative Data
        const cum1403 = [];
        total1403.reduce((a, b, i) => cum1403[i] = a + b, 0);

        const cum1404 = [];
        let sum = 0;
        for(let val of total1404) {
            if(val !== null) {
                sum += val;
                cum1404.push(sum);
            } else {
                cum1404.push(null);
            }
        }

        // Product Breakdown Data (The "Meat" of the new chart)
        const productsData = {
            '131_Export': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 131 ØµØ§Ø¯Ø±Ø§Øª',
                d1403: [1, 128, 112, 0, 12, 0, 120, 480, 0, 0, 232, 72],
                d1404: [56, 184, 128, 60, 0, 240, 60, 128, null, null, null, null]
            },
            '151_Benro': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 151 (Ø·Ø±Ø­ Ú©ÙˆÛŒÛŒÚ© - Ø¨Ù†â€ŒØ±Ùˆ)',
                d1403: [3584, 7360, 6824, 6008, 5264, 5448, 7032, 5848, 5896, 6317, 6465, 5808],
                d1404: [160, 4592, 3304, 2192, 1232, 5264, 3621, 2596, null, null, null, null]
            },
            '212_Saipa': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 212 Ø³Ø§ÛŒÙ¾Ø§',
                d1403: [5124, 10172, 8112, 5148, 2120, 2480, 6528, 2748, 3024, 2468, 3820, 4672],
                d1404: [2716, 5536, 2488, 2084, 1560, 1336, 920, 884, null, null, null, null]
            },
            '212R_Pars': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 212-R Ù¾Ø§Ø±Ø³ Ø®ÙˆØ¯Ø±Ùˆ',
                d1403: [232, 600, 296, 768, 444, 576, 1148, 580, 484, 408, 320, 64],
                d1404: [372, 680, 320, 304, 0, 192, 0, 128, null, null, null, null]
            },
            '232_Kashan': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ 232 Ú©Ø§Ø´Ø§Ù†',
                d1403: [2524, 5596, 5260, 5936, 4268, 2924, 4488, 3256, 3880, 3868, 2852, 1816],
                d1404: [1880, 3696, 1888, 1456, 1240, 1588, 1464, 840, null, null, null, null]
            },
            'Shahin_Normal': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø´Ø§Ù‡ÛŒÙ† Ù…Ø¹Ù…ÙˆÙ„ÛŒ',
                d1403: [512, 1504, 1408, 1112, 776, 264, 912, 520, 648, 600, 416, 416],
                d1404: [280, 792, 352, 472, 152, 616, 728, 192, null, null, null, null]
            },
            'Shahin_CVT': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø´Ø§Ù‡ÛŒÙ† CVT',
                d1403: [568, 1160, 1064, 976, 632, 576, 784, 1024, 488, 672, 720, 792],
                d1404: [168, 728, 752, 432, 420, 80, 128, 216, null, null, null, null]
            },
            'Shahin_Plus': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø´Ø§Ù‡ÛŒÙ† Ù¾Ù„Ø§Ø³ (Ø¨Ø±Ù‚ÛŒ)',
                d1403: [0, 38, 204, 40, 0, 136, 760, 32, 0, 248, 920, 488],
                d1404: [712, 584, 0, 0, 0, 0, 0, 0, null, null, null, null]
            },
            'Atlas': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø§Ø·Ù„Ø³ (Ú©Ù„)',
                d1403: [856, 160, 1596, 2968, 1784, 3052, 808, 1964, 2764, 3368, 2972, 3313],
                d1404: [1988, 3046, 864, 1440, 1820, 2572, 2360, 1656, null, null, null, null]
            },
            'Sahand_Cloth': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ø³Ù‡Ù†Ø¯ Ù¾Ø§Ø±Ú†Ù‡â€ŒØ§ÛŒ',
                d1403: [0, 80, 160, 464, 1668, 2548, 3200, 2628, 1588, 316, 696, 636],
                d1404: [872, 952, 748, 984, 596, 1240, 1464, 768, null, null, null, null]
            },
            'Nissan': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ù†ÛŒØ³Ø§Ù†',
                d1403: [2440, 5910, 5691, 4530, 3350, 2800, 5500, 4521, 3870, 3870, 3820, 3060],
                d1404: [2740, 3950, 1810, 2140, 200, 20, 30, 1, null, null, null, null]
            },
            'Padra_Plus': {
                name: 'ØµÙ†Ø¯Ù„ÛŒ Ù¾Ø§Ø¯Ø±Ø§ Ù¾Ù„Ø§Ø³',
                d1403: [0, 50, 0, 0, 0, 0, 0, 10, 50, 50, 60, 90],
                d1404: [150, 320, 405, 410, 980, 3405, 485, 350, null, null, null, null]
            },
            'Extend': {
                name: 'Ú©Ø§Ù…ÛŒÙˆÙ†Øª Ø§Ú©Ø³ØªÙ†Ø¯',
                d1403: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                d1404: [0, 0, 0, 0, 0, 0, 3180, 2590, null, null, null, null]
            }
        };

        // --- CHART CONFIGURATION ---
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: { font: { family: 'Vazirmatn' } }
                },
                tooltip: {
                    titleFont: { family: 'Vazirmatn' },
                    bodyFont: { family: 'Vazirmatn' },
                    rtl: true,
                    textDirection: 'rtl'
                }
            },
            scales: {
                x: { ticks: { font: { family: 'Vazirmatn' } } },
                y: { ticks: { font: { family: 'Vazirmatn' } }, beginAtZero: true }
            }
        };

        // 1. Initial Product Chart
        let productChartInstance = null;

        function initProductChart() {
            const ctx = document.getElementById('productSpecificChart').getContext('2d');
            productChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: []
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Ø±ÙˆÙ†Ø¯ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØµÙˆÙ„ (Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø³Ø§Ù„Ø§Ù†Ù‡)',
                            font: { family: 'Vazirmatn', size: 16 }
                        }
                    }
                }
            });
            
            // Populate Select Options
            const select = document.getElementById('productSelect');
            for (const key in productsData) {
                const opt = document.createElement('option');
                opt.value = key;
                opt.innerHTML = productsData[key].name;
                select.appendChild(opt);
            }
            
            // Set default to 151 or Atlas
            select.value = '151_Benro';
            updateProductChart();
        }

        function updateProductChart() {
            const selectedKey = document.getElementById('productSelect').value;
            const pData = productsData[selectedKey];
            
            productChartInstance.data.datasets = [
                {
                    label: 'Û±Û´Û°Û³ (Ù‡Ø¯Ù/Ø³Ø§Ø¨Ù‚Ù‡)',
                    data: pData.d1403,
                    borderColor: '#3b82f6', // Blue
                    borderWidth: 2,
                    borderDash: [5, 5], // Dashed
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    pointRadius: 3,
                    tension: 0.3
                },
                {
                    label: 'Û±Û´Û°Û´ (Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ)',
                    data: pData.d1404,
                    borderColor: '#ef4444', // Red
                    borderWidth: 3, // Thicker solid line
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    pointRadius: 5,
                    tension: 0.3
                }
            ];
            productChartInstance.update();
        }

        // 2. Monthly Bar Chart (Total)
        new Chart(document.getElementById('monthlyBarChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ØªÙˆÙ„ÛŒØ¯ Û±Û´Û°Û³',
                        data: total1403,
                        backgroundColor: '#cbd5e1', 
                        borderRadius: 4
                    },
                    {
                        label: 'ØªÙˆÙ„ÛŒØ¯ Û±Û´Û°Û´',
                        data: total1404,
                        backgroundColor: '#ef4444', 
                        borderRadius: 4
                    }
                ]
            },
            options: commonOptions
        });

        // 3. Monthly Trend Chart (Total Line)
        new Chart(document.getElementById('monthlyTrendChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Ø±ÙˆÙ†Ø¯ Ú©Ù„ Û±Û´Û°Û³',
                        data: total1403,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        borderDash: [5, 5], // Dashed
                        fill: false
                    },
                    {
                        label: 'Ø±ÙˆÙ†Ø¯ Ú©Ù„ Û±Û´Û°Û´',
                        data: total1404,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        tension: 0.3,
                        borderWidth: 3, // Solid
                        fill: false
                    }
                ]
            },
            options: commonOptions
        });

        // 4. Cumulative Chart
        new Chart(document.getElementById('cumulativeChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ØªØ¬Ù…Ø¹ÛŒ Û±Û´Û°Û³',
                        data: cum1403,
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        tension: 0.1,
                        borderDash: [5, 5], // Dashed as per request
                        pointRadius: 0
                    },
                    {
                        label: 'ØªØ¬Ù…Ø¹ÛŒ Û±Û´Û°Û´',
                        data: cum1404,
                        borderColor: '#ef4444',
                        borderWidth: 3,
                        tension: 0.1
                    }
                ]
            },
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    tooltip: {
                        ...commonOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('fa-IR').format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // Initialize
        initProductChart();

    </script>
</body>
</html>
