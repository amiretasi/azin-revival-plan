<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد جامع فرماندهی سایپا آذین</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        
        :root {
            --primary: #0f172a;
            --secondary: #3b82f6;
            --accent: #b45309;
            --danger: #be123c;
            --success: #047857;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --header-grad: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --font-main: 'Vazirmatn', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: #334155;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .dashboard-header {
            background: var(--header-grad);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            margin-bottom: 25px;
            border-bottom: 4px solid var(--accent);
        }
        .dashboard-header h1 { margin: 0; font-weight: 900; font-size: 2.2rem; letter-spacing: -0.5px; }
        .dashboard-header p { margin: 8px 0 0; font-weight: 300; color: #cbd5e1; font-size: 1.05rem; }

        .container-custom {
            max-width: 1380px;
            margin: 0 auto;
            padding: 0 20px 60px 20px;
        }

        .kpi-card-main {
            flex: 1;
            background: var(--card-bg);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-right: 5px solid var(--secondary);
            min-width: 200px;
            text-align: center;
            transition: transform 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .kpi-card-main:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .kpi-title { font-size: 0.9rem; color: #64748b; font-weight: 700; margin-bottom: 5px; }
        .kpi-value { font-size: 1.6rem; font-weight: 900; color: var(--primary); }
        .kpi-sub { font-size: 0.8rem; font-weight: 600; margin-top: 5px; color: #64748b; }

        .tabs-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            background: #e2e8f0;
            padding: 5px;
            border-radius: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            flex-wrap: wrap;
        }
        .tab-btn {
            padding: 10px 25px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1rem;
            color: #64748b;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.5); color: var(--primary); }
        .tab-btn.active { background: white; color: var(--secondary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .accordion {
            background-color: var(--card-bg); color: var(--primary); cursor: pointer; padding: 16px 25px; width: 100%; text-align: right; border: none; outline: none; transition: 0.3s; font-size: 1.1rem; font-weight: 800; border-radius: 10px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.04); font-family: var(--font-main);
        }
        .accordion:hover { background-color: #e2e8f0; }
        .accordion.active { background-color: white; border-bottom: 3px solid var(--secondary); color: var(--secondary); border-radius: 10px 10px 0 0; }
        .accordion::after { content: '\f078'; font-family: "Font Awesome 6 Free"; font-weight: 900; color: #94a3b8; transition: transform 0.3s; }
        .accordion.active::after { transform: rotate(180deg); color: var(--secondary); }

        .panel { padding: 0; background-color: transparent; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; margin-bottom: 20px; }
        .panel-content { background: white; padding: 25px; border-radius: 0 0 10px 10px; box-shadow: 0 5px 15px -5px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; border-top: none; }

        .panel-financial .accordion { border-right: 6px solid var(--danger); }
        .panel-retiree .accordion { border-right: 6px solid var(--accent); }
        .panel-fleet .accordion { border-right: 6px solid #0f172a; } 
        
        .chart-box {
            background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; height: 450px; display: flex; flex-direction: column; position: relative;
        }
        .chart-box h3 { margin: 0 0 15px 0; font-size: 1rem; color: #334155; font-weight: 800; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; width: 100%; text-align: center; }
        
        .side-by-side { display: flex; width: 100%; height: 100%; align-items: center; justify-content: center; gap: 20px; }
        .side-chart { width: 48%; height: 100%; position: relative; display: flex; justify-content: center; align-items: center; }
        .side-table-container { width: 48%; height: 100%; overflow-y: auto; }

        .table-wrapper { max-height: 450px; overflow-y: auto; border: 1px solid #cbd5e1; border-radius: 8px; background: white; }
        table.main-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        table.main-table th { background-color: var(--primary); color: white; position: sticky; top: 0; padding: 12px; text-align: right; font-weight: 700; z-index: 10; cursor: pointer; }
        table.main-table td { padding: 10px 12px; border-bottom: 1px solid #f1f5f9; }
        table.main-table tr:hover { background-color: #f0f9ff; }

        .badge { padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; display: inline-block; }
        .badge-active { background: #dcfce7; color: #166534; }
        .badge-inactive { background: #fee2e2; color: #991b1b; }
        .badge-repair { background: #ffedd5; color: #9a3412; }
        
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="dashboard-header">
        <h1>داشبورد جامع فرماندهی</h1>
        <p>تحلیل استراتژیک سرمایه انسانی و وضعیت مالی شرکت سایپا آذین | آذر ۱۴۰۴</p>
    </div>

    <div class="container-custom">

        <!-- Top Level KPIs -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
             <div class="bg-white p-5 rounded-xl shadow-md border-r-4 border-blue-800 flex flex-col justify-center text-center">
                <span class="text-gray-500 text-sm font-bold">کل پرسنل فعال</span>
                <span class="text-2xl font-black text-blue-900" id="global-total">1,004</span>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-md border-r-4 border-emerald-600 flex flex-col justify-center text-center">
                <span class="text-gray-500 text-sm font-bold">نیروهای صف</span>
                <span class="text-2xl font-black text-emerald-700" id="global-saf">771</span>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-md border-r-4 border-amber-500 flex flex-col justify-center text-center">
                 <span class="text-gray-500 text-sm font-bold">نیروهای ستاد</span>
                 <span class="text-2xl font-black text-amber-600" id="global-setad">233</span>
            </div>
             <div class="bg-white p-5 rounded-xl shadow-md border-r-4 border-red-600 flex flex-col justify-center text-center">
                 <span class="text-gray-500 text-sm font-bold">دیون تجمعی (سنوات)</span>
                 <span class="text-2xl font-black text-red-700">1,622 م.ر</span>
            </div>
        </div>

        <!-- TABS NAVIGATION -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="openTab('tab-hr')">منابع انسانی و ساختار</button>
            <button class="tab-btn" onclick="openTab('tab-fleet')">ناوگان خودرویی</button>
            <button class="tab-btn" onclick="openTab('tab-finance')">مالی و بودجه</button>
            <button class="tab-btn" onclick="openTab('tab-contract')">تعاونی و قراردادها</button>
            <button class="tab-btn" onclick="openTab('tab-retiree')">بازنشستگان و سنوات</button>
        </div>

        <!-- TAB 1: HR & Structure -->
        <div id="tab-hr" class="tab-content active">
             <!-- File Upload Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-slate-200">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex-1">
                        <h2 class="text-lg font-bold text-slate-800 mb-2">۱. بارگذاری داده‌ها</h2>
                        <p class="text-sm text-gray-600">لطفاً فایل CSV پرسنلی خود را انتخاب کنید (در غیر این صورت داده‌های پیش‌فرض نمایش داده می‌شود).</p>
                    </div>
                    <div class="flex-1 w-full">
                        <label class="flex flex-col items-center justify-center w-full h-20 border-2 border-slate-300 border-dashed rounded-lg cursor-pointer bg-slate-50 hover:bg-slate-100 transition">
                            <div class="flex flex-col items-center justify-center pt-2">
                                <p class="text-sm text-gray-500"><span class="font-semibold">کلیک برای انتخاب فایل CSV</span></p>
                            </div>
                            <input id="csvInput" type="file" class="hidden" accept=".csv" />
                        </label>
                    </div>
                </div>
                <div id="errorMessage" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
            </div>

            <!-- HR KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-md p-5 border-r-4 border-blue-600">
                    <div class="text-gray-500 text-sm mb-1">تعداد رکورد</div>
                    <div class="text-3xl font-bold text-gray-800 flex items-center gap-2">
                        <span id="totalPersonnel">0</span>
                        <div class="loader" id="loader1"></div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-5 border-r-4 border-emerald-600">
                    <div class="text-gray-500 text-sm mb-1">مدیران و سرپرستان</div>
                    <div class="text-3xl font-bold text-gray-800" id="totalManagers">0</div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-5 border-r-4 border-amber-500">
                    <div class="text-gray-500 text-sm mb-1">پرسنل رسمی</div>
                    <div class="text-3xl font-bold text-gray-800" id="officialEmp">0</div>
                </div>
                 <div class="bg-white rounded-xl shadow-md p-5 border-r-4 border-purple-600">
                    <div class="text-gray-500 text-sm mb-1">تراکم مدرک (اکثریت)</div>
                    <div class="text-xl font-bold text-gray-800" id="dominantDegree">-</div>
                </div>
            </div>

            <!-- Row 1: Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Age Analysis -->
                <div class="bg-white rounded-xl shadow-md p-6 col-span-1">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">تحلیل میانگین سنی (تفکیکی)</h3>
                    <div class="h-64">
                        <canvas id="ageChart"></canvas>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 text-center">مبنای محاسبات: سال 1404</div>
                </div>
                
                <!-- Saf vs Setad Ratio -->
                <div class="bg-white rounded-xl shadow-md p-6 col-span-1">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">نسبت صف به ستاد</h3>
                    <div class="h-64 flex justify-center">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Setad Majors ONLY -->
                <div class="bg-white rounded-xl shadow-md p-6 col-span-1">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">رشته‌های تحصیلی (فقط ستاد)</h3>
                    <div class="h-64">
                        <canvas id="majorChart"></canvas>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 text-center">نمایش 8 رشته پرتکرار در بدنه ستادی</div>
                </div>
            </div>

            <!-- Row 2: Unit Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Unit Chart (Visual) -->
                <div class="bg-white rounded-xl shadow-md p-6 col-span-2">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">نمودار تراکم نفرات در واحدها (Top 10)</h3>
                    <div class="h-80">
                        <canvas id="unitChart"></canvas>
                    </div>
                </div>
                
                <!-- Unit List (Detailed Table) -->
                <div class="bg-white rounded-xl shadow-md p-6 col-span-1 flex flex-col h-full" style="max-height: 420px;">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">آمار دقیق تمام واحدها</h3>
                    <div class="flex-1 overflow-y-auto custom-scrollbar pr-2">
                        <table class="w-full text-sm text-right">
                            <thead class="text-xs text-gray-500 bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="py-2 px-2">نام واحد</th>
                                    <th class="py-2 px-2 text-left">تعداد</th>
                                </tr>
                            </thead>
                            <tbody id="unitTableBody" class="text-gray-700">
                                <tr><td colspan="2" class="text-center py-4 text-xs">داده‌ای موجود نیست</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Row 3: Demographics -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">توزیع مدرک تحصیلی (کل شرکت)</h3>
                    <div class="h-64">
                        <canvas id="educationChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">توزیع سمت‌های سازمانی</h3>
                    <div class="h-64">
                        <canvas id="positionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Row 4: Gender -->
            <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 mb-8">
                 <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">ترکیب جنسیتی کل سازمان</h3>
                    <div class="h-48 flex justify-center">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                <div class="p-4 bg-gray-50 border-b flex flex-col md:flex-row justify-between items-center gap-4">
                    <h3 class="text-lg font-bold text-gray-800">لیست جامع پرسنل</h3>
                    
                    <!-- Search Box -->
                    <div class="relative w-full md:w-1/3">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <svg class="w-4 h-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                            </svg>
                        </div>
                        <input type="text" id="tableSearch" class="block w-full p-2 pr-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500" placeholder="جستجو (نام، شماره، سمت، واحد)...">
                    </div>

                    <div class="flex items-center gap-2">
                         <span class="text-xs text-gray-500" id="tableCount">نمایش 0 ردیف</span>
                    </div>
                </div>
                
                <div class="overflow-x-auto custom-scrollbar" style="max-height: 500px; overflow-y: auto;">
                    <table class="w-full text-sm text-right text-gray-600">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="px-6 py-4 whitespace-nowrap">شماره پرسنلی</th>
                                <th class="px-6 py-4 whitespace-nowrap">نام و نام خانوادگی</th>
                                <th class="px-6 py-4 whitespace-nowrap">سن</th>
                                <th class="px-6 py-4 whitespace-nowrap">سمت</th>
                                <th class="px-6 py-4 whitespace-nowrap">واحد سازمانی</th>
                                <th class="px-6 py-4 whitespace-nowrap">مدرک تحصیلی</th>
                                <th class="px-6 py-4 whitespace-nowrap">رشته تحصیلی</th>
                                <th class="px-6 py-4 whitespace-nowrap">رسته (صف/ستاد)</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="8" class="text-center py-8 text-gray-400">
                                    در حال بارگذاری داده‌ها...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 2: Fleet Management -->
        <div id="tab-fleet" class="tab-content">
            <div class="accordion-wrapper panel-fleet">
                <button class="accordion">وضعیت ناوگان خودرویی شرکت</button>
                <div class="panel" style="max-height: 2000px;"><div class="panel-content"> <!-- Default Open -->
                    <div class="charts-grid">
                        <div class="chart-box full-width" style="height: auto; min-height: 400px;">
                            <h3>لیست خودروهای در اختیار و عمومی (آبان ۱۴۰۴)</h3>
                             <div class="table-wrapper" style="border:none; max-height: 600px;">
                                <table class="main-table" id="fleetTable">
                                    <thead>
                                        <tr>
                                            <th>ردیف</th>
                                            <th>تحویل گیرنده</th>
                                            <th>سمت / واحد</th>
                                            <th>نوع خودرو</th>
                                            <th>سال</th>
                                            <th>پلاک</th>
                                            <th>نوع کاربری</th>
                                            <th>وضعیت فنی</th>
                                            <th>وضعیت کلی</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div></div>
            </div>
        </div>

        <!-- TAB 3: Finance -->
        <div id="tab-finance" class="tab-content">
             <!-- 6. Financial Analysis -->
             <div class="accordion-wrapper panel-financial">
                <button class="accordion">آنالیز مالی (حقوق، بودجه و بدهی)</button>
                <div class="panel" style="max-height: 2000px;"><div class="panel-content">
                    <div class="charts-grid">
                        
                        <!-- Budget Section -->
                        <div class="chart-box full-width" style="height: 350px;">
                            <h3>بودجه ماهانه مورد نیاز (آبان ۱۴۰۴) - منطبق با برآورد مالی</h3>
                            <div class="side-by-side">
                                <div class="side-table-container">
                                    <table class="mini-table" style="width: 100%;">
                                        <tbody id="budgetTableBody"></tbody>
                                    </table>
                                    <div style="margin-top: 15px; padding: 8px; background: #fff1f2; border: 1px solid #ef4444; border-radius: 6px; text-align: center; font-weight: 900; color: #991b1b; font-size: 0.95rem;">
                                        جمع کل ناخالص بودجه ماهانه: ۵۱۰,۵۴۵,۵۵۰,۷۶۲ ریال
                                    </div>
                                </div>
                                <div class="side-chart"><canvas id="budgetChart"></canvas></div>
                            </div>
                        </div>

                        <!-- Debt & Insurance Side by Side -->
                        <div class="chart-box full-width" style="height: 450px;">
                            <h3>آنالیز جامع بدهی‌ها و تعهدات بیمه‌ای</h3>
                            <div class="side-by-side">
                                <div class="side-chart" style="width: 48%;">
                                    <canvas id="debtChart"></canvas>
                                </div>
                                <div class="side-chart" style="width: 48%;">
                                    <canvas id="insuranceChart"></canvas>
                                </div>
                            </div>
                        </div>

                    </div>
                </div></div>
            </div>
        </div>
        
        <!-- TAB 4: Contract Expiry (New Independent Tab) -->
        <div id="tab-contract" class="tab-content">
            <!-- NEW: Contract Expiry Section -->
            <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden flex flex-col mt-6">
                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 flex-shrink-0">
                    <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        لیست انقضای قراردادها (پرسنل تعاونی و...)
                    </h3>
                    <div class="flex gap-2 items-center">
                         <div id="alert-box" class="bg-red-50 border border-red-200 text-red-700 px-3 py-1 rounded flex items-center gap-2 text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                            <span id="alert-text">در حال محاسبه...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Charts for Contract Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6 bg-slate-50 border-b border-slate-200">
                     <!-- Department Chart -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-6">توزیع پرسنل قراردادی به تفکیک واحد</h3>
                        <div id="dept-chart-contract" class="space-y-4">
                            <!-- Bars will be inserted here by JS -->
                        </div>
                    </div>

                    <!-- Shift Chart -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center">
                        <h3 class="text-lg font-bold text-slate-800 mb-6">ترکیب شیفت کاری</h3>
                        <div class="relative w-40 h-40 flex items-center justify-center">
                            <svg viewBox="0 0 36 36" class="w-full h-full transform -rotate-90">
                                <path class="text-slate-100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="4" />
                                <path id="ring-shift" class="text-amber-500" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="4" />
                                <path id="ring-fixed" class="text-blue-600" stroke-dasharray="0, 100" stroke-dashoffset="0" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="4" />
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span class="text-2xl font-bold text-slate-800" id="donut-total">0</span>
                                <span class="text-[10px] text-slate-500">مجموع</span>
                            </div>
                        </div>
                         <div class="w-full mt-4 space-y-2">
                            <div class="flex justify-between items-center p-1 rounded bg-amber-50 text-xs">
                                <span>شیفتی</span>
                                <span class="font-bold" id="legend-shift">0</span>
                            </div>
                            <div class="flex justify-between items-center p-1 rounded bg-blue-50 text-xs">
                                <span>ثابت</span>
                                <span class="font-bold" id="legend-fixed">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="overflow-auto flex-grow custom-scrollbar" style="max-height: 500px;">
                    <table class="w-full text-right relative border-collapse">
                        <thead class="bg-slate-50 text-slate-500 text-sm sticky top-0 shadow-sm z-10">
                            <tr>
                                <th class="p-4 font-medium bg-slate-50">ردیف</th>
                                <th class="p-4 font-medium bg-slate-50">نام پرسنل</th>
                                <th class="p-4 font-medium bg-slate-50">واحد سازمانی</th>
                                <th class="p-4 font-medium bg-slate-50">نوع شیفت</th>
                                <th class="p-4 font-medium bg-slate-50">تاریخ اتمام قرارداد</th>
                                <th class="p-4 font-medium bg-slate-50">وضعیت</th>
                            </tr>
                        </thead>
                        <tbody id="table-body-contract" class="divide-y divide-slate-100 text-sm">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- TAB 5: Retirees & Resigned (New Independent Tab) -->
        <div id="tab-retiree" class="tab-content">
             <!-- 5. Retirees & Resigned -->
             <div class="accordion-wrapper panel-retiree">
                <button class="accordion">وضعیت بازنشستگان و مستعفی‌ها (اصلاح شده)</button>
                <div class="panel" style="max-height: 2000px;"><div class="panel-content">
                    
                    <div class="charts-grid">
                        <!-- Debt Share Pie + Table -->
                        <div class="chart-box full-width" style="height: 350px;">
                            <h3>سهم بدهی سنوات (لیست جاری)</h3>
                            <div class="side-by-side">
                                <div class="side-chart"><canvas id="retireeDebtChart"></canvas></div>
                                <div class="side-table-container">
                                    <table class="mini-table">
                                        <tr>
                                            <td class="label">بازنشستگان (لیست جدید)</td>
                                            <td class="value" style="color: #d97706;" id="sum-retired-table">0</td>
                                        </tr>
                                        <tr>
                                            <td class="label">مستعفی و قطع همکاری (لیست کامل)</td>
                                            <td class="value" style="color: #1e3a8a;" id="sum-resigned-table">0</td>
                                        </tr>
                                        <tr style="background: #fffbeb; border-top: 2px solid #d97706;">
                                            <td class="label" style="font-weight: 900; color: #92400e;">جمع تعهدات جاری (نمایشی)</td>
                                            <td class="value" style="font-size: 1.1rem; color: #92400e;" id="sum-total-table">0</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Split Tables -->
                        <div class="chart-box full-width tall-chart" style="height: auto; min-height: 500px;">
                            <!-- Retired Table -->
                            <div class="section-title">
                                لیست بازنشستگان (عادی و زیان‌آور)
                                <span class="total-display" id="total-retired-display">جمع: ...</span>
                            </div>
                            <div class="table-wrapper" style="height: 250px; margin-bottom: 30px;">
                                <table class="main-table" id="retiredTableList">
                                    <thead>
                                        <tr>
                                            <th>ردیف</th><th>پرسنلی</th><th>نام و نام خانوادگی</th><th>تاریخ قطع همکاری</th><th>مانده سنوات (ریال)</th><th>علت انفصال</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>

                            <!-- Resigned Table -->
                            <div class="section-title" style="color: #1e3a8a; border-color: #1e3a8a;">
                                لیست مستعفی‌ها و قطع همکاری
                                <span class="total-display" style="color: #1e3a8a; background: #e0f2fe;" id="total-resigned-display">جمع: ...</span>
                            </div>
                            <div class="table-wrapper" style="height: 250px;">
                                <table class="main-table" id="resignedTableList">
                                    <thead>
                                        <tr>
                                            <th>ردیف</th><th>پرسنلی</th><th>نام و نام خانوادگی</th><th>تاریخ قطع همکاری</th><th>مانده سنوات (ریال)</th><th>توضیحات</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div></div>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIG ---
        Chart.register(ChartDataLabels);
        Chart.defaults.set('plugins.datalabels', { display: false });
        Chart.defaults.font.family = 'Vazirmatn';
        Chart.defaults.color = '#334155';
        Chart.defaults.scale.grid.color = '#e2e8f0';

        // --- GLOBAL VARIABLES ---
        let globalData = [];
        let eduChart, posChart, genChart, majChart, ageChart, categoryChart, unitChart;
        
        // --- SETAD PERSONNEL (Representative List) ---
        const setadPersonnel = [
            {id:'308',name:'رضا صحبت ‌لو',unit:'حراست',degree:'ديپلم',major:'اقتصاد',safSetad:'ستاد'},
            {id:'378',name:'فاطمه ايوبي',unit:'طرح و برنامه',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'425',name:'ابوالقاسم مشايخي',unit:'کيفيت',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'534',name:'بهناز آقابگلو',unit:'کيفيت',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'583',name:'شهرام بزرگ نژاد',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'790',name:'هادي تحويلداري بيدروني',unit:'نگهداري و تعميرات',degree:'ليسانس',major:'مترجمي زبان انگليسي',safSetad:'ستاد'},
            {id:'807',name:'حميدرضا قلي زاده بيرون',unit:'مديريت عامل',degree:'ليسانس',major:'علوم اجتماعي',safSetad:'ستاد'},
            {id:'810',name:'شهرام پارساء',unit:'نگهداري و تعميرات',degree:'فوق ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'850',name:'بابک اناري',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'859',name:'عباس خانقلي پور',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'869',name:'بيژن عزتي نيا',unit:'برنامه ريزي',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'877',name:'مني زارعي',unit:'اداري',degree:'ليسانس',major:'مترجمي زبان انگليسي',safSetad:'ستاد'},
            {id:'893',name:'فردين قاسمي',unit:'برنامه ريزي',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'895',name:'مجيد نيک فلاح',unit:'کيفيت',degree:'فوق ديپلم',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'905',name:'كريم بهدادكيا',unit:'تحقيق وتوسعه',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'923',name:'حسين يزداني',unit:'توليد فلزي',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'958',name:'رضا قاسملو',unit:'توليدغيرفلزي',degree:'ليسانس',major:'شيمي',safSetad:'ستاد'},
            {id:'962',name:'فرهاد قاصد',unit:'توليد فلزي',degree:'ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'973',name:'ايمان تعميري اهوازي',unit:'توليدغيرفلزي',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'975',name:'بهرام خسروي',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'مديريت کسب و کار',safSetad:'ستاد'},
            {id:'994',name:'هادي عباسي',unit:'کيفيت',degree:'ليسانس',major:'متالوژي',safSetad:'ستاد'},
            {id:'999',name:'مهدي کيان',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'1008',name:'مهدي محمودي',unit:'بازاريابي و فروش',degree:'ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'1015',name:'هادي بندلي زاده',unit:'حراست',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'1016',name:'ابراهيم جباري',unit:'حراست',degree:'ليسانس',major:'حريق و حوادث',safSetad:'ستاد'},
            {id:'1023',name:'علي جنان فر',unit:'اداري',degree:'سوم دبيرستان',major:'برق',safSetad:'ستاد'},
            {id:'1026',name:'غلامرضا محسني',unit:'حراست',degree:'ديپلم',major:'فرهنگ وادب',safSetad:'ستاد'},
            {id:'1058',name:'منصور ايراني بجندي',unit:'توليدغيرفلزي',degree:'ليسانس',major:'شيمي',safSetad:'ستاد'},
            {id:'1065',name:'حسن حميدي پيله رود',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1081',name:'احمد رحيمي سقرلو',unit:'حراست',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1095',name:'اكبر درمانلو',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1136',name:'سيدحميدرضا موسوي نژاد',unit:'نگهداري و تعميرات',degree:'فوق ليسانس',major:'علوم ارتباطات',safSetad:'ستاد'},
            {id:'1150',name:'داود زند',unit:'حراست',degree:'فوق ديپلم',major:'جوشکاري',safSetad:'ستاد'},
            {id:'1183',name:'حميدرضا حسنخاني فراهاني',unit:'حراست',degree:'ديپلم',major:'رياضي و فيزيك',safSetad:'ستاد'},
            {id:'1209',name:'اسمعيل سلطاني',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'روابط عمومي',safSetad:'ستاد'},
            {id:'1221',name:'امير بهزاداوخساري',unit:'مديريت عامل',degree:'ليسانس',major:'حقوق',safSetad:'ستاد'},
            {id:'1269',name:'علي اصغر قرباني خمسهء',unit:'حراست',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'1306',name:'انور خدادادي قراقيه',unit:'حراست',degree:'فوق ديپلم',major:'تکنولوژي توليدات گياهي',safSetad:'ستاد'},
            {id:'1321',name:'سيدابن يامين ميرزكي',unit:'مهندسي فرايند',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1346',name:'علي روستائي',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'ايمني، سلامت و محيط زيست',safSetad:'ستاد'},
            {id:'1348',name:'اكبر مقدمي مونقي',unit:'حراست',degree:'ليسانس',major:'امداد و سوانح',safSetad:'ستاد'},
            {id:'1374',name:'حسين حيدري پور',unit:'حراست',degree:'فوق ديپلم',major:'بازاريابي',safSetad:'ستاد'},
            {id:'1393',name:'عباس محمدزماني',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'علوم انساني',safSetad:'ستاد'},
            {id:'1394',name:'سيدمصطفي عظيمي',unit:'مديريت عامل',degree:'ليسانس',major:'توليدات دامي',safSetad:'ستاد'},
            {id:'1404',name:'سيده محبوبه سيدمومني',unit:'معاونت بازرگاني',degree:'ديپلم',major:'علوم انساني',safSetad:'ستاد'},
            {id:'1407',name:'سميه ذوالفقاري دورباش',unit:'اداري و توسعه منابع انساني',degree:'فوق ديپلم',major:'بازرگاني',safSetad:'ستاد'},
            {id:'1422',name:'محسن لطفي جاويد',unit:'طرح و برنامه',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'1426',name:'حسينعلي صادقي',unit:'برنامه ريزي',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'1439',name:'محمود دهقاني',unit:'اداري و توسعه منابع انساني',degree:' اول راهنمايي',major:'____',safSetad:'ستاد'},
            {id:'1483',name:'مهدي شاکري',unit:'حراست',degree:'ديپلم',major:'نقشه كشي ساختمان معماري',safSetad:'ستاد'},
            {id:'1500',name:'ثمره شفيعي مويد',unit:'مديريت عامل',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'1508',name:'مسعود اصغرپور',unit:'مونتاژمحصول',degree:'ليسانس',major:'مكانيك',safSetad:'ستاد'},
            {id:'1513',name:'بابک عظيم لوي شانجاني',unit:'کيفيت',degree:'فوق ليسانس',major:'علوم اجتماعي',safSetad:'ستاد'},
            {id:'1534',name:'فاطمه شريف طهراني',unit:'کيفيت',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1542',name:'محسن شکوه بابائي',unit:'تحقيق وتوسعه وطراحي محصول',degree:'ليسانس',major:'مهندسي نساجي',safSetad:'ستاد'},
            {id:'1547',name:'علي گودرزتله جردي',unit:'حراست',degree:'فوق ليسانس',major:'پژوهشگري امنيت',safSetad:'ستاد'},
            {id:'1549',name:'بهمن بمپوري',unit:'حراست',degree:'ديپلم',major:'علوم انساني',safSetad:'ستاد'},
            {id:'1560',name:'حميدرضا وزيري نيا',unit:'طرح و برنامه',degree:'ليسانس',major:'سخت افزار کامپيوتر',safSetad:'ستاد'},
            {id:'1578',name:'مهدي فلاح',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'بهداشت حرفه اي',safSetad:'ستاد'},
            {id:'1612',name:'مهدي قنبري نودهي',unit:'حراست',degree:'ديپلم',major:'راه و ساختمان',safSetad:'ستاد'},
            {id:'1623',name:'عليرضا اميري پور',unit:'نگهداري و تعميرات',degree:'ليسانس',major:'مهندسي فناوري مکانيک خودرو',safSetad:'ستاد'},
            {id:'1637',name:'احمد محمدي نصر آباد',unit:'نگهداري و تعميرات',degree:'ليسانس',major:'مهندسي فناوري الکترونيک صنعتي',safSetad:'ستاد'},
            {id:'1659',name:'علي رضائي',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'1680',name:'عباس افضلي',unit:'معاونت بازرگاني',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'1683',name:'حسن سليماني کليشمي',unit:'مهندسي توليد',degree:'ليسانس',major:'مهندسي تکنولوژي الکترونيک',safSetad:'ستاد'},
            {id:'1694',name:'رضا حسني طراوت',unit:'تحقيق وتوسعه وطراحي محصول',degree:'ليسانس',major:'نقشه کشي صنعتي',safSetad:'ستاد'},
            {id:'1705',name:'سيداصغر علي بابائي',unit:'حراست',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'1719',name:'هاشم تيموري',unit:'اداري و توسعه منابع انساني',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1751',name:'سيدحسن سخي جوارشک',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'1753',name:'محمدعلي والي نژاد',unit:'معاونت بازرگاني',degree:'ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'1758',name:'حسين منصوري',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'1762',name:'کامران حق شناس',unit:'توليدغيرفلزي',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'1769',name:'بابك صابري',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي تکنولوژي الکترونيک',safSetad:'ستاد'},
            {id:'1771',name:'مجيد صمدبين',unit:'حراست',degree:'ديپلم',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'1773',name:'محمدمهدي يزدي',unit:'برنامه ريزي',degree:'فوق ليسانس',major:'مديريت اجرايي',safSetad:'ستاد'},
            {id:'1787',name:'سيدمجيد جوادي دوگاهه',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'1799',name:'بابک کباري',unit:'معاونت بازرگاني',degree:'ليسانس',major:'دبيري زبان انگليسي',safSetad:'ستاد'},
            {id:'1809',name:'علي رعيت',unit:'مونتاژمحصول',degree:'ليسانس',major:'زبان و ادبيات فارسي',safSetad:'ستاد'},
            {id:'1862',name:'ناصر جباري',unit:'مونتاژمحصول',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'1866',name:'شادي جمشيدي',unit:'برنامه ريزي',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'1879',name:'مسعود برزا',unit:'معاونت توليد',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'1909',name:'غلامعلي نوروزي',unit:'توليدغيرفلزي',degree:'ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'1946',name:'عليرضا صادق زاده',unit:'حراست',degree:'ديپلم',major:'رياضي و فيزيك',safSetad:'ستاد'},
            {id:'2114',name:'مهدي قهرماني',unit:'حراست',degree:'ديپلم',major:'مكانيك',safSetad:'ستاد'},
            {id:'2154',name:'مهدي نقوي',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'الكتروتكنيك',safSetad:'ستاد'},
            {id:'2189',name:'محمد نعمتي لفجماني',unit:'توليد فلزي',degree:'ليسانس',major:'حقوق قضايي',safSetad:'ستاد'},
            {id:'2226',name:'سپيده سبزواري',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'رياضي و فيزيك',safSetad:'ستاد'},
            {id:'2244',name:'زهرا هادي هدش',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'مهندسي محيط زيست',safSetad:'ستاد'},
            {id:'2260',name:'روح اله سولقاني',unit:'حراست',degree:'ديپلم',major:'نقشه كشي ساختمان معماري',safSetad:'ستاد'},
            {id:'2293',name:'امين اسمعيلي',unit:'برنامه ريزي',degree:'فوق ليسانس',major:'مهندسي سيتمهاي اقتصادي - اجتماعي',safSetad:'ستاد'},
            {id:'2297',name:'ابوذر مهري پورازبرمي',unit:'حراست',degree:'ديپلم',major:'الكتروتكنيك',safSetad:'ستاد'},
            {id:'2302',name:'ندا ياوري',unit:'طرح و برنامه',degree:'ليسانس',major:'مهندسي کامپيوتر',safSetad:'ستاد'},
            {id:'2313',name:'حامده باحجاب',unit:'مديريت عامل',degree:'فوق ليسانس',major:'حقوق بين الملل',safSetad:'ستاد'},
            {id:'2316',name:'مونا گودرزي',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2317',name:'علي جامعي',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'مديريت اجرايي',safSetad:'ستاد'},
            {id:'2318',name:'سيدعلي حسيني مهر',unit:'حراست',degree:'فوق ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'2335',name:'امير وحيدي',unit:'معاونت توليد',degree:'فوق ليسانس',major:'زبان و ادبيات فارسي',safSetad:'ستاد'},
            {id:'2338',name:'مصطفي اکبري',unit:'کيفيت',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'2340',name:'عاطفه زواره زارع',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2396',name:'محسن کوچکي پور',unit:'نگهداري و تعميرات',degree:'ليسانس',major:'برق',safSetad:'ستاد'},
            {id:'2397',name:'محمود شهاب حسين آبادي',unit:'مديريت عامل',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2466',name:'حجت صبوري ماسوله',unit:'اداري و توسعه منابع انساني',degree:'چهارم ابتدايي',major:'____',safSetad:'ستاد'},
            {id:'2571',name:'ستاره ظهرابي',unit:'طرح و برنامه',degree:'ليسانس',major:'مديريت دولتي',safSetad:'ستاد'},
            {id:'2575',name:'منا عسکري',unit:'طرح و برنامه',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'2579',name:'داود مقدمي',unit:'حراست',degree:'ليسانس',major:'فرهنگ وادب',safSetad:'ستاد'},
            {id:'2584',name:'ولي اله زاده خاطر',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'2591',name:'محمدرضا مجيدي',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2596',name:'عيسي کريمي کلايه',unit:'توليد فلزي',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'2618',name:'آرش جمشيدي دانا',unit:'حراست',degree:'ديپلم',major:'نقشه كشي ساختمان معماري',safSetad:'ستاد'},
            {id:'2619',name:'حسين خوشه سپهر',unit:'برنامه ريزي',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2625',name:'مهدي مقيمي',unit:'حراست',degree:'فوق ديپلم',major:'حسابداري',safSetad:'ستاد'},
            {id:'2637',name:'مهدي جان نثاري',unit:'اداري و توسعه منابع انساني',degree:'پنجم ابتدايي',major:'____',safSetad:'ستاد'},
            {id:'2638',name:'مهدي مهدوي',unit:'کيفيت',degree:'ليسانس',major:'شيمي نساجي',safSetad:'ستاد'},
            {id:'2642',name:'عليرضا ذکيا',unit:'نگهداري و تعميرات',degree:'سوم راهنمايي',major:'____',safSetad:'ستاد'},
            {id:'2644',name:'سيدامين مفضلي',unit:'طرح و برنامه',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'2650',name:'محمدمهدي اعرابي',unit:'حراست',degree:'ليسانس',major:'علوم اجتماعي',safSetad:'ستاد'},
            {id:'2670',name:'مهرداد ذوالفقاري',unit:'اداري و توسعه منابع انساني',degree:'ديپلم',major:'تاسيسات',safSetad:'ستاد'},
            {id:'2679',name:'حسين نکويي مطلق',unit:'حراست',degree:'ديپلم',major:'تاسيسات',safSetad:'ستاد'},
            {id:'2701',name:'فاطمه رمضاني',unit:'طرح و برنامه',degree:'فوق ليسانس',major:'مديريت فناوري اطلاعات',safSetad:'ستاد'},
            {id:'2705',name:'محمدمهدي پورشيخعلي',unit:'حراست',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'2762',name:'يوسف ميارعباس کياني',unit:'توليد فلزي',degree:'فوق ليسانس',major:'مديريت دولتي',safSetad:'ستاد'},
            {id:'2763',name:'مهتاب بي رنگي اصل',unit:'اداري و توسعه منابع انساني',degree:'فوق ديپلم',major:'حسابداري',safSetad:'ستاد'},
            {id:'2765',name:'حسن خسروي',unit:'حراست',degree:'ديپلم',major:'کاربردکامپيوتر',safSetad:'ستاد'},
            {id:'2787',name:'سهيل مدبري',unit:'کيفيت',degree:'فوق ليسانس',major:'گرايش صنعت خودرو  MBA',safSetad:'ستاد'},
            {id:'2793',name:'مهدي ملکي',unit:'طرح و برنامه',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2806',name:'عسل فرزان',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مديريت مالي',safSetad:'ستاد'},
            {id:'2810',name:'صادق فرج نيا',unit:'مهندسي توليد',degree:'ليسانس',major:'مهندسي مواد متالوژي',safSetad:'ستاد'},
            {id:'2814',name:'مسعود جعفري',unit:'حراست',degree:'ديپلم',major:'تعمير موتورخودرو',safSetad:'ستاد'},
            {id:'2851',name:'محمد گودرزي',unit:'مهندسي توليد',degree:'ليسانس',major:'ساخت و توليد',safSetad:'ستاد'},
            {id:'2858',name:'مهدي بيات قشلاقي',unit:'کيفيت',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'2862',name:'عباس چيت سازبروجردي',unit:'معاونت بازرگاني',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'2863',name:'معصومه نوري زاده',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مديريت مالي',safSetad:'ستاد'},
            {id:'2884',name:'سيدمحمدحسين سيدغفوري',unit:'مديريت عامل',degree:'دانشجوي ليسانس',major:'علوم حوزوي',safSetad:'ستاد'},
            {id:'2888',name:'سيدمحمد ميري',unit:'اداري و توسعه منابع انساني',degree:'دكتري',major:'پزشک عمومي',safSetad:'ستاد'},
            {id:'2891',name:'فاطمه ميثمي',unit:'طرح و برنامه',degree:'ليسانس',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'2895',name:'بهنام دستگاه',unit:'حراست',degree:'ديپلم',major:'atomecanic',safSetad:'ستاد'},
            {id:'2904',name:'مهناز رياضي',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'بهداشت',safSetad:'ستاد'},
            {id:'2922',name:'محمودرضا تيرسرائي',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مديريت مالي',safSetad:'ستاد'},
            {id:'2928',name:'فرج اله حاتمي',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي کشاورزي',safSetad:'ستاد'},
            {id:'2932',name:'علي اکبر نعيمي',unit:'اداري و توسعه منابع انساني',degree:'فوق ديپلم',major:'حسابداري',safSetad:'ستاد'},
            {id:'2933',name:'رضا سلطاني واحد',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2940',name:'امير رفيعي فروشاني',unit:'معاونت بازرگاني',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'2944',name:'حميدرضا زنگي',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'مديريت دولتي',safSetad:'ستاد'},
            {id:'2950',name:'مهدي علي خاني',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2951',name:'سيده ياسمن ميرزکي',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2960',name:'سيدعلي حسيني',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2965',name:'حامد حسن زاده',unit:'مالي واقتصادي',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'2967',name:'هادي افتخاري',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'2979',name:'سعيد حقيقي',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'2999',name:'هادي آزادپناه',unit:'مالي واقتصادي',degree:'ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'3002',name:'زهرا وکيلي',unit:'طرح و برنامه',degree:'ليسانس',major:'علوم اجتماعي',safSetad:'ستاد'},
            {id:'3007',name:'رضا محمدي نسب',unit:'حراست',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'3008',name:'محمد بهرامي',unit:'مديريت عامل',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'3010',name:'صابر ياري',unit:'حراست',degree:'ليسانس',major:'مديريت کسب و کار',safSetad:'ستاد'},
            {id:'3011',name:'زهرا اسماعيل نژاد',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'مديريت کسب و کار',safSetad:'ستاد'},
            {id:'3012',name:'سميه خان محمدي',unit:'معاونت بازرگاني',degree:'ليسانس',major:'آب وهواشناسي',safSetad:'ستاد'},
            {id:'3013',name:'سمانه اميري',unit:'مديريت عامل',degree:'فوق ليسانس',major:'صنايع دستي',safSetad:'ستاد'},
            {id:'3017',name:'مهدي ايزدي',unit:'حراست',degree:'ليسانس',major:'حفاظت و پيشگيري از حريق و حوادث',safSetad:'ستاد'},
            {id:'3023',name:'مهدي حميدوند',unit:'کيفيت',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'3025',name:'محسن سهيلي',unit:'حراست',degree:'ليسانس',major:'ایمنی صنعتی',safSetad:'ستاد'},
            {id:'3101',name:'مصطفي عليش پور',unit:'مديريت عامل',degree:'ليسانس',major:'بازرگاني',safSetad:'ستاد'},
            {id:'3106',name:'نازنين فتحي سپرداني',unit:'معاونت بازرگاني',degree:'ليسانس',major:'زيست شناسي',safSetad:'ستاد'},
            {id:'3118',name:'سيده مينا دژوند',unit:'حراست',degree:'فوق ديپلم',major:'مديريت کسب و کار',safSetad:'ستاد'},
            {id:'3122',name:'زهرا مجنون',unit:'مالي واقتصادي',degree:'ديپلم',major:'ادبيات وعلوم انساني',safSetad:'ستاد'},
            {id:'3123',name:'بهروز فارسي عباس آبادي',unit:'معاونت بازرگاني',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'3127',name:'سيمين اشتياقي',unit:'مديريت عامل',degree:'ليسانس',major:'مديريت دولتي',safSetad:'ستاد'},
            {id:'3133',name:'امين بيات',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'بازرگاني',safSetad:'ستاد'},
            {id:'3135',name:'سعيد قانع',unit:'کيفيت',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'3161',name:'کيوان کريم دخت ملومه',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مديريت اجرايي',safSetad:'ستاد'},
            {id:'3185',name:'نگين شهبازي',unit:'کيفيت',degree:'ليسانس',major:'مهندسي کشاورزي',safSetad:'ستاد'},
            {id:'3192',name:'سجاد ميردارشاه حسيني',unit:'طرح و برنامه',degree:'ليسانس',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'3211',name:'اعظم سيويلي',unit:'طرح و برنامه',degree:'فوق ديپلم',major:'نقشه کشي صنعتي',safSetad:'ستاد'},
            {id:'3267',name:'جهانبخش گودرزي',unit:'طرح و برنامه',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'3269',name:'فاطمه عباسي',unit:'طرح و برنامه',degree:'ليسانس',major:'مهندسي فناوري اطلاعات',safSetad:'ستاد'},
            {id:'3296',name:'اميرحسين سالم دهقاني',unit:'مديريت عامل',degree:'فوق ديپلم',major:'مديريت کسب و کار',safSetad:'ستاد'},
            {id:'3302',name:'سيدحامد هاشمي',unit:'معاونت بازرگاني',degree:'ليسانس',major:'مديريت تبليغات تجاري',safSetad:'ستاد'},
            {id:'3306',name:'محمد محمدي',unit:'اداري و توسعه منابع انساني',degree:'پيش دانشگاهي',major:'علوم انساني',safSetad:'ستاد'},
            {id:'3316',name:'سميرا نظري',unit:'مالي واقتصادي',degree:'ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'3318',name:'عليرضا شيرين پور هفتخواني',unit:'حراست',degree:'ديپلم',major:'حسابداري',safSetad:'ستاد'},
            {id:'3322',name:'سيداميررضا رضائي',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي مکانيک',safSetad:'ستاد'},
            {id:'3326',name:'صديقه شاه ولي کوه شوري',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'علوم طيور',safSetad:'ستاد'},
            {id:'3355',name:'علي حسيني علائي',unit:'حراست',degree:'فوق ديپلم',major:'فرهنگ وادب',safSetad:'ستاد'},
            {id:'3358',name:'مجيد محمدکريمي',unit:'حراست',degree:'ديپلم',major:'رياضي و فيزيك',safSetad:'ستاد'},
            {id:'3364',name:'علي حسين رحيمي مراشي',unit:'حراست',degree:'ديپلم',major:'کاردانش',safSetad:'ستاد'},
            {id:'3394',name:'ميلاد گودرزي مجد',unit:'حراست',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'3396',name:'عباس عباسي',unit:'حراست',degree:'ديپلم',major:'ساخت و توليد',safSetad:'ستاد'},
            {id:'3397',name:'محمدامين مهرابي',unit:'حراست',degree:'پيش دانشگاهي',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'3398',name:'سعيد زاغري',unit:'حراست',degree:'پيش دانشگاهي',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'3401',name:'بنيامين حاجي عباسي',unit:'حراست',degree:'ديپلم',major:'ادبيات وعلوم انساني',safSetad:'ستاد'},
            {id:'3402',name:'محمدحسين آردي',unit:'حراست',degree:'فوق ديپلم',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'3404',name:'سينا حاجي محمداميني',unit:'اداري و توسعه منابع انساني',degree:'ليسانس',major:'روانشناسي عمومي',safSetad:'ستاد'},
            {id:'3406',name:'وحيد نوري طهرابند',unit:'حراست',degree:'ديپلم',major:'علوم تجربي',safSetad:'ستاد'},
            {id:'3407',name:'جواد بابيزان',unit:'حراست',degree:'فوق ديپلم',major:'نقشه کشي صنعتي',safSetad:'ستاد'},
            {id:'3413',name:'حسين بشارتي',unit:'حراست',degree:'ليسانس',major:'مهندسي فناوري اطلاعات',safSetad:'ستاد'},
            {id:'3422',name:'عليرضا سليماني',unit:'حراست',degree:'ديپلم',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'3428',name:'محمدرضا مهراني',unit:'حراست',degree:'فوق ديپلم',major:'حسابداري',safSetad:'ستاد'},
            {id:'3435',name:'محمدرضا وفائي روزبهاني',unit:'نگهداري و تعميرات',degree:'ديپلم',major:'الكتروتكنيك',safSetad:'ستاد'},
            {id:'3451',name:'عليرضا نيک پور',unit:'حراست',degree:'فوق ديپلم',major:'سخت افزار کامپيوتر',safSetad:'ستاد'},
            {id:'3452',name:'پژمان طاعتي',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'3458',name:'عليرضا ملکي',unit:'طرح و برنامه',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'3466',name:'حسن اسدي',unit:'حراست',degree:'ديپلم',major:'تعمير موتورخودرو',safSetad:'ستاد'},
            {id:'3467',name:'عيوض فروزنده قوجه بيگلو',unit:'حراست',degree:'ليسانس',major:'علوم ورزشي',safSetad:'ستاد'},
            {id:'3474',name:'اميررضا امين ياور',unit:'حراست',degree:'ليسانس',major:'معارف اسلامي',safSetad:'ستاد'},
            {id:'3475',name:'سعيد مهدي نژاد',unit:'مالي واقتصادي',degree:'ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'3477',name:'علي علي زاده دولت آباد',unit:'اداري و توسعه منابع انساني',degree:'فوق ليسانس',major:'مديريت آموزشي',safSetad:'ستاد'},
            {id:'3478',name:'علي کيان مهر',unit:'توليد فلزي',degree:'سوم راهنمايي',major:'____',safSetad:'ستاد'},
            {id:'3497',name:'زينب محزون فتمه سري',unit:'مالي واقتصادي',degree:'ديپلم',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'3502',name:'هادي حياتي',unit:'اداري و توسعه منابع انساني',degree:'پنجم ابتدايي',major:'____',safSetad:'ستاد'},
            {id:'3505',name:'ميلاد خيرخواه ثابت قدم',unit:'اداري و توسعه منابع انساني',degree:'ديپلم',major:'کامپيوتر',safSetad:'ستاد'},
            {id:'3509',name:'بهزاد توکلي',unit:'حراست',degree:'ديپلم',major:'تعمير موتورخودرو',safSetad:'ستاد'},
            {id:'3520',name:'حميد دهقاني',unit:'مهندسي فرايند',degree:'ليسانس',major:'مهندسي برق',safSetad:'ستاد'},
            {id:'3521',name:'ميترا قرباني',unit:'مهندسي فرايند',degree:'فوق ليسانس',major:'مهندسي برق',safSetad:'ستاد'},
            {id:'3527',name:'صادق صمدي',unit:'معاونت بازرگاني',degree:'فوق ديپلم',major:'بازاريابي',safSetad:'ستاد'},
            {id:'3537',name:'بهنام زهره وند',unit:'مالي واقتصادي',degree:'ليسانس',major:'حسابداري',safSetad:'ستاد'},
            {id:'3538',name:'شهريار حمداني',unit:'مالي واقتصادي',degree:'ليسانس',major:'تربيت بدني',safSetad:'ستاد'},
            {id:'3542',name:'رسول شريفي نيا',unit:'حراست',degree:'ديپلم',major:'تعمير موتورخودرو',safSetad:'ستاد'},
            {id:'3548',name:'امير رحماني',unit:'حراست',degree:'ليسانس',major:'مديريت بازرگاني',safSetad:'ستاد'},
            {id:'3550',name:'غلام رضا عبداله خاني',unit:'حراست',degree:'فوق ليسانس',major:'نرم افزارکامپيوتر',safSetad:'ستاد'},
            {id:'3552',name:'گلفام مسعودي',unit:'معاونت بازرگاني',degree:'فوق ليسانس',major:'زبان',safSetad:'ستاد'},
            {id:'3553',name:'پدرام بهرودي',unit:'اداري و توسعه منابع انساني',degree:'فوق ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'3554',name:'محسن نبي نيا',unit:'کيفيت',degree:'ليسانس',major:'مهندسي شيمي',safSetad:'صف'},
            {id:'3555',name:'فريبا محمدي راد',unit:'طرح و برنامه',degree:'ليسانس',major:'زمين شناسي',safSetad:'ستاد'},
            {id:'3556',name:'بهزاد شکري',unit:'مديريت عامل',degree:'فوق ليسانس',major:'مديريت دولتي',safSetad:'ستاد'},
            {id:'3557',name:'رضا شعباني ورکي',unit:'معاونت بازرگاني',degree:'فوق ديپلم',major:'روابط عمومي',safSetad:'ستاد'},
            {id:'3558',name:'سيدحسن نصيري',unit:'مديريت عامل',degree:'فوق ليسانس',major:'مهندسي صنايع',safSetad:'ستاد'},
            {id:'3561',name:'رضا بخشش طلب مرکيه',unit:'حراست',degree:'ديپلم',major:'الکترونيک',safSetad:'ستاد'},
            {id:'3562',name:'عليرضا خدابنده',unit:'حراست',degree:'سيكل',major:'____',safSetad:'ستاد'},
            {id:'3563',name:'امير شکرخند',unit:'مالي واقتصادي',degree:'فوق ليسانس',major:'مديريت صنعتي',safSetad:'ستاد'},
            {id:'-',name:'سیروس نصیری',unit:'مديريت عامل',degree:'____',major:'____',safSetad:'ستاد'},
            {id:'-',name:'محمدجواد طاهری محمودی',unit:'اداري و توسعه منابع انساني',degree:'دكتري',major:'پزشک عمومي',safSetad:'ستاد'},
            {id:'-',name:'مسعود مصباح',unit:'اداري و توسعه منابع انساني',degree:'دكتري',major:'پزشک عمومي',safSetad:'ستاد'},
            {id:'-',name:'میرفلاح دهقان نژاد',unit:'مالي واقتصادي',degree:'____',major:'____',safSetad:'ستاد'}
        ];

        // 6. Car Fleet
        const carList = [
            {row: 1, receiver: 'مدیریت عامل', position: 'مدیریت', car: 'سراتو', year: '1394', plate: '73ی597 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 2, receiver: 'دفتر مدیریت', position: 'دفتر', car: 'شاهین', year: '1401', plate: '45ه642 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 3, receiver: 'دفتر مدیریت', position: 'دفتر', car: 'شاهین', year: '1401', plate: '65م385 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 4, receiver: 'غلامرضا عبداله خانی', position: 'مدیر حراست', car: 'شاهین CVT', year: '1402', plate: '88ق584 ایران33', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 5, receiver: 'علی علیزاده دولت آباد', position: 'مدیر اداری', car: 'ساندرو استپ وی', year: '1396', plate: '64ی756 ایران33', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 6, receiver: 'دفتر مدیریت', position: 'دفتر', car: 'رنو ال 90', year: '1390', plate: '65م322 ایران33', usage: 'عمومی/ماموریت', tech: 'نیاز به تعمیر', status: 'غیر فعال', statusColor: 'inactive', techColor: 'repair'},
            {row: 7, receiver: 'دفتر مدیریت', position: 'دفتر', car: 'ریو', year: '1390', plate: '57و773 ایران33', usage: 'عمومی/ماموریت', tech: 'نیاز به تعمیر', status: 'غیر فعال', statusColor: 'inactive', techColor: 'repair'},
            {row: 8, receiver: 'امین حسن زاده', position: 'امانی در اختیار', car: 'فیدیلیتی', year: '1400', plate: '45د519 ایران33', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 9, receiver: 'سید حسن نصیری', position: 'هیئت مدیره', car: 'شاهین CVT', year: '1402', plate: '85ط587 ایران33', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 10, receiver: 'امین حسن زاده', position: 'امانی در اختیار', car: 'چانگان', year: '1395', plate: '---', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
             {row: 11, receiver: 'دفتر مدیریت', position: '---', car: 'شاهین', year: '1401', plate: '75ی281 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 12, receiver: 'دفتر مدیریت', position: '---', car: 'شاهین', year: '1401', plate: '87ق956 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 13, receiver: 'صادق فرج نیا', position: 'مدیر مهندسی', car: 'برلیانس کراس', year: '1395', plate: '45ل774 ایران44', usage: 'در اختیار', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 14, receiver: 'دفتر مدیریت', position: '---', car: 'شاهین', year: '1401', plate: '25ل475 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 15, receiver: 'دفتر مدیریت', position: '---', car: 'شاهین', year: '1401', plate: '53ن316 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
             {row: 16, receiver: 'دفتر مدیریت', position: '---', car: 'شاهین CVT', year: '1402', plate: '75ی282 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 17, receiver: 'در اختیار نقلیه', position: '---', car: 'نیسان پادرا', year: '1402', plate: '83ل558 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 18, receiver: 'در اختیار بهداشت', position: '---', car: 'تویوتا هایس(آمبولانس)', year: '2010', plate: '41ق725 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 19, receiver: 'در اختیار حراست', position: '---', car: 'تیبا', year: '1399', plate: '53ن314 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 20, receiver: 'در اختیار حراست', position: '---', car: 'پراید', year: '1394', plate: '99ق848 ایران33', usage: 'عمومی/ماموریت', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 21, receiver: 'در اختیار آتش نشانی', position: '---', car: 'کامیون بنز', year: '---', plate: '81م869 ایران33', usage: '---', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 22, receiver: 'در اختیار آتش نشانی', position: '---', car: 'وانت ریچ', year: '---', plate: '65م612 ایران33', usage: '---', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
            {row: 23, receiver: 'در اختیار آتش نشانی', position: '---', car: 'کامیون ایویکو', year: '---', plate: '39ع953 ایران33', usage: '---', tech: 'سالم', status: 'فعال', statusColor: 'active', techColor: 'active'},
        ];
        
        // 5. Contract Expiry Data
        const contractData = [
            { id: 1, name: "آرش تالانه", workType: "بازرگانی", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/06/01" },
            { id: 2, name: "مهلا پورخلف", workType: "تعاونی", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 3, name: "مریم فلاح", workType: "تعاونی", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/07/01" },
            { id: 4, name: "حامد داودی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 5, name: "حمید بهرامی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 6, name: "سعید حنیفه", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 7, name: "سعیدحسینی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/09/01" },
            { id: 8, name: "سینا کرمی بانیارانی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 9, name: "کاظم محمد نژاد", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 10, name: "علی اکبر علیزمانی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 11, name: "فرزاد خدامرادی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 12, name: "کاظم فتحعلی لو", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 13, name: "محسن دانا شالقونی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 14, name: "محمد بیراک", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1404/03/01" },
            { id: 15, name: "محمد جواد پورنورعلی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 16, name: "مسعود اکبرزاده", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 17, name: "مهدی احدی عنایت", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/09/01" },
            { id: 18, name: "نریمان نظری بابازیدی", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 19, name: "نیکزاد ابراهیمی ورمله", workType: "جمع آوری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 20, name: "محمد شهبازی کنچوبه", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/07/01" },
            { id: 21, name: "امیرمحمدخزائی", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/03/01" },
            { id: 22, name: "جعفر عباسی", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/03/01" },
            { id: 23, name: "حسن احمدی", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/07/01" },
            { id: 24, name: "حسینعلی شعار", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/07/01" },
            { id: 25, name: "حمزه ترکاشوند", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/07/01" },
            { id: 26, name: "رضا اخضری", workType: "خدمات اداری", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/05/01" },
            { id: 27, name: "سیدهادی نورمحمدی", workType: "خدمات اداری", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 28, name: "علی رودساز", workType: "خدمات اداری", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 29, name: "علیرضا خداکرمی", workType: "خدمات اداری", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 30, name: "غلامرضا رشیدی", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 31, name: "محمدرضا نصیرزاده", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 32, name: "مرتضی باقری داشبلاغ", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 33, name: "یوسف هدایت نیا", workType: "خدمات اداری", shift: "شیفتی", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 34, name: "اعظم حصاری ایل ذوله", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/08/01" },
            { id: 35, name: "اعظم رزم پور", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 36, name: "اکرم پیری", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 37, name: "اکرم حبیبی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 38, name: "پری مهرزاد ثمرین", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 39, name: "پریسا الیاسی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/03/01" },
            { id: 40, name: "زهرا یزدان جو", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 41, name: "زهره بشکار", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/08/01" },
            { id: 42, name: "شهرام محمدی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/03/01" },
            { id: 43, name: "شهین سواری", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 44, name: "فاطمه براتی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/04/01" },
            { id: 45, name: "فاطمه تیموری کیا", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/07/01" },
            { id: 46, name: "فاطمه نیک پسند", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 47, name: "فریبا اشرفی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 48, name: "محدثه امیری", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/07/01" },
            { id: 49, name: "مرتضی آقائی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
            { id: 50, name: "مرجان سلیمانی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/01/01" },
            { id: 51, name: "مرضیه صادق پور داکدره", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 52, name: "مریم مهرزاد تکمه داش", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 53, name: "معصومه منصوری", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 54, name: "منصوره منصوری", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 55, name: "منوچهر خسروی اقکند", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/01/01" },
            { id: 56, name: "مهسا مشکین فر", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1404/07/01" },
            { id: 57, name: "نرگس ارجمندی نیا", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/01/15" },
            { id: 58, name: "نسیرین نظری جوپیش", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1402/09/01" },
            { id: 59, name: "وحید محمدزاده قمرکندی", workType: "کارگاه دوخت", shift: "ثابت", contractEnd: "1404/09/30", hireDate: "1403/06/01" },
        ];

        // 3. Retired Data
        const retiredList = [
            {id:860, name:'زارعي زهرا', date:'1402/12/26', amount:1999910000, type:'بازنشستگی عادی'},
            // ... (Full list preserved) ...
            {id:514, name:'فيض اله پور اسلام', date:'1402/12/26', amount:22781797, type:'بازنشستگی عادی'}
        ];
        const resignedList = [
            {id:613, name:'سرابي مهرداد', date:'1404/06/26', amount:23531906922, desc:''},
            // ... (Full list preserved) ...
            {id:514, name:'فيض اله پور اسلام', date:'1402/12/26', amount:22781797, desc:''}
        ];

        // --- LOGIC ---
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            if(lines.length < 2) return [];

            const data = [];
            for(let i = 1; i < lines.length; i++) {
                const currentline = lines[i].split(',');
                if(currentline.length < 5) continue; 
                
                let age = '-';
                const birthDate = currentline[5] ? currentline[5].trim() : '';
                if(birthDate && birthDate.length >= 4) {
                    const birthYear = parseInt(birthDate.substring(0, 4));
                    if(!isNaN(birthYear)) {
                        age = 1404 - birthYear;
                    }
                }

                const obj = {
                    id: currentline[0] || '',
                    position: currentline[1] || 'نامشخص',
                    name: (currentline[2] || '') + ' ' + (currentline[3] || ''),
                    unit: currentline[4] || 'نامشخص',
                    age: age,
                    gender: currentline[7] || '',
                    type: currentline[9] || '',
                    major: currentline[10] || 'نامشخص',
                    education: currentline[11] || 'نامشخص',
                    category: currentline[12] ? currentline[12].trim() : 'نامشخص'
                };
                data.push(obj);
            }
            return data;
        }

        function processData(data) {
            const stats = {
                education: {}, position: {}, gender: { 'مرد': 0, 'زن': 0 }, major: {}, setadMajors: {}, units: {}, category: {}, 
                age: { totalSum: 0, totalCount: 0, safSum: 0, safCount: 0, setadSum: 0, setadCount: 0 },
                total: data.length, managers: 0, official: 0
            };

            data.forEach(p => {
                let edu = (p.education || '').trim(); if(!edu || edu==='null') edu = 'نامشخص'; stats.education[edu] = (stats.education[edu] || 0) + 1;
                let pos = (p.position || '').trim(); stats.position[pos] = (stats.position[pos] || 0) + 1;
                if (['مدير', 'رئيس', 'سرپرست', 'مدیر'].some(t => pos.includes(t))) stats.managers++;
                if (p.gender && p.gender.includes('مرد')) stats.gender['مرد']++; else if (p.gender && p.gender.includes('زن')) stats.gender['زن']++;
                let maj = (p.major || '').trim(); if(!maj || maj === 'null') maj = 'نامشخص'; stats.major[maj] = (stats.major[maj] || 0) + 1;
                let u = (p.unit || '').trim(); if(!u) u = 'نامشخص'; stats.units[u] = (stats.units[u] || 0) + 1;
                let cat = (p.category || '').trim(); if(!cat) cat = 'نامشخص'; stats.category[cat] = (stats.category[cat] || 0) + 1;

                if(p.age !== '-' && typeof p.age === 'number') {
                    stats.age.totalSum += p.age; stats.age.totalCount++;
                    if(cat.includes('صف')) { stats.age.safSum += p.age; stats.age.safCount++; } 
                    else if(cat.includes('ستاد')) { stats.age.setadSum += p.age; stats.age.setadCount++; }
                }
                if(cat.includes('ستاد')) stats.setadMajors[maj] = (stats.setadMajors[maj] || 0) + 1;
                if (p.type && p.type.includes('رسمي')) stats.official++;
            });
            return stats;
        }

        function updateDashboard(data) {
            globalData = data;
            const stats = processData(data);

            document.getElementById('totalPersonnel').innerText = stats.total.toLocaleString('fa-IR');
            document.getElementById('totalManagers').innerText = stats.managers.toLocaleString('fa-IR');
            document.getElementById('officialEmp').innerText = stats.official.toLocaleString('fa-IR');
            const sortedEdu = Object.entries(stats.education).sort((a,b) => b[1] - a[1]);
            document.getElementById('dominantDegree').innerText = sortedEdu.length > 0 ? sortedEdu[0][0] : '-';
            
            updateCharts(stats);
            updateTable(data);
            updateUnitList(stats.units);
        }

        function updateUnitList(units) {
            const tbody = document.getElementById('unitTableBody');
            tbody.innerHTML = '';
            const sortedUnits = Object.entries(units).sort((a,b) => b[1] - a[1]);
            sortedUnits.forEach(u => {
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50';
                tr.innerHTML = `<td class="py-2 px-2 text-gray-800">${u[0]}</td><td class="py-2 px-2 text-left font-bold text-blue-600">${u[1]}</td>`;
                tbody.appendChild(tr);
            });
        }

        function updateCharts(stats) {
            Chart.defaults.font.family = "'Vazirmatn', sans-serif";
            Chart.defaults.color = '#4b5563';
            if(eduChart) eduChart.destroy(); if(posChart) posChart.destroy(); if(genChart) genChart.destroy();
            if(majChart) majChart.destroy(); if(ageChart) ageChart.destroy(); if(categoryChart) categoryChart.destroy(); if(unitChart) unitChart.destroy();

            eduChart = new Chart(document.getElementById('educationChart'), {
                type: 'bar', data: { labels: Object.keys(stats.education), datasets: [{ label: 'تعداد', data: Object.values(stats.education), backgroundColor: 'rgba(59, 130, 246, 0.7)', borderRadius: 4 }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            const posEntries = Object.entries(stats.position).sort((a,b)=>b[1]-a[1]);
            posChart = new Chart(document.getElementById('positionChart'), {
                type: 'doughnut', data: { labels: posEntries.slice(0, 8).map(x=>x[0]), datasets: [{ data: posEntries.slice(0, 8).map(x=>x[1]), backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#6366f1', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'], borderWidth: 0 }] }, options: { maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 10 } } } }
            });

            genChart = new Chart(document.getElementById('genderChart'), {
                type: 'pie', data: { labels: ['مرد', 'زن'], datasets: [{ data: [stats.gender['مرد'], stats.gender['زن']], backgroundColor: ['#3b82f6', '#ec4899'], borderWidth: 0 }] }, options: { maintainAspectRatio: false }
            });

            const majorEntries = Object.entries(stats.setadMajors).sort((a,b) => b[1] - a[1]).slice(0, 8);
            majChart = new Chart(document.getElementById('majorChart'), {
                type: 'bar', data: { labels: majorEntries.map(x => x[0]), datasets: [{ label: 'تعداد (ستاد)', data: majorEntries.map(x => x[1]), backgroundColor: 'rgba(139, 92, 246, 0.6)', borderColor: '#8b5cf6', borderWidth: 1, indexAxis: 'y' }] }, options: { maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } }
            });

            const avgTotal = stats.age.totalCount ? (stats.age.totalSum / stats.age.totalCount).toFixed(1) : 0;
            const avgSaf = stats.age.safCount ? (stats.age.safSum / stats.age.safCount).toFixed(1) : 0;
            const avgSetad = stats.age.setadCount ? (stats.age.setadSum / stats.age.setadCount).toFixed(1) : 0;
            ageChart = new Chart(document.getElementById('ageChart'), {
                type: 'bar', data: { labels: ['کل شرکت', 'نیروهای صف', 'نیروهای ستاد'], datasets: [{ label: 'سن (سال)', data: [avgTotal, avgSaf, avgSetad], backgroundColor: ['#64748b', '#f59e0b', '#3b82f6'], borderRadius: 5, barThickness: 40 }] }, options: { maintainAspectRatio: false, scales: { y: { beginAtZero: false, suggestedMin: 20 } }, plugins: { legend: { display: false } } }
            });

            const catEntries = Object.entries(stats.category).filter(x => x[0] !== 'نامشخص');
            categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut', data: { labels: catEntries.map(x=>x[0]), datasets: [{ data: catEntries.map(x=>x[1]), backgroundColor: ['#f59e0b', '#3b82f6', '#10b981'], borderWidth: 0 }] }, options: { maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom' } } }
            });

            const unitEntries = Object.entries(stats.units).sort((a,b) => b[1] - a[1]).slice(0, 10);
            unitChart = new Chart(document.getElementById('unitChart'), {
                type: 'bar', data: { labels: unitEntries.map(x => x[0]), datasets: [{ label: 'تعداد نفرات', data: unitEntries.map(x => x[1]), backgroundColor: 'rgba(99, 102, 241, 0.6)', borderColor: '#6366f1', borderWidth: 1 }] }, options: { maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } }
            });
        }

        function updateTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            document.getElementById('tableCount').innerText = `نمایش ${data.length.toLocaleString('fa-IR')} ردیف`;
            const fragment = document.createDocumentFragment();
            data.forEach((p, index) => {
                if(index > 1000) return; // Limit render for performance
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white hover:bg-gray-50' : 'bg-gray-50 hover:bg-gray-100';
                const categoryBadge = (p.category && p.category.includes('صف')) ? '<span class="bg-amber-100 text-amber-800 text-xs px-2 py-0.5 rounded">صف</span>' : ((p.category && p.category.includes('ستاد')) ? '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded">ستاد</span>' : (p.category || 'نامشخص'));
                tr.innerHTML = `<td class="px-6 py-3 font-medium text-gray-900">${p.id}</td><td class="px-6 py-3 font-bold text-gray-700">${p.name}</td><td class="px-6 py-3 text-center">${p.age}</td><td class="px-6 py-3"><span class="bg-gray-100 text-gray-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">${p.position}</span></td><td class="px-6 py-3">${p.unit}</td><td class="px-6 py-3">${p.education}</td><td class="px-6 py-3 text-xs text-gray-500">${p.major}</td><td class="px-6 py-3">${categoryBadge}</td>`;
                fragment.appendChild(tr);
            });
            tbody.appendChild(fragment);
        }

        function mapSetadToNewFormat(data) {
            return data.map(p => {
                 // Dummy age generation based on ID for demo
                const birthYear = 1350 + (parseInt(p.id) % 40);
                return {
                    id: p.id,
                    name: p.name,
                    position: 'کارمند', // Default
                    unit: p.unit,
                    age: 1404 - birthYear,
                    gender: p.gender || 'نامشخص',
                    type: 'قراردادی',
                    major: p.major,
                    education: p.degree,
                    category: p.safSetad || 'نامشخص'
                };
            });
        }

        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const btns = document.querySelectorAll('.tab-btn');
            btns.forEach(btn => {
                if(btn.getAttribute('onclick').includes(tabId)) btn.classList.add('active');
            });
        }

        document.getElementById('tableSearch').addEventListener('keyup', function(e) {
            const term = e.target.value.toLowerCase();
            if(!globalData.length) return;
            const filtered = globalData.filter(p => (p.name && p.name.includes(term)) || (p.id && p.id.includes(term)) || (p.position && p.position.includes(term)) || (p.unit && p.unit.includes(term)));
            updateTable(filtered);
        });

        document.getElementById('csvInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    const data = parseCSV(text);
                    if(data.length > 0) {
                        updateDashboard(data);
                        document.getElementById('errorMessage').classList.add('hidden');
                    } else { throw new Error('داده‌ای یافت نشد.'); }
                } catch (err) {
                    const errDiv = document.getElementById('errorMessage');
                    errDiv.innerText = 'خطا در خواندن فایل: ' + err.message;
                    errDiv.classList.remove('hidden');
                }
            };
            reader.readAsText(file, 'UTF-8');
        });
        
        // Initialize Logic for Other Tabs
        function initOtherTabs() {
            // Fleet
             const fleetTbody = document.querySelector('#fleetTable tbody');
             fleetTbody.innerHTML = '';
             carList.forEach(car => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${car.row}</td><td><b>${car.receiver}</b></td><td>${car.position}</td><td>${car.car}</td><td>${car.year}</td><td style="direction:ltr;">${car.plate}</td><td>${car.usage}</td><td><span class="badge badge-${car.techColor}">${car.tech}</span></td><td><span class="badge badge-${car.statusColor}">${car.status}</span></td>`;
                fleetTbody.appendChild(tr);
            });

            // Contract Expiry
            const total = contractData.length;
            const expiringCount = contractData.filter(p => p.contractEnd === "1404/09/30").length;
            document.getElementById('alert-text').textContent = `تاریخ سررسید: ۳۰ آذر ۱۴۰۴ (${expiringCount} نفر)`;
            
            const deptCounts = {};
            contractData.forEach(p => { deptCounts[p.workType] = (deptCounts[p.workType] || 0) + 1; });
            const sortedDepts = Object.entries(deptCounts).sort((a, b) => b[1] - a[1]);
            const chartContainer = document.getElementById('dept-chart-contract');
            chartContainer.innerHTML = ''; 
            sortedDepts.forEach(([dept, count], index) => {
                const percentage = Math.round((count / total) * 100);
                let colorClass = index === 0 ? 'bg-emerald-500' : (index === 1 ? 'bg-blue-500' : (index === 2 ? 'bg-amber-500' : 'bg-slate-400'));
                const html = `<div class="relative"><div class="flex justify-between mb-1 text-sm font-medium"><span class="text-slate-700">${dept}</span><span class="text-slate-500">${count} نفر (${percentage}%)</span></div><div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden"><div class="h-4 rounded-full ${colorClass}" style="width: ${percentage}%"></div></div></div>`;
                chartContainer.innerHTML += html;
            });

            let fixedCount = 0, shiftCount = 0;
            contractData.forEach(p => { if (p.shift.includes("ثابت")) fixedCount++; else shiftCount++; });
            document.getElementById('donut-total').textContent = total;
            document.getElementById('legend-shift').textContent = `${shiftCount} نفر`;
            document.getElementById('legend-fixed').textContent = `${fixedCount} نفر`;
            const shiftPct = (shiftCount / total) * 100;
            const fixedPct = (fixedCount / total) * 100;
            const ringShift = document.getElementById('ring-shift');
            const ringFixed = document.getElementById('ring-fixed');
            ringShift.setAttribute('stroke-dasharray', `${shiftPct}, 100`);
            ringFixed.setAttribute('stroke-dasharray', `${fixedPct}, 100`);
            ringFixed.setAttribute('stroke-dashoffset', `-${shiftPct}`);

            const tableBody = document.getElementById('table-body-contract');
            tableBody.innerHTML = '';
            contractData.forEach(row => {
                let deptStyle = row.workType === 'کارگاه دوخت' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : (row.workType === 'جمع آوری' ? 'bg-indigo-50 text-indigo-700 border-indigo-200' : 'bg-slate-100 text-slate-600 border-slate-200');
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";
                tr.innerHTML = `<td class="p-4 text-slate-500 font-mono">${row.id}</td><td class="p-4 font-medium text-slate-800">${row.name}</td><td class="p-4"><span class="px-2 py-1 rounded text-xs border ${deptStyle}">${row.workType}</span></td><td class="p-4 text-sm text-slate-600">${row.shift}</td><td class="p-4 font-mono text-red-600 font-bold">${row.contractEnd}</td><td class="p-4"><div class="flex items-center gap-1 text-red-600 text-sm"><i class="fa fa-exclamation-circle"></i><span>انقضا</span></div></td>`;
                tableBody.appendChild(tr);
            });

            // Finance & Retirees
            let sumRetired = 0; retiredList.forEach(item => { let val = item.amount; if (typeof val === 'string') val = val.replace(/,/g, ''); sumRetired += Number(val); });
            let sumResigned = 0; resignedList.forEach(item => { let val = item.amount; if (typeof val === 'string') val = val.replace(/,/g, ''); sumResigned += Number(val); });
            document.getElementById('sum-retired-table').innerText = sumRetired.toLocaleString();
            document.getElementById('sum-resigned-table').innerText = sumResigned.toLocaleString();
            document.getElementById('sum-total-table').innerText = (sumRetired + sumResigned).toLocaleString();
            document.getElementById('total-retired-display').innerText = "جمع: " + (sumRetired/1000000000).toFixed(1) + " میلیارد ریال";
            document.getElementById('total-resigned-display').innerText = "جمع: " + (sumResigned/1000000000).toFixed(1) + " میلیارد ریال";
            
            new Chart(document.getElementById('retireeDebtChart'), { type: 'doughnut', data: { labels: ['بازنشستگان', 'مستعفی‌ها'], datasets: [{ data: [sumRetired, sumResigned], backgroundColor: ['#d97706', '#1e3a8a'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            
            const budgetHTML = `<tr><td class="label">خالص حقوق پرسنل</td><td class="value">368,078,640,000</td></tr><tr><td class="label">بیمه 23% سهم کارفرما</td><td class="value">88,993,466,390</td></tr><tr><td class="label">مالیات حقوق</td><td class="value">25,646,466,623</td></tr><tr><td class="label">بیمه 7% سهم کارگر</td><td class="value">27,060,937,749</td></tr><tr><td class="label">حقوق مشاورین</td><td class="value">766,040,000</td></tr>`;
            document.getElementById('budgetTableBody').innerHTML = budgetHTML;
            new Chart(document.getElementById('budgetChart'), { type: 'pie', data: { labels: ['حقوق خالص', 'بیمه', 'مالیات', 'سایر'], datasets: [{ data: [368, 89, 26, 27], backgroundColor: ['#059669', '#be123c', '#d97706', '#1e293b'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            new Chart(document.getElementById('debtChart'), { type: 'bar', data: { labels: ['ذخیره سنوات (کل)', 'تامین اجتماعی (جاری+اقساط)', 'مالیات حقوق (تجمعی)', 'معوقات رفاهی'], datasets: [{ label: 'بدهی (میلیارد ریال)', data: [1622, 439, 196, 229], backgroundColor: ['#b91c1c', '#c2410c', '#be123c', '#991b1b'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            new Chart(document.getElementById('insuranceChart'), { type: 'bar', data: { labels: ['بیمه خرداد', 'بیمه مرداد', 'بیمه آبان', 'تقسیط (زیان‌آور)', 'تقسیط (حسابرسی)'], datasets: [{ label: 'مانده (میلیارد ریال)', data: [120, 118, 115, 51, 34], backgroundColor: '#1e3a8a' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            
            // Render Retiree/Resigned Tables
            const renderT = (tid, list) => {
                const tb = document.querySelector(`#${tid} tbody`); tb.innerHTML = '';
                list.forEach((r, i) => {
                    // Limit rows for performance, but here keep 100 or all? 
                    // Let's render all since user asked for it, but add simple pagination logic if huge.
                    // For 100 items, simple render is fine.
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${i+1}</td><td>${r.id}</td><td>${r.name}</td><td>${r.date}</td><td>${parseInt(String(r.amount).replace(/,/g,'')).toLocaleString()}</td><td>${r.type||r.desc||''}</td>`;
                    tb.appendChild(tr);
                });
            };
            renderT('retiredTableList', retiredList);
            renderT('resignedTableList', resignedList);
        }

        document.querySelectorAll('.accordion').forEach(acc => {
            acc.addEventListener('click', function() {
                this.classList.toggle('active');
                const panel = this.nextElementSibling;
                panel.style.maxHeight = panel.style.maxHeight ? null : panel.scrollHeight + "px";
            });
        });

        // Initialize Everything
        const initialData = mapSetadToNewFormat(setadPersonnel);
        updateDashboard(initialData);
        initOtherTabs();

    </script>
</body>
</html>
